"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[801],{4801:(te,Q,l)=>{l.r(Q),l.d(Q,{MapGtfsViewerModule:()=>Xt});var R=l(9808),_=l(9444),j=l(9560),A=l(801),M=l(109),k=l(949),V=l(5044),P=l(6785);const lt=A.uYr,ct=A.Ybx,dt=A.FGq,ut=A.TL5,W=A.tho;!function ht(){const r=new Date;r.setHours(0,0,0,0)}();const Y="gtfs",E="white",vt=new M.ZP({image:new k.Z({radius:4,fill:new V.Z({color:"rgb(255, 0, 0)"}),stroke:new P.Z({color:E,width:2})})}),gt=new M.ZP({image:new k.Z({radius:4,fill:new V.Z({color:"rgb(153, 76, 0)"}),stroke:new P.Z({color:E,width:2})})}),yt=new M.ZP({image:new k.Z({radius:4,fill:new V.Z({color:"rgb(102, 178, 255)"}),stroke:new P.Z({color:E,width:2})})}),xt=new M.ZP({image:new k.Z({radius:4,fill:new V.Z({color:"black"}),stroke:new P.Z({color:E,width:2})})});function X(r){return"0"===r.get("route_type")?vt:"1"===r.get("route_type")?yt:"2"===r.get("route_type")?gt:xt}var r,K=l(2397),St=l(3171),wt=l(187),Dt=l(4511),bt=l(2121),b=l(521),G=l(8587),Tt=l(4569),q=l(6597),w=l(483),L=l(9466),g=l(760),tt=l(1274),It=(r=function(a,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])})(a,t)},function(a,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=a}r(a,t),a.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),Rt=function(r){function a(t){var e=r.call(this,t)||this;return e.image_=null,e}return It(a,r),a.prototype.getImage=function(){return this.image_?this.image_.getImage():null},a.prototype.prepareFrame=function(t){var e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,s=t.viewState,u=s.resolution,c=this.getLayer().getSource(),o=t.viewHints,d=t.extent;if(void 0!==e.extent&&(d=(0,g.Ed)(d,(0,tt.dY)(e.extent,s.projection))),!o[G.Z.ANIMATING]&&!o[G.Z.INTERACTING]&&!(0,g.xb)(d))if(c){var h=s.projection;if(!Tt.j){var x=c.getProjection();x&&(h=x)}var m=c.getImage(d,u,n,h);m&&(this.loadImage(m)?this.image_=m:m.getState()===b.Z.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_},a.prototype.getData=function(t){var e=this.frameState;if(!e)return null;var n=this.getLayer(),s=(0,w.nn)(e.pixelToCoordinateTransform,t.slice()),u=n.getExtent();if(u&&!(0,g.b8)(u,s))return null;var c=this.image_.getExtent(),o=this.image_.getImage(),d=(0,g.dz)(c),h=Math.floor(o.width*((s[0]-c[0])/d));if(h<0||h>=o.width)return null;var x=(0,g.Cr)(c),m=Math.floor(o.height*((c[3]-s[1])/x));return m<0||m>=o.height?null:this.getImageData(o,h,m)},a.prototype.renderFrame=function(t,e){var n=this.image_,s=n.getExtent(),u=n.getResolution(),c=n.getPixelRatio(),o=t.layerStatesArray[t.layerIndex],d=t.pixelRatio,h=t.viewState,x=h.center,Z=t.size,D=d*u/(h.resolution*c),f=Math.round(Z[0]*d),S=Math.round(Z[1]*d),T=h.rotation;if(T){var nt=Math.round(Math.sqrt(f*f+S*S));f=nt,S=nt}(0,w.qC)(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/d,1/d,T,-f/2,-S/2),(0,w.nb)(this.inversePixelTransform,this.pixelTransform);var z=(0,w.BB)(this.pixelTransform);this.useContainer(e,z,o.opacity,this.getBackground(t));var v=this.context,I=v.canvas;I.width!=f||I.height!=S?(I.width=f,I.height=S):this.containerReused||v.clearRect(0,0,f,S);var H=!1,N=!0;if(o.extent){var J=(0,tt.dY)(o.extent,h.projection);(H=(N=(0,g.kK)(J,t.extent))&&!(0,g.r4)(J,t.extent))&&this.clipUnrotated(v,t,J)}var C=n.getImage(),U=(0,w.qC)(this.tempTransform,f/2,S/2,D,D,0,c*(s[0]-x[0])/u,c*(x[1]-s[3])/u);this.renderedResolution=u*d/c;var at=C.width*U[0],st=C.height*U[3];if(this.getLayer().getSource().getInterpolate()||(0,L.f0)(v,q.$),this.preRender(v,t),N&&at>=.5&&st>=.5){var Kt=U[4],qt=U[5],$=o.opacity,ot=void 0;1!==$&&(ot=v.globalAlpha,v.globalAlpha=$),v.drawImage(C,0,0,+C.width,+C.height,Math.round(Kt),Math.round(qt),Math.round(at),Math.round(st)),1!==$&&(v.globalAlpha=ot)}return this.postRender(v,t),H&&v.restore(),(0,L.f0)(v,q.s),z!==I.style.transform&&(I.style.transform=z),this.container},a}(bt.Z);const At=Rt;var Lt=l(8707),Zt=l(9972),Ct=l(3154),Mt=function(){var r=function(a,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])})(a,t)};return function(a,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=a}r(a,t),a.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),kt=function(r){function a(t,e,n,s,u){var c=this;return(c=r.call(this,t,e,n,void 0!==u?b.Z.IDLE:b.Z.LOADED)||this).loader_=void 0!==u?u:null,c.canvas_=s,c.error_=null,c}return Mt(a,r),a.prototype.getError=function(){return this.error_},a.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=b.Z.ERROR):this.state=b.Z.LOADED,this.changed()},a.prototype.load=function(){this.state==b.Z.IDLE&&(this.state=b.Z.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},a.prototype.getImage=function(){return this.canvas_},a}(Ct.Z);const Vt=kt;var Pt=l(2402),Et=function(){var r=function(a,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])})(a,t)};return function(a,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=a}r(a,t),a.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ft=function(r){function a(t){var e=r.call(this,t)||this;return e.vectorRenderer_=new Lt.Z(t),e.layerImageRatio_=t.getImageRatio(),e.coordinateToVectorPixelTransform_=(0,w.Ue)(),e.renderedPixelToCoordinateTransform_=null,e}return Et(a,r),a.prototype.disposeInternal=function(){this.vectorRenderer_.dispose(),r.prototype.disposeInternal.call(this)},a.prototype.getFeatures=function(t){if(!this.vectorRenderer_)return new Promise(function(n){return n([])});var e=(0,w.nn)(this.coordinateToVectorPixelTransform_,(0,w.nn)(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(e)},a.prototype.handleFontsChanged=function(){this.vectorRenderer_.handleFontsChanged()},a.prototype.prepareFrame=function(t){var e=t.pixelRatio,n=t.viewState,s=n.resolution,u=t.viewHints,c=this.vectorRenderer_,o=t.extent;1!==this.layerImageRatio_&&(o=o.slice(0),(0,g.H9)(o,this.layerImageRatio_));var d=(0,g.dz)(o)/s,h=(0,g.Cr)(o)/s;if(!u[G.Z.ANIMATING]&&!u[G.Z.INTERACTING]&&!(0,g.xb)(o)){c.useContainer(null,null,1);var x=c.context,m=(0,L.f0)({},t,{declutterTree:new Pt(9),extent:o,size:[d,h],viewState:(0,L.f0)({},t.viewState,{rotation:0})}),Z=!0,D=new Vt(o,s,e,x.canvas,function(f){c.prepareFrame(m)&&c.replayGroupChanged&&(c.clipping=!1,c.renderFrame(m,null)&&(c.renderDeclutter(m),Z=!1),f())});D.addEventListener(Zt.Z.CHANGE,function(){if(D.getState()===b.Z.LOADED){this.image_=Z?null:D;var f=D.getResolution(),S=D.getPixelRatio(),T=f*e/S;this.renderedResolution=T,this.coordinateToVectorPixelTransform_=(0,w.qC)(this.coordinateToVectorPixelTransform_,d/2,h/2,1/T,-1/T,0,-n.center[0],-n.center[1])}}.bind(this)),D.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice()),!!this.image_},a.prototype.preRender=function(){},a.prototype.postRender=function(){},a.prototype.renderDeclutter=function(){},a.prototype.forEachFeatureAtCoordinate=function(t,e,n,s,u){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,n,s,u):r.prototype.forEachFeatureAtCoordinate.call(this,t,e,n,s,u)},a}(At);const Ot=Ft;var Gt=function(){var r=function(a,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])})(a,t)};return function(a,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=a}r(a,t),a.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}}(),Bt=function(r){function a(t){var e=this,n=t||{},s=(0,L.f0)({},n);return delete s.imageRatio,(e=r.call(this,s)||this).imageRatio_=void 0!==n.imageRatio?n.imageRatio:1,e}return Gt(a,r),a.prototype.getImageRatio=function(){return this.imageRatio_},a.prototype.createRenderer=function(){return new Ot(this)},a}(Dt.Z);const Ut=Bt;var et=l(8894),i=l(5e3),y=l(7579),_t=l(5993),jt=l(520);let it=(()=>{class r{constructor(t){this.http=t,this.apiUrl=_t.n+"api/v1/gtfs_builder/",this.mapContainer=new y.x,this.screenMapBound=new y.x,this.availableAreas=new y.x,this.ErrorapiUrlDataApiFound=new y.x,this.GeoData=new y.x,this.rangeDateData=new y.x,this.GeoDataToMap=new y.x}pullGeoData(t,e,n){this.http.get(this.apiUrl+t.toLowerCase()+"/moving_nodes_by_date?current_date="+e+"&bounds="+n).subscribe({complete:()=>{},error:s=>{this.ErrorapiUrlDataApiFound.next(s.error.message)},next:s=>{this.GeoData.next(s)}})}pullRangeDateData(t){this.http.get(this.apiUrl+t.toLowerCase()+"/range_dates").subscribe({complete:()=>{},error:e=>{this.ErrorapiUrlDataApiFound.next(e.error.message)},next:e=>{this.rangeDateData.next(e)}})}pullAvailableAreas(){this.http.get(this.apiUrl+"/existing_study_areas").subscribe({complete:()=>{},error:t=>{this.ErrorapiUrlDataApiFound.next(t.error.message)},next:t=>{this.availableAreas.next(t)}})}pullGeoDataToMap(t){this.GeoDataToMap.next(t)}}return r.\u0275fac=function(t){return new(t||r)(i.LFG(jt.eN))},r.\u0275prov=i.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var rt=l(9947),Yt=l(2313),zt=l(3686);let B=(()=>{class r{constructor(){this.timeLineInputs=new y.x,this.dateUpdated=new y.x,this.defaultSpeedValue=new y.x,this.updatedSpeedValue=new y.x}pushTimeLineInputs(t,e,n){this.timeLineInputs.next({startDate:t,endDate:e,currentDate:n})}pushDateUpdated(t){this.dateUpdated.next(t)}pushDefaultSpeedValue(t){this.defaultSpeedValue.next(t)}pushUpdatedSpeedValue(t){this.updatedSpeedValue.next(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=i.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var p=l(9255);function Ht(r,a){if(1&r){const t=i.EpF();i.TgZ(0,"div",14)(1,"span",15),i._uU(2,"Vitesse"),i.qZA(),i.TgZ(3,"div",16),i._uU(4,"-"),i.qZA(),i.TgZ(5,"div",17)(6,"input",18),i.NdJ("change",function(n){return i.CHM(t),i.oxw().updateStepValue(n)}),i.qZA()(),i.TgZ(7,"div",16),i._uU(8,"+"),i.qZA()()}if(2&r){const t=i.oxw();i.xp6(6),i.Q6J("min",t.minStepValue)("max",t.maxStepValue)("step",t.minStepValue)("value",t.stepValue)}}let Nt=(()=>{class r{constructor(t,e){this.mapService=t,this.timelineService=e,this.backwardIcon=lt,this.forwardIcon=ct,this.tagIcon=W,this.timelineMarkerFontSize="35",this.sliderHandleTimeStyle=[{from:0,to:7,font_unicode:"\uf186",color:"#4575b4",stroke:"white",description:"La nuit",brightness:60},{from:7,to:11,font_unicode:"\uf185",color:"#fdae61",stroke:"black",description:"Le matin"},{from:11,to:14,font_unicode:"\uf185",color:"#d73027",stroke:"black",description:"Le milieu de journ\xe9e"},{from:14,to:19,font_unicode:"\uf185",color:"#fdae61",stroke:"black",description:"L'apr\xe8s midi"},{from:19,to:24,font_unicode:"\uf186",color:"#4575b4",stroke:"white",description:"Le soir"}],this.brightnessValuesAtEachHours=[.5,.5,.5,.5,.5,.65,.74,.83,.93,1,1,1,1,1,1,1,1,1,1,.93,.83,.72,.65,.5,.5],this.margin={top:10,right:15,bottom:0,left:15},this.width=500,this.height=90,this.selectedDatePosition=0,this.fontSize="14px",this.maxDatePosition=this.width-this.margin.left-this.margin.right,this.stepValue=4e3,this.minStepValue=50,this.timerStep=25,this.mapContainerSubscription=this.mapService.map.subscribe(n=>{this.map=n}),this.defaultSpeedValueSubscription=this.timelineService.defaultSpeedValue.subscribe(n=>{this.stepValue=n,this.maxStepValue=2*n-this.minStepValue}),this.updatedSpeedValueSubscription=this.timelineService.updatedSpeedValue.subscribe(n=>{this.stepValue=n}),this.notifyTimelineSubscription=this.timelineService.timeLineInputs.subscribe(n=>{this.startDate=n.startDate,this.endDate=n.endDate;const s=p.Z1g("%Y-%m-%d %H:%M:%S");this.currentDate=s(n.currentDate),this.buildTimeline()})}ngOnInit(){this.mapService.getMap()}ngOnDestroy(){this.mapContainerSubscription.unsubscribe(),this.notifyTimelineSubscription.unsubscribe(),this.setMapTileBrightness()}updateStepValue(t){this.stepValue=t.target.value}buildTimeline(){p.td_(".slider-bar").remove();const t=p.Ys("#"+this.timeLineId),e=p.Ys("#play-button");this.initDateRange();const n=t.append("g").attr("class","slider-bar").attr("transform",`translate(${this.margin.left},${this.height/2})`);n.append("line").attr("class","track").attr("x1",this.dateRange.range()[0]).attr("x2",this.dateRange.range()[1]).select((o,d,h)=>h[d].parentNode.appendChild(h[d].cloneNode(!0))).attr("class","track-inset").select((o,d,h)=>h[d].parentNode.appendChild(h[d].cloneNode(!0))).attr("class","track-overlay").call(p.ohM().on("drag start",o=>{e.text("Pause"),e.dispatch("click"),this.selectedDatePosition=o.x,this.update(this.dateRange.invert(this.selectedDatePosition)),p.Ys("#timeline-slider .events").selectAll("circle").style("pointer-events","none")}).on("end",o=>{p.Ys("#timeline-slider .events").selectAll("circle").style("pointer-events","all"),null!==this.startDate&&null!==this.endDate&&(this.dateRange.invert(this.selectedDatePosition).toTimeString()===this.endDate.toTimeString()||this.dateRange.invert(this.selectedDatePosition).toTimeString()===this.startDate.toTimeString()?e.text("Play"):e.text("Continue"))})),n.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,21)").selectAll("text").data(this.dateRange.ticks(10)).enter().append("text").attr("x",this.dateRange).attr("y",0).style("font-size",this.fontSize).attr("text-anchor","middle").text(o=>this.formatDateToTimeString(o)),n.insert("g",".track-overlay").attr("class","ticks-line").attr("transform","translate(0,-6)").selectAll("line").data(this.dateRange.ticks(10)).enter().append("line").attr("x1",this.dateRange).attr("x2",this.dateRange).attr("y1",0).attr("y2",12).style("stroke","grey").style("stroke-width","2px"),n.insert("g",".track-overlay").attr("class","trace-events");const u=n.insert("line",".track-overlay").attr("id","trace").attr("x1",this.dateRange(this.startDate)).attr("x2",this.dateRange(this.currentDate));this.sliderDayStyleEnabled?n.insert("text",".track-overlay").attr("id","handle-timeline").attr("class","marker-fontawesome fa-solid").attr("font-size",this.timelineMarkerFontSize):n.insert("circle",".track-overlay").attr("id","handle-timeline").attr("r",10),n.append("g").attr("class","events"),this.update(this.currentDate),this.selectedDatePosition=parseInt(u.attr("x2"))}updateHandleTimelineStyleFromTime(t){let e=t.getHours(),n=this.sliderHandleTimeStyle.filter(s=>e>=s.from&&e<s.to)[0];p.Ys("#handle-timeline").style("fill",n.color).style("stroke",n.stroke).style("stroke-width","1px").text(n.font_unicode),this.setMapTileBrightness(e)}setMapTileBrightness(t){p.td_(".ol-viewport").style("filter",void 0!==t?`brightness(${this.brightnessValuesAtEachHours[t]})`:"unset")}initDateRange(){null!==this.startDate&&null!==this.endDate&&(this.dateRange=p.Xf().domain([this.startDate,this.endDate]).range([0,this.maxDatePosition]).clamp(!0))}formatDateToTimeString(t){return parseInt(p.i$Z("%H")(t))+" h."}formatDate(t){return p.i$Z("%Y-%m-%d %H:%M:%S")(t)}update(t){null!==t&&(this.timelineService.pushDateUpdated(this.formatDate(t)),p.Ys("#trace").attr("x2",this.dateRange(t)),this.currentDate=t,this.sliderDayStyleEnabled?(p.Ys("#handle-timeline").attr("x",this.dateRange(t)),this.updateHandleTimelineStyleFromTime(t)):p.Ys("#handle-timeline").attr("cx",this.dateRange(t)))}step(){this.update(this.dateRange.invert(this.selectedDatePosition)),this.selectedDatePosition=this.selectedDatePosition+this.maxDatePosition/this.stepValue,this.selectedDatePosition>this.maxDatePosition&&this.forwardTimeLine()}startTimeLine(){const t=p.Ys("#play-button");"Pause"===t.html()?(clearInterval(this.timer),t.text("Continue")):(t.html(),this.timer=setInterval(this.step.bind(this),this.timerStep),t.html("Pause"))}resetTimeLine(){p.Ys("#play-button").html("Start"),this.currentDate=this.startDate,this.update(this.startDate),this.selectedDatePosition=0,clearInterval(this.timer)}forwardTimeLine(){p.Ys("#play-button").html("Play"),this.currentDate=this.startDate,this.update(this.endDate),this.selectedDatePosition=0,clearInterval(this.timer)}}return r.\u0275fac=function(t){return new(t||r)(i.Y36(rt.S),i.Y36(B))},r.\u0275cmp=i.Xpm({type:r,selectors:[["app-time-line"]],inputs:{timeLineId:"timeLineId",timeLineSpeedSliderEnabled:"timeLineSpeedSliderEnabled",sliderDayStyleEnabled:"sliderDayStyleEnabled"},decls:20,vars:9,consts:[["id","theme-legend",1,"d-flex","flex-column","flex-lg-row","mt-auto","justify-content-center"],[1,"d-flex","flex-column","justify-content-center","align-items-center"],[3,"id"],[1,"text-center","px-5"],[1,"d-flex","flex-column","justify-content-center","align-items-center","mt-auto"],[1,"mb-2"],["id","slider-value",1,"fw-bold"],[1,"d-flex","flex-row","flex-lg-column","justify-content-center","align-items-center","mt-auto"],[1,"d-flex","flex-row","align-items-center"],["id","start-button","role","button",1,"btn","btn-dark","btn-sm",3,"click"],[3,"icon"],["id","play-button","role","button",1,"btn","btn-dark","mx-2",3,"click"],["id","end-button","role","button",1,"btn","btn-dark","btn-sm",3,"click"],["class","row justify-content-center mt-2",4,"ngIf"],[1,"row","justify-content-center","mt-2"],[1,"fw-bold"],[1,"col-1"],[1,"col-8","px-0"],["id","speed-slider","type","range",1,"form-range",3,"min","max","step","value","change"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0)(1,"div",1)(2,"h6"),i._uU(3,"Barre Temporelle"),i.qZA(),i.O4$(),i._UZ(4,"svg",2),i.qZA(),i.kcU(),i.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"span",6),i._uU(9),i.ALo(10,"date"),i.qZA()(),i.TgZ(11,"div",7)(12,"div",8)(13,"a",9),i.NdJ("click",function(){return e.resetTimeLine()}),i._UZ(14,"fa-icon",10),i.qZA(),i.TgZ(15,"a",11),i.NdJ("click",function(){return e.startTimeLine()}),i._uU(16,"Play"),i.qZA(),i.TgZ(17,"a",12),i.NdJ("click",function(){return e.forwardTimeLine()}),i._UZ(18,"fa-icon",10),i.qZA()(),i.YNc(19,Ht,9,4,"div",13),i.qZA()()()()),2&t&&(i.xp6(4),i.Q6J("id",e.timeLineId),i.uIk("viewBox","0 0 "+e.width+" "+e.height),i.xp6(5),i.Oqu(i.xi3(10,6,e.currentDate,"dd MMMM y HH:mm")),i.xp6(5),i.Q6J("icon",e.backwardIcon),i.xp6(4),i.Q6J("icon",e.forwardIcon),i.xp6(1),i.Q6J("ngIf",e.timeLineSpeedSliderEnabled))},directives:[_.BN,R.O5],pipes:[R.uU],styles:['.events circle{stroke-width:1px;opacity:1;stroke:#f8f8ff}.trace-events circle.trace{fill:#686868;opacity:.7;stroke:#f8f8ff;stroke-width:3px;stroke-opacity:1}.ticks{font-size:10px}.track,.track-inset,.track-overlay{stroke-linecap:round}.track{stroke:#000;stroke-opacity:.3;stroke-width:13px}.track-inset{stroke:#dcdcdc;stroke-width:11px}.track-overlay{pointer-events:stroke;stroke-width:50px;stroke:transparent;cursor:pointer}#handle-timeline{fill:#fff;stroke:#000;stroke-opacity:.5;stroke-width:1.25px}svg #trace{stroke:#6c6c6c;stroke-width:4}#play-button{width:90px}circle.preselected{stroke:#000!important;stroke-width:2px!important}#timeline-slider{width:33em}@media (max-width: 576px){#timeline-slider{width:20em}}#speed-slider{transform:rotate(180deg)}.marker-fontawesome{font-family:"Font Awesome 5 Free";text-anchor:middle;dominant-baseline:middle;pointer-events:none}\n'],encapsulation:2}),r})();function Jt(r,a){if(1&r){const t=i.EpF();i.TgZ(0,"label",7)(1,"input",8),i.NdJ("click",function(){const s=i.CHM(t).$implicit;return i.oxw().updateData(s)}),i.qZA(),i._uU(2),i.qZA()}if(2&r){const t=a.$implicit,e=i.oxw();i.xp6(1),i.Q6J("checked",e.currentArea===t),i.xp6(1),i.hij(" ",t.charAt(0).toUpperCase()+t.slice(1)," ")}}const $t=[{path:"",component:(()=>{class r{constructor(t,e,n,s,u,c){this.dataService=t,this.mapService=e,this.activatedRoute=n,this.titleService=s,this.controlerService=u,this.timelineService=c,this.locationIcon=dt,this.tagIcon=W,this.centerIcon=ut,this.input_data=[{area:"lyon",default_step_value:4e3,zoom:12},{area:"ter",default_step_value:1500,zoom:6},{area:"toulouse",default_step_value:4e3,zoom:12}],this.previousArea=null,this.currentArea=this.input_data[1].area,this.currentstepValue=this.input_data[1].default_step_value,this.currentZoomValue=this.input_data[1].zoom,this.endDate=K.cQ,this.startDate=K.cQ,this.isGeodataCanBeDisplayed=!1,this.isLegendDisplayed=!0,this.popupWidth=100,this.popupHeight=100,this.zoomEventSubscription=this.mapService.zoomEvent.subscribe(o=>{this.mapService.zoomToExtent(this.gtfsLayer.getSource().getExtent(),this.currentZoomValue)}),this.mapSubscription=this.mapService.map.subscribe(o=>{this.map=o}),this.screenMapBoundSubscription=this.mapService.screenMapBound.subscribe(o=>{this.dataBoundingBox=o,this.dataService.pullGeoData(this.currentArea,this.currentDate,this.dataBoundingBox)}),this.pullGeoDataToMapSubscription=this.dataService.GeoDataToMap.subscribe(o=>{this.geoFeaturesData=o,this.refreshSourceLayer(this.gtfsLayer,o,X),this.previousArea!==this.currentArea&&(this.mapService.sendZoomAction(),this.previousArea=this.currentArea)}),this.pullBoundingBoxDataSubscription=this.dataService.rangeDateData.subscribe(o=>{if(this.dataBoundingBox=o.data_bounds,this.startDate=this.parseTime(o.start_date),null!==this.startDate){this.endDate=this.parseTime(o.end_date);const d=new Date;this.currentDate=`${o.start_date.split(" ")[0]} ${d.toISOString().split("T")[1].split(".")[0]}`,this.timelineService.pushTimeLineInputs(this.startDate,this.endDate,this.currentDate)}}),this.dateUpdatedSubscription=this.timelineService.dateUpdated.subscribe(o=>{this.currentDate=o,this.dataService.pullGeoData(this.currentArea,this.currentDate,this.dataBoundingBox)}),this.pullGeoDataSubscription=this.dataService.GeoData.subscribe(o=>{this.geoData=o,null!==this.geoData&&null!==this.currentDate&&this.dataService.pullGeoDataToMap(this.geoData)}),this.pullAvailableAreasSubscription=this.dataService.availableAreas.subscribe(o=>{this.availableArea=o})}ngOnInit(){this.sendResumeSubMenus(),this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap(),this.gtfsLayer=this.buildGtfsLayer(Y),this.dataService.pullAvailableAreas(),this.updateData(this.currentArea),this.innerWidth=window.screen.width,this.innerHeight=window.screen.height}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title),this.titleService.setTitle(this.activatedRoute.snapshot.data.title)}ngOnDestroy(){this.mapSubscription.unsubscribe(),this.pullGeoDataToMapSubscription.unsubscribe(),this.pullBoundingBoxDataSubscription.unsubscribe(),this.pullGeoDataSubscription.unsubscribe(),this.zoomEventSubscription.unsubscribe(),this.screenMapBoundSubscription.unsubscribe(),this.pullAvailableAreasSubscription.unsubscribe(),this.dateUpdatedSubscription.unsubscribe(),this.mapService.removeLayerByName(Y),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}parseTime(t){return new Date(t)}updateData(t){const e=this.input_data.filter(n=>n.area===t);this.currentArea=t,this.currentstepValue=e[0].default_step_value,this.currentZoomValue=e[0].zoom,this.dataService.pullRangeDateData(this.currentArea),this.timelineService.pushDefaultSpeedValue(this.currentstepValue)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}buildGtfsLayer(t){let e=new Ut({source:new et.Z({features:[]}),style:X});return e.set("name",t),this.map.addLayer(e),e}refreshSourceLayer(t,e,n){let s=new et.Z({features:[]}),u=[];e.forEach((d,h)=>{let x=new St.Z({geometry:new wt.Z([d.x,d.y]).transform("EPSG:4326","EPSG:3857"),route_type:d.route_type,route_long_name:d.route_long_name});u.push(x)}),s.addFeatures(u);const o=this.map.getLayers().getArray().filter(d=>d.get("name")===Y);1===o.length&&o[0].setSource(s)}}return r.\u0275fac=function(t){return new(t||r)(i.Y36(it),i.Y36(rt.S),i.Y36(j.gz),i.Y36(Yt.Dx),i.Y36(zt.L),i.Y36(B))},r.\u0275cmp=i.Xpm({type:r,selectors:[["app-map-view"]],decls:15,vars:3,consts:[[1,"row","justify-content-around"],[1,"col-6","col-lg-2","my-2"],[1,"col-lg-12"],["data-toggle","buttons",1,"btn-group","btn-group-toggle"],["class","btn btn-secondary btn-sm",4,"ngFor","ngForOf"],[1,"col-12","col-lg-7","my-2"],["timeLineId","timeline-slider",3,"timeLineSpeedSliderEnabled","sliderDayStyleEnabled"],[1,"btn","btn-secondary","btn-sm"],["type","radio","name","options","id","option1","autocomplete","off",3,"checked","click"]],template:function(t,e){1&t&&(i.TgZ(0,"div",0)(1,"div",1)(2,"h6"),i._uU(3,"GTFS"),i.qZA(),i.TgZ(4,"div",2)(5,"div",3),i.YNc(6,Jt,3,2,"label",4),i.qZA()()(),i.TgZ(7,"div",1)(8,"h6"),i._uU(9,"Modes de transport"),i.qZA(),i.TgZ(10,"div",2)(11,"p"),i._uU(12,"[TODO]"),i.qZA()()(),i.TgZ(13,"div",5),i._UZ(14,"app-time-line",6),i.qZA()()),2&t&&(i.xp6(6),i.Q6J("ngForOf",e.availableArea),i.xp6(8),i.Q6J("timeLineSpeedSliderEnabled",!0)("sliderDayStyleEnabled",!0))},directives:[R.sg,Nt],styles:['.legend-container[_ngcontent-%COMP%]{position:fixed;bottom:0;width:100%}.legend-content[_ngcontent-%COMP%]{color:"#FFFFF";background-color:#f5f5f5;box-shadow:0 -5px 20px #00000080}.legend-title[_ngcontent-%COMP%]{color:"#FFFFF";background-color:#f5f5f5}.map-popup[_ngcontent-%COMP%]{position:absolute;visibility:hidden;background-color:#f8f8ff;width:350px}']}),r})(),data:{title:"GTFS viewer",page:"map-gtfs-viewer"},outlet:"map-gtfs-viewer"}];let Qt=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=i.oAB({type:r}),r.\u0275inj=i.cJS({imports:[[j.Bz.forChild($t)],j.Bz]}),r})(),Wt=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=i.oAB({type:r}),r.\u0275inj=i.cJS({providers:[B],imports:[[R.ez,_.uH]]}),r})(),Xt=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=i.oAB({type:r}),r.\u0275inj=i.cJS({providers:[B,it],imports:[[R.ez,Qt,_.uH,Wt]]}),r})()}}]);