"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[771],{7771:(ne,$,o)=>{o.r($),o.d($,{MapGtfsViewerModule:()=>ee});var A=o(6895),E=o(2216),F=o(646),Z=o(2687),P=o(109),G=o(7392),B=o(5044),U=o(6785);const ht=Z.uYr,pt=Z.Ybx,mt=Z.FGq,gt=Z.TL5,Q=Z.tho;!function ft(){const s=new Date;s.setHours(0,0,0,0)}();const H="gtfs",K="rgb(255, 0, 0)",W="rgb(153, 76, 0)",X="rgb(102, 178, 255)",L="white",I=1.5,xt=new P.ZP({image:new G.Z({radius:4,fill:new B.Z({color:K}),stroke:new U.Z({color:L,width:I})})}),vt=new P.ZP({image:new G.Z({radius:4,fill:new B.Z({color:W}),stroke:new U.Z({color:L,width:I})})}),yt=new P.ZP({image:new G.Z({radius:4,fill:new B.Z({color:X}),stroke:new U.Z({color:L,width:I})})}),bt=new P.ZP({image:new G.Z({radius:4,fill:new B.Z({color:"black"}),stroke:new U.Z({color:L,width:I})})});function q(s){return"0"===s.get("route_type")?vt:"1"===s.get("route_type")?yt:"2"===s.get("route_type")?xt:bt}var tt=o(5017),St=o(3171),Tt=o(187),Dt=o(6107),wt=o(2121),b=o(521),_=o(8587),v=o(483),m=o(760),et=o(6003);const At=class Rt extends wt.Z{constructor(i){super(i),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(i){const e=i.layerStatesArray[i.layerIndex],n=i.pixelRatio,a=i.viewState,l=a.resolution,c=this.getLayer().getSource(),u=i.viewHints;let r=i.extent;if(void 0!==e.extent&&(r=(0,m.Ed)(r,(0,et.dY)(e.extent,a.projection))),!u[_.Z.ANIMATING]&&!u[_.Z.INTERACTING]&&!(0,m.xb)(r))if(c){const h=c.getImage(r,l,n,a.projection);h&&(this.loadImage(h)?this.image_=h:h.getState()===b.Z.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(i){const e=this.frameState;if(!e)return null;const n=this.getLayer(),a=(0,v.nn)(e.pixelToCoordinateTransform,i.slice()),l=n.getExtent();if(l&&!(0,m.b8)(l,a))return null;const c=this.image_.getExtent(),u=this.image_.getImage(),r=(0,m.dz)(c),d=Math.floor(u.width*((a[0]-c[0])/r));if(d<0||d>=u.width)return null;const h=(0,m.Cr)(c),x=Math.floor(u.height*((c[3]-a[1])/h));return x<0||x>=u.height?null:this.getImageData(u,d,x)}renderFrame(i,e){const n=this.image_,a=n.getExtent(),l=n.getResolution(),c=n.getPixelRatio(),u=i.layerStatesArray[i.layerIndex],r=i.pixelRatio,d=i.viewState,h=d.center,O=r*l/(d.resolution*c),w=i.extent,M=d.resolution,S=d.rotation,y=Math.round((0,m.dz)(w)/M*r),T=Math.round((0,m.Cr)(w)/M*r);(0,v.qC)(this.pixelTransform,i.size[0]/2,i.size[1]/2,1/r,1/r,S,-y/2,-T/2),(0,v.nb)(this.inversePixelTransform,this.pixelTransform);const D=(0,v.BB)(this.pixelTransform);this.useContainer(e,D,this.getBackground(i));const f=this.context,R=f.canvas;R.width!=y||R.height!=T?(R.width=y,R.height=T):this.containerReused||f.clearRect(0,0,y,T);let N=!1,j=!0;if(u.extent){const V=(0,et.dY)(u.extent,d.projection);j=(0,m.kK)(V,i.extent),N=j&&!(0,m.r4)(V,i.extent),N&&this.clipUnrotated(f,i,V)}const k=n.getImage(),Y=(0,v.qC)(this.tempTransform,y/2,T/2,O,O,0,c*(a[0]-h[0])/l,c*(h[1]-a[3])/l);this.renderedResolution=l*r/c;const ct=k.width*Y[0],dt=k.height*Y[3];if(this.getLayer().getSource().getInterpolate()||(f.imageSmoothingEnabled=!1),this.preRender(f,i),j&&ct>=.5&&dt>=.5){const V=Y[4],ie=Y[5],J=u.opacity;let ut;1!==J&&(ut=f.globalAlpha,f.globalAlpha=J),f.drawImage(k,0,0,+k.width,+k.height,V,ie,ct,dt),1!==J&&(f.globalAlpha=ut)}return this.postRender(f,i),N&&f.restore(),f.imageSmoothingEnabled=!0,D!==R.style.transform&&(R.style.transform=D),this.container}};var Zt=o(5513),it=o(9972),Lt=o(8007),nt=o(119);const Ct=class It extends Lt.Z{constructor(i,e,n,a){super(),this.extent=i,this.pixelRatio_=n,this.resolution=e,this.state=a}changed(){this.dispatchEvent(it.Z.CHANGE)}getExtent(){return this.extent}getImage(){return(0,nt.O3)()}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){(0,nt.O3)()}},kt=class Mt extends Ct{constructor(i,e,n,a,l){super(i,e,n,void 0!==l?b.Z.IDLE:b.Z.LOADED),this.loader_=void 0!==l?l:null,this.canvas_=a,this.error_=null}getError(){return this.error_}handleLoad_(i){i?(this.error_=i,this.state=b.Z.ERROR):this.state=b.Z.LOADED,this.changed()}load(){this.state==b.Z.IDLE&&(this.state=b.Z.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}};var Vt=o(2402);const Ft=class Et extends At{constructor(i){super(i),this.vectorRenderer_=new Zt.Z(i),this.layerImageRatio_=i.getImageRatio(),this.coordinateToVectorPixelTransform_=(0,v.Ue)(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(i){if(!this.vectorRenderer_)return new Promise(n=>n([]));const e=(0,v.nn)(this.coordinateToVectorPixelTransform_,(0,v.nn)(this.renderedPixelToCoordinateTransform_,i.slice()));return this.vectorRenderer_.getFeatures(e)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(i){const e=i.pixelRatio,n=i.viewState,a=n.resolution,l=i.viewHints,c=this.vectorRenderer_;let u=i.extent;1!==this.layerImageRatio_&&(u=u.slice(0),(0,m.H9)(u,this.layerImageRatio_));const r=(0,m.dz)(u)/a,d=(0,m.Cr)(u)/a;if(!l[_.Z.ANIMATING]&&!l[_.Z.INTERACTING]&&!(0,m.xb)(u)){c.useContainer(null,null);const h=c.context,x=i.layerStatesArray[i.layerIndex];h.globalAlpha=x.opacity;const O=Object.assign({},x,{opacity:1}),w=Object.assign({},i,{declutterTree:new Vt(9),extent:u,size:[r,d],viewState:Object.assign({},i.viewState,{rotation:0}),layerStatesArray:[O],layerIndex:0});let M=!0;const S=new kt(u,a,e,h.canvas,function(y){c.prepareFrame(w)&&c.replayGroupChanged&&(c.clipping=!1,c.renderFrame(w,null)&&(c.renderDeclutter(w),M=!1),y())});S.addEventListener(it.Z.CHANGE,function(){if(S.getState()!==b.Z.LOADED)return;this.image_=M?null:S;const y=S.getResolution(),T=S.getPixelRatio(),D=y*e/T;this.renderedResolution=D,this.coordinateToVectorPixelTransform_=(0,v.qC)(this.coordinateToVectorPixelTransform_,r/2,d/2,1/D,-1/D,0,-n.center[0],-n.center[1])}.bind(this)),S.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=i.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(i,e,n,a,l){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(i,e,n,a,l):super.forEachFeatureAtCoordinate(i,e,n,a,l)}},Gt=class Pt extends Dt.Z{constructor(i){i=i||{};const e=Object.assign({},i);delete e.imageRatio,super(e),this.imageRatio_=void 0!==i.imageRatio?i.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new Ft(this)}};var st=o(5947),t=o(4650),g=o(7579),Bt=o(5993),Ut=o(529);let at=(()=>{class s{constructor(e){this.http=e,this.apiUrl=Bt.n+"api/v1/gtfs_builder/",this.mapContainer=new g.x,this.screenMapBound=new g.x,this.availableAreas=new g.x,this.availableRouteTypes=new g.x,this.ErrorapiUrlDataApiFound=new g.x,this.GeoData=new g.x,this.rangeDateData=new g.x,this.GeoDataToMap=new g.x}pullGeoData(e,n,a){this.http.get(this.apiUrl+e.toLowerCase()+"/moving_nodes_by_date?current_date="+n+"&bounds="+a).subscribe({complete:()=>{},error:l=>{this.ErrorapiUrlDataApiFound.next(l.error.message)},next:l=>{this.GeoData.next(l)}})}pullRangeDateData(e){this.http.get(this.apiUrl+e.toLowerCase()+"/range_dates").subscribe({complete:()=>{},error:n=>{this.ErrorapiUrlDataApiFound.next(n.error.message)},next:n=>{this.rangeDateData.next(n)}})}pullAvailableAreas(){this.http.get(this.apiUrl+"/existing_study_areas").subscribe({complete:()=>{},error:e=>{this.ErrorapiUrlDataApiFound.next(e.error.message)},next:e=>{this.availableAreas.next(e)}})}pullAvailableRouteTypes(e){this.http.get(this.apiUrl+e.toLowerCase()+"/route_types").subscribe({complete:()=>{},error:n=>{this.ErrorapiUrlDataApiFound.next(n.error.message)},next:n=>{this.availableRouteTypes.next(n)}})}pullGeoDataToMap(e){this.GeoDataToMap.next(e)}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(Ut.eN))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var rt=o(9947),_t=o(1481),zt=o(3686);let z=(()=>{class s{constructor(){this.timeLineInputs=new g.x,this.dateUpdated=new g.x,this.defaultSpeedValue=new g.x,this.updatedSpeedValue=new g.x}pushTimeLineInputs(e,n,a){this.timeLineInputs.next({startDate:e,endDate:n,currentDate:a})}pushDateUpdated(e){this.dateUpdated.next(e)}pushDefaultSpeedValue(e){this.defaultSpeedValue.next(e)}pushUpdatedSpeedValue(e){this.updatedSpeedValue.next(e)}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var p=o(9255),ot=o(942),Ot=o(6298);function Yt(s,i){if(1&s){const e=t.EpF();t.O4$(),t.kcU(),t.TgZ(0,"div",5)(1,"div",6)(2,"a",7),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.resetTimeLine())}),t._UZ(3,"fa-icon",8),t.qZA(),t.TgZ(4,"a",9),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.startTimeLine())}),t._uU(5,"Play"),t.qZA(),t.TgZ(6,"a",10),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.forwardTimeLine())}),t._UZ(7,"fa-icon",8),t.qZA()(),t.TgZ(8,"h6",11),t._uU(9,"Vitesse"),t.qZA(),t.TgZ(10,"div",12)(11,"div",13),t._uU(12,"-"),t.qZA(),t.TgZ(13,"div",14)(14,"input",15),t.NdJ("change",function(a){t.CHM(e);const l=t.oxw();return t.KtG(l.updateStepValue(a))}),t.qZA()(),t.TgZ(15,"div",13),t._uU(16,"+"),t.qZA()()()}if(2&s){const e=t.oxw();t.xp6(3),t.Q6J("icon",e.backwardIcon),t.xp6(4),t.Q6J("icon",e.forwardIcon),t.xp6(7),t.Q6J("min",e.minStepValue)("max",e.maxStepValue)("step",e.minStepValue)("value",e.stepValue)}}let Ht=(()=>{class s{constructor(e,n){this.mapService=e,this.timelineService=n,this.backwardIcon=ht,this.forwardIcon=pt,this.tagIcon=Q,this.timelineMarkerFontSize="35",this.sliderHandleTimeStyle=[{from:0,to:7,font_unicode:"\uf186",color:"#4575b4",stroke:"white",description:"La nuit",brightness:60},{from:7,to:11,font_unicode:"\uf185",color:"#fdae61",stroke:"black",description:"Le matin"},{from:11,to:14,font_unicode:"\uf185",color:"#d73027",stroke:"black",description:"Le milieu de journ\xe9e"},{from:14,to:19,font_unicode:"\uf185",color:"#fdae61",stroke:"black",description:"L'apr\xe8s midi"},{from:19,to:24,font_unicode:"\uf186",color:"#4575b4",stroke:"white",description:"Le soir"}],this.brightnessValuesAtEachHours=[.5,.5,.5,.5,.5,.65,.74,.83,.93,1,1,1,1,1,1,1,1,1,1,.93,.83,.72,.65,.5,.5],this.margin={top:10,right:15,bottom:0,left:15},this.width=500,this.height=75,this.selectedDatePosition=0,this.fontSize="14px",this.maxDatePosition=this.width-this.margin.left-this.margin.right,this.stepValue=4e3,this.minStepValue=50,this.timerStep=25,this.mapContainerSubscription=this.mapService.map.subscribe(a=>{this.map=a}),this.defaultSpeedValueSubscription=this.timelineService.defaultSpeedValue.subscribe(a=>{this.stepValue=a,this.maxStepValue=2*a-this.minStepValue}),this.updatedSpeedValueSubscription=this.timelineService.updatedSpeedValue.subscribe(a=>{this.stepValue=a}),this.notifyTimelineSubscription=this.timelineService.timeLineInputs.subscribe(a=>{this.startDate=a.startDate,this.endDate=a.endDate;const l=p.Z1g("%Y-%m-%d %H:%M:%S");this.currentDate=l(a.currentDate),this.buildTimeline()})}ngOnInit(){this.mapService.getMap()}ngOnDestroy(){this.mapContainerSubscription.unsubscribe(),this.notifyTimelineSubscription.unsubscribe(),this.setMapTileBrightness()}updateStepValue(e){this.stepValue=e.target.value}buildTimeline(){p.td_(".slider-bar").remove();const e=p.Ys("#"+this.timeLineId),n=p.Ys("#play-button");this.initDateRange();const a=e.append("g").attr("class","slider-bar").attr("transform",`translate(${this.margin.left},${this.height/2})`);a.append("line").attr("class","track").attr("x1",this.dateRange.range()[0]).attr("x2",this.dateRange.range()[1]).select((r,d,h)=>h[d].parentNode.appendChild(h[d].cloneNode(!0))).attr("class","track-inset").select((r,d,h)=>h[d].parentNode.appendChild(h[d].cloneNode(!0))).attr("class","track-overlay").call(p.ohM().on("drag start",r=>{n.text("Pause"),n.dispatch("click"),this.selectedDatePosition=r.x,this.update(this.dateRange.invert(this.selectedDatePosition)),p.Ys("#timeline-slider .events").selectAll("circle").style("pointer-events","none")}).on("end",r=>{p.Ys("#timeline-slider .events").selectAll("circle").style("pointer-events","all"),null!==this.startDate&&null!==this.endDate&&(this.dateRange.invert(this.selectedDatePosition).toTimeString()===this.endDate.toTimeString()||this.dateRange.invert(this.selectedDatePosition).toTimeString()===this.startDate.toTimeString()?n.text("Play"):n.text("Continue"))})),a.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,21)").selectAll("text").data(this.dateRange.ticks(10)).enter().append("text").attr("x",this.dateRange).attr("y",0).style("font-size",this.fontSize).attr("text-anchor","middle").text(r=>this.formatDateToTimeString(r)),a.insert("g",".track-overlay").attr("class","ticks-line").attr("transform","translate(0,-6)").selectAll("line").data(this.dateRange.ticks(10)).enter().append("line").attr("x1",this.dateRange).attr("x2",this.dateRange).attr("y1",0).attr("y2",12).style("stroke","grey").style("stroke-width","2px"),a.insert("g",".track-overlay").attr("class","trace-events");const c=a.insert("line",".track-overlay").attr("id","trace").attr("x1",this.dateRange(this.startDate)).attr("x2",this.dateRange(this.currentDate));this.sliderDayStyleEnabled?a.insert("text",".track-overlay").attr("id","handle-timeline").attr("class","marker-fontawesome fa-solid").attr("font-size",this.timelineMarkerFontSize):a.insert("circle",".track-overlay").attr("id","handle-timeline").attr("r",10),a.append("g").attr("class","events"),this.update(this.currentDate),this.selectedDatePosition=parseInt(c.attr("x2"))}updateHandleTimelineStyleFromTime(e){let n=e.getHours(),a=this.sliderHandleTimeStyle.filter(l=>n>=l.from&&n<l.to)[0];p.Ys("#handle-timeline").style("fill",a.color).style("stroke",a.stroke).style("stroke-width","1px").text(a.font_unicode),this.setMapTileBrightness(n)}setMapTileBrightness(e){p.td_(".ol-layer").style("filter",typeof e<"u"?`brightness(${this.brightnessValuesAtEachHours[e]})`:"unset")}initDateRange(){null!==this.startDate&&null!==this.endDate&&(this.dateRange=p.Xf().domain([this.startDate,this.endDate]).range([0,this.maxDatePosition]).clamp(!0))}formatDateToTimeString(e){return parseInt(p.i$Z("%H")(e))+" h."}formatDate(e){return p.i$Z("%Y-%m-%d %H:%M:%S")(e)}update(e){null!==e&&(this.timelineService.pushDateUpdated(this.formatDate(e)),p.Ys("#trace").attr("x2",this.dateRange(e)),this.currentDate=e,this.sliderDayStyleEnabled?(p.Ys("#handle-timeline").attr("x",this.dateRange(e)),this.updateHandleTimelineStyleFromTime(e)):p.Ys("#handle-timeline").attr("cx",this.dateRange(e)))}step(){this.update(this.dateRange.invert(this.selectedDatePosition)),this.selectedDatePosition=this.selectedDatePosition+this.maxDatePosition/this.stepValue,this.selectedDatePosition>this.maxDatePosition&&this.forwardTimeLine()}startTimeLine(){const e=p.Ys("#play-button");"Pause"===e.html()?(clearInterval(this.timer),e.text("Continue")):(e.html(),this.timer=setInterval(this.step.bind(this),this.timerStep),e.html("Pause"))}resetTimeLine(){p.Ys("#play-button").html("Start"),this.currentDate=this.startDate,this.update(this.startDate),this.selectedDatePosition=0,clearInterval(this.timer)}forwardTimeLine(){p.Ys("#play-button").html("Play"),this.currentDate=this.startDate,this.update(this.endDate),this.selectedDatePosition=0,clearInterval(this.timer)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(rt.S),t.Y36(z))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-time-line"]],inputs:{timeLineId:"timeLineId",timeLineSpeedSliderEnabled:"timeLineSpeedSliderEnabled",sliderDayStyleEnabled:"sliderDayStyleEnabled"},decls:10,vars:7,consts:[[1,"d-flex","flex-xl-row","flex-column"],["classes","text-bg-secondary"],[1,"d-flex","flex-row","justify-content-center"],[3,"id"],["class","d-flex flex-column justify-content-center m-2",4,"ngIf"],[1,"d-flex","flex-column","justify-content-center","m-2"],[1,"d-flex","flex-row","justify-content-center","align-items-center"],["id","start-button","role","button",1,"btn","btn-sm","btn-dark",3,"click"],[3,"icon"],["id","play-button","role","button",1,"btn","btn-dark","mx-2",3,"click"],["id","end-button","role","button",1,"btn","btn-sm","btn-dark",3,"click"],[1,"mt-3"],[1,"d-flex","flex-row","align-self-center"],[1,"fw-bold"],[1,"px-1"],["id","speed-slider","type","range",1,"form-range",3,"min","max","step","value","change"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"set-section-container")(2,"h6"),t._uU(3,"Barre Temporelle"),t.qZA(),t.TgZ(4,"set-badge-content",1),t._uU(5),t.ALo(6,"date"),t.qZA(),t.TgZ(7,"div",2),t.O4$(),t._UZ(8,"svg",3),t.qZA()(),t.YNc(9,Yt,17,6,"div",4),t.qZA()),2&e&&(t.xp6(5),t.Oqu(t.xi3(6,4,n.currentDate,"dd MMMM y HH:mm")),t.xp6(3),t.Q6J("id",n.timeLineId),t.uIk("viewBox","0 10 "+n.width+" "+n.height),t.xp6(1),t.Q6J("ngIf",n.timeLineSpeedSliderEnabled))},dependencies:[A.O5,E.BN,ot.d,Ot.H,A.uU],styles:['.events circle{stroke-width:1px;opacity:1;stroke:#f8f8ff}.trace-events circle.trace{fill:#686868;opacity:.7;stroke:#f8f8ff;stroke-width:3px;stroke-opacity:1}.ticks{font-size:10px}.track,.track-inset,.track-overlay{stroke-linecap:round}.track{stroke:#000;stroke-opacity:.3;stroke-width:13px}.track-inset{stroke:#dcdcdc;stroke-width:11px}.track-overlay{pointer-events:stroke;stroke-width:50px;stroke:transparent;cursor:pointer}#handle-timeline{fill:#fff;stroke:#000;stroke-opacity:.5;stroke-width:1.25px}svg #trace{stroke:#6c6c6c;stroke-width:4}#play-button{width:90px}circle.preselected{stroke:#000!important;stroke-width:2px!important}#timeline-slider{width:33em}@media (max-width: 576px){#timeline-slider{width:20em}}#speed-slider{transform:rotate(180deg)}.marker-fontawesome{font-family:"Font Awesome 5 Free";text-anchor:middle;dominant-baseline:middle;pointer-events:none}\n'],encapsulation:2}),s})();var Nt=o(485),jt=o(6423);function Jt(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"button",3),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.zoomOnData())}),t._UZ(1,"fa-icon",4),t.qZA()}if(2&s){const e=t.oxw();t.xp6(1),t.Q6J("icon",e.centerIcon)}}function $t(s,i){if(1&s){const e=t.EpF();t.ynx(0),t.TgZ(1,"set-button-content",10),t.NdJ("click",function(){const l=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.updateData(l))}),t._uU(2),t.qZA(),t.BQk()}if(2&s){const e=i.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("classes",n.currentArea===e?"btn-sm btn-warning fw-bold":"btn-sm btn-warning"),t.xp6(1),t.hij("",e.charAt(0).toUpperCase()+e.slice(1)," ")}}function Qt(s,i){if(1&s&&(t.O4$(),t.TgZ(0,"g"),t._UZ(1,"circle"),t.TgZ(2,"text",11),t._uU(3),t.qZA()()),2&s){const e=i.$implicit,n=t.oxw(2);t.xp6(1),t.uIk("r",n.routeTypesLegendData.circleR)("cx",n.routeTypesLegendData.circleCxPos)("cy",e.cy)("fill",e.color)("stroke",e.strokeColor),t.xp6(1),t.uIk("x",n.routeTypesLegendData.textXPos)("y",e.cy)("font-size",n.routeTypesLegendData.fontSize),t.xp6(1),t.hij("",e.label," ")}}function Kt(s,i){if(1&s&&(t.TgZ(0,"div",5)(1,"set-section-container")(2,"h6"),t._uU(3,"GTFS"),t.qZA(),t.TgZ(4,"div",6),t.YNc(5,$t,3,2,"ng-container",7),t.qZA()(),t.TgZ(6,"set-section-container")(7,"h6"),t._uU(8,"Modes de transport"),t.qZA(),t.O4$(),t.TgZ(9,"svg",8),t.YNc(10,Qt,4,9,"g",7),t.qZA()()(),t.kcU(),t.TgZ(11,"set-section-container"),t._UZ(12,"app-time-line",9),t.qZA()),2&s){const e=t.oxw();t.xp6(5),t.Q6J("ngForOf",e.availableArea),t.xp6(4),t.uIk("viewBox","0 0 "+e.widthLegendElement+" "+e.heightLegendElement),t.xp6(1),t.Q6J("ngForOf",e.routeTypesLegendData.features),t.xp6(2),t.Q6J("timeLineSpeedSliderEnabled",!0)("sliderDayStyleEnabled",!0)}}const Wt=[{path:"",component:(()=>{class s{constructor(e,n,a,l,c,u){this.dataService=e,this.mapService=n,this.activatedRoute=a,this.titleService=l,this.controlerService=c,this.timelineService=u,this.locationIcon=mt,this.tagIcon=Q,this.centerIcon=gt,this.input_data=[{area:"lyon",default_step_value:4e3,zoom:12},{area:"ter",default_step_value:1500,zoom:6},{area:"toulouse",default_step_value:4e3,zoom:12}],this.widthLegendElement=100,this.heightLegendElement=80,this.heightMoveLegendElement=60,this.routeTypesLegendData={circleR:8,circleCxPos:20,fontSize:"12px",circleStrokeColor:L,circleStrokeWidth:I,textXPos:35,features:[{dataValue:"0",cy:22,label:"Tram",color:W},{dataValue:"1",cy:44,label:"M\xe9tro",color:X},{dataValue:"2",cy:66,label:"Train",color:K}]},this.previousArea=null,this.currentArea=this.input_data[1].area,this.currentstepValue=this.input_data[1].default_step_value,this.currentZoomValue=this.input_data[1].zoom,this.endDate=tt.cQ,this.startDate=tt.cQ,this.isGeodataCanBeDisplayed=!1,this.isLegendDisplayed=!0,this.currentRouteTypes=[],this.popupWidth=100,this.popupHeight=100,this.zoomEventSubscription=this.mapService.zoomEvent.subscribe(r=>{this.mapService.zoomToExtent(this.gtfsLayer.getSource().getExtent(),this.currentZoomValue)}),this.mapSubscription=this.mapService.map.subscribe(r=>{this.map=r}),this.screenMapBoundSubscription=this.mapService.screenMapBound.subscribe(r=>{this.dataBoundingBox=r,this.dataService.pullGeoData(this.currentArea,this.currentDate,this.dataBoundingBox)}),this.pullGeoDataToMapSubscription=this.dataService.GeoDataToMap.subscribe(r=>{this.geoFeaturesData=r,this.refreshSourceLayer(this.gtfsLayer,r,q),this.previousArea!==this.currentArea&&(this.mapService.sendZoomAction(),this.previousArea=this.currentArea)}),this.pullAvailableRouteTypeSubscription=this.dataService.availableRouteTypes.subscribe(r=>{this.currentRouteTypes=r}),this.pullBoundingBoxDataSubscription=this.dataService.rangeDateData.subscribe(r=>{if(this.dataBoundingBox=r.data_bounds,this.startDate=this.parseTime(r.start_date),null!==this.startDate){this.endDate=this.parseTime(r.end_date);const d=new Date;this.currentDate=`${r.start_date.split(" ")[0]} ${d.toISOString().split("T")[1].split(".")[0]}`,this.timelineService.pushTimeLineInputs(this.startDate,this.endDate,this.currentDate)}}),this.dateUpdatedSubscription=this.timelineService.dateUpdated.subscribe(r=>{this.currentDate=r,this.dataService.pullGeoData(this.currentArea,this.currentDate,this.dataBoundingBox)}),this.pullGeoDataSubscription=this.dataService.GeoData.subscribe(r=>{this.geoData=r,null!==this.geoData&&null!==this.currentDate&&this.dataService.pullGeoDataToMap(this.geoData)}),this.pullAvailableAreasSubscription=this.dataService.availableAreas.subscribe(r=>{this.availableArea=r})}ngOnInit(){this.sendResumeSubMenus(),this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap(),this.gtfsLayer=this.buildGtfsLayer(H),this.dataService.pullAvailableAreas(),this.innerWidth=window.screen.width,this.innerHeight=window.screen.height}ngAfterViewInit(){this.updateData(this.currentArea)}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title),this.titleService.setTitle(this.activatedRoute.snapshot.data.title)}ngOnDestroy(){this.mapSubscription.unsubscribe(),this.pullGeoDataToMapSubscription.unsubscribe(),this.pullBoundingBoxDataSubscription.unsubscribe(),this.pullGeoDataSubscription.unsubscribe(),this.zoomEventSubscription.unsubscribe(),this.screenMapBoundSubscription.unsubscribe(),this.pullAvailableAreasSubscription.unsubscribe(),this.dateUpdatedSubscription.unsubscribe(),this.pullAvailableRouteTypeSubscription.unsubscribe(),this.mapService.removeLayerByName(H),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}zoomOnData(){this.mapService.sendZoomAction()}parseTime(e){return new Date(e)}updateData(e){const n=this.input_data.filter(a=>a.area===e);this.currentArea=e,this.currentstepValue=n[0].default_step_value,this.currentZoomValue=n[0].zoom,this.dataService.pullRangeDateData(this.currentArea),this.timelineService.pushDefaultSpeedValue(this.currentstepValue)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}buildGtfsLayer(e){let n=new Gt({source:new st.Z({features:[]}),style:q});return n.set("name",e),this.map.addLayer(n),n}refreshSourceLayer(e,n,a){let l=new st.Z({features:[]}),c=[];n.forEach((d,h)=>{let x=new St.Z({geometry:new Tt.Z([d.x,d.y]).transform("EPSG:4326","EPSG:3857"),route_type:d.route_type,route_long_name:d.route_long_name});c.push(x)}),l.addFeatures(c);const r=this.map.getLayers().getArray().filter(d=>d.get("name")===H);1===r.length&&r[0].setSource(l)}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(at),t.Y36(rt.S),t.Y36(F.gz),t.Y36(_t.Dx),t.Y36(zt.L),t.Y36(z))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-map-view"]],decls:5,vars:0,consts:[["classes","position-fixed"],["buttonsTemplate",""],["controlersTemplate",""],["title","Centrer","type","button","checked","","autocomplete","off",1,"btn","btn-sm","btn-warning","mx-1",3,"click"],[1,"",3,"icon"],[1,"d-flex","flex-row","justify-content-around"],[1,"d-flex","flex-xl-row","flex-column"],[4,"ngFor","ngForOf"],["id","routeTypeLegend"],["timeLineId","timeline-slider",3,"timeLineSpeedSliderEnabled","sliderDayStyleEnabled"],[3,"classes","click"],[1,"label"]],template:function(e,n){1&e&&(t.TgZ(0,"set-legend-container",0),t.YNc(1,Jt,2,1,"ng-template",null,1,t.W1O),t.YNc(3,Kt,13,5,"ng-template",null,2,t.W1O),t.qZA())},dependencies:[A.sg,E.BN,Ht,ot.d,Nt.C,jt.b],styles:['.legend-content[_ngcontent-%COMP%]{color:"#FFFFF";background-color:#f5f5f5;box-shadow:0 -5px 20px #00000080}.legend-title[_ngcontent-%COMP%]{color:"#FFFFF";background-color:#f5f5f5}.map-popup[_ngcontent-%COMP%]{position:absolute;visibility:hidden;background-color:#f8f8ff;width:350px}svg[_ngcontent-%COMP%]{width:7em}.label[_ngcontent-%COMP%]{text-anchor:start;dominant-baseline:middle}']}),s})(),data:{title:"GTFS viewer",page:"map-gtfs-viewer"},outlet:"map-gtfs-viewer"}];let Xt=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[F.Bz.forChild(Wt),F.Bz]}),s})();var qt=o(4586),lt=o(7157);let te=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({providers:[z],imports:[A.ez,E.uH,qt.Dt,F.Bz,lt.p]}),s})(),ee=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({providers:[z,at],imports:[A.ez,Xt,E.uH,te,lt.p]}),s})()}}]);