"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[205],{205:(ie,G,c)=>{c.r(G),c.d(G,{MapActivitiesModule:()=>qt});var y=c(6895),_=c(2216),O=c(646),it=c(4004),L=c(3171),U=c(7053),J=c(5947),k=c(187),nt=c(3324),st=c(6597),ot=c(3620),rt=c(483),at=c(8377),N=c(6003),lt=c(6527),l=c(9255),h=c(8227),M=c(109),S=c(7392),w=c(5044),x=c(6785);const g="activities",P="travel",A="legendActivity",$="slider-bar",b="white",mt=new S.Z({radius:0,fill:new w.Z({color:h.Cm}),stroke:new x.Z({color:b,width:2})}),ut=new S.Z({radius:0,fill:new w.Z({color:h.bj}),stroke:new x.Z({color:b,width:2})}),ht=new S.Z({radius:0,fill:new w.Z({color:h.C1}),stroke:new x.Z({color:b,width:2})});function j(i){let o;return o="job"===i.type?mt.clone():"education"===i.type?ut.clone():ht.clone(),o.setRadius(2*i.months),new M.ZP({image:o})}function B(i){return new M.ZP({image:new S.Z({radius:i,fill:new w.Z({color:"rgba(255, 215, 0, 0.6)"}),stroke:new x.Z({color:"black",width:2})})})}const Y="black",Q="yellow",wt=new M.ZP({stroke:new x.Z({width:4,color:"black"})}),bt=new M.ZP({image:new S.Z({radius:2,fill:new w.Z({color:"black"}),stroke:new x.Z({color:Y,width:1})})}),V=new M.ZP({image:new S.Z({radius:7,fill:new w.Z({color:Q}),stroke:new x.Z({color:Y,width:3})})}),W=i=>"route"===i?wt:"limit"===i?bt:V;function I(i,o,e,n){return i.getLayers().getArray().filter(p=>p.get("name")===o)[0].getSource().getFeatures().filter(p=>p.get(n)===e)[0]}var E=c(8453),D=c(2687),H=c(1733),t=c(4650),X=c(9947),T=c(7579),Dt=c(529);let R=(()=>{class i{constructor(e){this.http=e,this.apiUrlActivitiesGeoData=E.JW+"activities_geodata",this.ErrorapiUrlActivitiesGeoDataApiFound=new T.x,this.activitiesGeoData=new T.x,this.dataToMap=new T.x,this.dateNotified=new T.x,this.timelineBuild=new T.x,this.activitiesGeoDataToMap=new T.x,this.tripsGeoDataToMap=new T.x}pullActivitiesGeoData(){this.http.get(this.apiUrlActivitiesGeoData).subscribe({complete:()=>{},error:e=>{this.ErrorapiUrlActivitiesGeoDataApiFound.next(e.error.message)},next:e=>{this.activitiesGeoData.next(e)}})}pullDataToMap(e){this.dataToMap.next(e)}pullActivitiesGeoDataToMap(e){this.activitiesGeoDataToMap.next(e)}pullTripsGeoDataToMap(e){this.tripsGeoDataToMap.next(e)}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(Dt.eN))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Ct=c(1481),Lt=c(3686),Mt=c(6423),K=c(942);function Zt(i,o){if(1&i&&(t.O4$(),t._UZ(0,"circle")),2&i){const e=o.$implicit,n=t.oxw();t.Tol(e.class),t.uIk("r",n.activityTypesLegendData.circleR)("cx",n.activityTypesLegendData.circleCxPos)("cy",e.cy)("fill",e.color)("stroke",e.strokeColor)}}function kt(i,o){if(1&i&&(t.O4$(),t.TgZ(0,"text"),t._uU(1),t.qZA()),2&i){const e=o.$implicit,n=t.oxw();t.Tol(e.class+" label"),t.uIk("x",n.activityTypesLegendData.textXPos)("y",e.cy)("font-size",n.fontSize),t.xp6(1),t.hij("",e.label," ")}}function Pt(i,o){if(1&i&&(t.O4$(),t._UZ(0,"circle",7)),2&i){const e=o.$implicit,n=t.oxw();t.uIk("r",e)("cx",n.activityMonthLegendData.circleCxPos)("cy",e)}}function At(i,o){if(1&i&&(t.O4$(),t.TgZ(0,"text",8),t._uU(1),t.qZA()),2&i){const e=o.$implicit,n=t.oxw();t.uIk("x",n.activityMonthLegendData.textXPos)("y",2*e)("font-size",n.fontSize),t.xp6(1),t.hij("",e," mois ")}}function It(i,o){if(1&i&&(t.O4$(),t._UZ(0,"line",9)),2&i){const e=o.$implicit;t.uIk("y1",2*e+2)("y2",2*e+2)}}function _t(i,o){if(1&i&&(t.O4$(),t._UZ(0,"line")),2&i){const e=o.$implicit;t.Tol(e.classLine),t.uIk("x1",e.x1)("x2",e.x2)("y1",e.y1)("y2",e.y2)("strokeColor",e.strokeColor)}}function Ot(i,o){if(1&i&&(t.O4$(),t._UZ(0,"circle")),2&i){const e=o.$implicit;t.Tol(e.classMarker),t.uIk("r",e.r)("cx",e.y2/2)("cy",e.y2/2)("color",e.circleColor)("strokeColor",e.strokeColor)}}function Nt(i,o){if(1&i&&(t.O4$(),t._UZ(0,"text")),2&i){const e=o.$implicit,n=t.oxw();t.uIk("x",e.y2/2)("y",e.y2/2)("font-size",n.movesLineLegendData.markerFontSize)}}function Ft(i,o){if(1&i&&(t.O4$(),t.TgZ(0,"text",8),t._uU(1),t.qZA()),2&i){const e=o.$implicit,n=t.oxw();t.uIk("x",n.movesLineLegendData.textXPos)("y",e.y2/2)("font-size",n.fontSize),t.xp6(1),t.hij("",e.label," ")}}let Yt=(()=>{class i{constructor(){this.sliderBarId=$,this.legendActivitiesId=A,this.widthLegendElement=200,this.heightLegendElement=140,this.heightMoveLegendElement=60,this.fontSize="19px",this.activityMonthLegendData={circleMonthR:[40,20,10],circleCxPos:50,textXPos:120},this.activityTypesLegendData={circleR:18,circleCxPos:20,textXPos:50,circleJobs:[{cy:25,class:"education",label:"Formations",color:h.bj,strokeColor:b},{cy:70,class:"job",label:"Entreprises",color:h.Cm,strokeColor:b},{cy:115,class:"volunteer",label:"B\xe9n\xe9volat",color:h.C1,strokeColor:b}]},this.movesLineLegendData={textXPos:50,markerFontSize:"12px",moves:[{x1:0,x2:45,y1:0,y2:45,r:12,classLine:"train-line",classMarker:"train-marker",classMarkerText:"train-marker-text",label:"Train",circleColor:Q,strokeColor:Y}]}}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-theme-legend"]],decls:22,vars:13,consts:[["id","theme-legend",1,"d-flex","flex-row","justify-content-around"],[3,"id"],[3,"class",4,"ngFor","ngForOf"],["class","activity-months",4,"ngFor","ngForOf"],["class","label",4,"ngFor","ngForOf"],["x1","50","x2","115","class","line-dot",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"activity-months"],[1,"label"],["x1","50","x2","115",1,"line-dot"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"set-section-container")(2,"h6"),t._uU(3,"Activit\xe9s"),t.qZA(),t.O4$(),t.TgZ(4,"svg",1),t.YNc(5,Zt,1,7,"circle",2),t.YNc(6,kt,2,6,"text",2),t.qZA()(),t.kcU(),t.TgZ(7,"set-section-container")(8,"h6"),t._uU(9,"Dur\xe9e"),t.qZA(),t.O4$(),t.TgZ(10,"svg"),t.YNc(11,Pt,1,3,"circle",3),t.YNc(12,At,2,4,"text",4),t.YNc(13,It,1,2,"line",5),t.qZA()(),t.kcU(),t.TgZ(14,"set-section-container")(15,"h6"),t._uU(16,"D\xe9placements"),t.qZA(),t.O4$(),t.TgZ(17,"svg"),t.YNc(18,_t,1,7,"line",2),t.YNc(19,Ot,1,7,"circle",2),t.YNc(20,Nt,1,3,"text",6),t.YNc(21,Ft,2,4,"text",4),t.qZA()()()),2&e&&(t.xp6(4),t.Q6J("id",n.legendActivitiesId),t.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightLegendElement),t.xp6(1),t.Q6J("ngForOf",n.activityTypesLegendData.circleJobs),t.xp6(1),t.Q6J("ngForOf",n.activityTypesLegendData.circleJobs),t.xp6(4),t.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightLegendElement),t.xp6(1),t.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),t.xp6(1),t.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),t.xp6(1),t.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),t.xp6(4),t.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightMoveLegendElement),t.xp6(1),t.Q6J("ngForOf",n.movesLineLegendData.moves),t.xp6(1),t.Q6J("ngForOf",n.movesLineLegendData.moves),t.xp6(1),t.Q6J("ngForOf",n.movesLineLegendData.moves),t.xp6(1),t.Q6J("ngForOf",n.movesLineLegendData.moves))},dependencies:[y.sg,K.d],styles:['.label[_ngcontent-%COMP%]{text-anchor:start;dominant-baseline:middle}svg[_ngcontent-%COMP%]{width:9em}@media (max-width: 576px){svg[_ngcontent-%COMP%]{width:6em}}.activity-months[_ngcontent-%COMP%]{fill:#fff;opacity:.7;stroke:#000;stroke-width:2px;stroke-opacity:1}.line-dot[_ngcontent-%COMP%]{stroke:#000;stroke-width:1;stroke-dasharray:5,5}.train-line[_ngcontent-%COMP%]{stroke:#000;stroke-width:3px}.train-marker[_ngcontent-%COMP%]{fill:#ff0;stroke:#000;stroke-width:3px;color:#000}.train-marker-text[_ngcontent-%COMP%]{font-family:"Font Awesome 5 Free";font-weight:900;color:#000;text-anchor:middle;dominant-baseline:middle;pointer-events:none}']}),i})();var q=c(8949),Et=c(6298);let Rt=(()=>{class i{constructor(e,n){this.dataService=e,this.mapService=n,this.backwardIcon=D.uYr,this.forwardIcon=D.Ybx,this.sliderBarId="#"+$,this.margin={top:10,right:15,bottom:0,left:15},this.width=600,this.height=70,this.fontSize="14px",this.sliderNodesSize=5,this.endDate=q.cQ,this.currentYear=q.VK,this.selectedDatePosition=0,this.maxDatePosition=this.width-this.margin.left-this.margin.right,this.currentCountNodes=0,this.mapSubscription=this.mapService.map.subscribe(s=>{this.map=s}),this.pullGeoDataSubscription=this.dataService.activitiesGeoData.subscribe(s=>{this.geoTripsData=s.trips_data,this.geoActivitiesData=s.activities_geojson;const r=new Date(s.start_date);r.setMonth(r.getMonth()-1),this.startDate=r,this.buildTimeline(String(this.currentYear))})}ngOnInit(){this.dataService.pullActivitiesGeoData()}ngOnDestroy(){this.pullGeoDataSubscription.unsubscribe(),this.mapSubscription.unsubscribe()}parseTime(e){return l.Z1g("%Y-%m-%d")(e)}formatDate(e){return l.i$Z("%b %Y")(e)}formatDateToYearString(e){return l.i$Z("%Y")(e)}formatDateToString(e){return l.i$Z("%Y-%m-%d")(e)}startTimeLine(){const e=l.Ys("#play-button");"Pause"===e.html()?(clearInterval(this.timer),e.text("Continue")):(e.html(),this.timer=setInterval(this.step.bind(this),100),e.html("Pause"))}resetTimeLine(){l.Ys("#play-button").html("Start"),this.sliderDate=this.startDate,this.update(this.startDate),this.selectedDatePosition=0,clearInterval(this.timer)}forwardTimeLine(){l.Ys("#play-button").html("Play"),this.sliderDate=this.startDate,this.update(this.endDate),this.selectedDatePosition=0,clearInterval(this.timer)}updateTrips(e){let n=[];this.geoTripsData.forEach(s=>{const d=s.end_date,a=this.parseTime(s.start_date),p=this.parseTime(d);null!==a&&null!==p&&e>=a&&e<p&&n.push(s)}),this.dataService.pullTripsGeoDataToMap(1===n.length?n:[])}update(e){this.updateTrips(e);const n=this.geoActivitiesData.features.filter(s=>{const r=this.parseTime(s.properties.start_date);return null!==r&&r>=this.startDate&&r<e});n.length!==this.currentCountNodes&&(this.dataService.pullActivitiesGeoDataToMap(n),this.displaySliderNodes(n)),this.currentCountNodes=n.length,l.Ys("#trace").attr("x2",this.dateRange(e)),l.Ys("#handle").attr("cx",this.dateRange(e)),this.sliderDate=e}step(){this.update(this.dateRange.invert(this.selectedDatePosition)),this.selectedDatePosition=this.selectedDatePosition+this.maxDatePosition/151,this.selectedDatePosition>this.maxDatePosition&&(this.selectedDatePosition=0,clearInterval(this.timer),l.Ys("#play-button").text("Play"))}_initDateRange(){this.dateRange=l.Xf().domain([this.startDate,this.endDate]).range([0,this.maxDatePosition]).clamp(!0)}buildTimeline(e){const n=l.Ys(this.sliderBarId),s=l.Ys("#play-button");this._initDateRange();const r=n.append("g").attr("class","slider-bar").attr("transform","translate("+this.margin.left+","+this.height/2+")");r.append("line").attr("class","track").attr("x1",this.dateRange.range()[0]).attr("x2",this.dateRange.range()[1]).select((u,m,C)=>C[m].parentNode.appendChild(C[m].cloneNode(!0))).attr("class","track-inset").select((u,m,C)=>C[m].parentNode.appendChild(C[m].cloneNode(!0))).attr("class","track-overlay").call(l.ohM().on("drag start",u=>{s.text("Pause"),this.selectedDatePosition=u.x,this.update(this.dateRange.invert(this.selectedDatePosition)),l.Ys("#slider-bar .events").selectAll("circle").style("pointer-events","none")}).on("end",()=>{l.Ys("#slider-bar .events").selectAll("circle").style("pointer-events","all");const u=this.dateRange.invert(this.selectedDatePosition).toTimeString();u===this.endDate.toTimeString()||u===this.startDate.toTimeString()?s.text("Play"):s.text("Continue")})),r.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,21)").selectAll("text").data(this.dateRange.ticks(10)).enter().append("text").attr("x",this.dateRange).attr("y",0).style("font-size",this.fontSize).attr("text-anchor","middle").text(u=>this.formatDateToYearString(u)),r.insert("g",".track-overlay").attr("class","ticks-line").attr("transform","translate(0,-6)").selectAll("line").data(this.dateRange.ticks(10)).enter().append("line").attr("x1",this.dateRange).attr("x2",this.dateRange).attr("y1",0).attr("y2",12).style("stroke","grey").style("stroke-width","2px"),r.insert("g",".track-overlay").attr("class","trace-events").selectAll("circle").data(this.geoActivitiesData.features).enter().append("circle").attr("class",u=>{const m=this.parseTime(u.properties.start_date);return null!==m&&m>=this.startDate?"trace":""}).attr("r",u=>{const m=this.parseTime(u.properties.start_date);return null!==m&&m>=this.startDate?4:2}).attr("cx",u=>{const m=this.parseTime(u.properties.start_date);return null===m?"":m>=this.startDate?this.dateRange(m):void 0}),r.insert("line",".track-overlay").attr("id","trace").attr("x1",this.dateRange(this.startDate)),r.insert("circle",".track-overlay").attr("id","handle").attr("r",10),r.append("g").attr("class","events"),this.sliderDate=this.endDate,this.update(this.endDate)}displaySliderNodes(e){const n=l.Ys("#slider-bar .events").selectAll("circle").data(e,s=>s.properties.id);n.enter().append("circle").attr("id",s=>"location_"+s.properties.id).attr("class",s=>{const r=l.td_("#"+A+" circle."+s.properties.type);return r.size()>0&&r.classed("disabled")?"invisible activityPoint "+s.properties.type:"activityPoint "+s.properties.type}).style("fill",s=>"job"===s.properties.type?h.Cm:"education"===s.properties.type?h.bj:"volunteer"===s.properties.type?h.C1:h.Cm).attr("r",this.sliderNodesSize).attr("cursor","pointer").attr("cx",s=>this.dateRange(this.parseTime(s.properties.start_date))).on("click",(s,r)=>{const a=I(this.map,g,r.properties.id,"id").getGeometry();void 0!==a&&this.mapService.zoomToExtent(a.getExtent(),13)}).on("mouseover",(s,r)=>{this.interactionWithEventNode(s.currentTarget,r),l.Ys("#popup-feature-"+r.properties.id).style("display","block").style("right","1em").style("top","5em");const d=I(this.map,g,r.properties.id,"id");d.setStyle(B(d.get("radius")))}).on("mouseout",(s,r)=>{this.interactionWithEventNode(s.currentTarget,r),l.Ys("#popup-feature-"+r.properties.id).style("display","none").style("right","unset").style("top","unset"),I(this.map,g,r.properties.id,"id").setStyle(j(r.properties))}),n.exit().remove()}interactionWithEventNode(e,n){const s=l.Ys(e);s.classed("selected",!s.classed("selected"));const r=l.Ys("#"+A+" circle."+n.properties.type);r.classed("selected",!r.classed("selected"))}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(R),t.Y36(X.S))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-time-legend"]],inputs:{currentActivityIdSelected:"currentActivityIdSelected",map:"map"},decls:15,vars:7,consts:[["classes","text-bg-secondary"],[1,"d-flex","flex-row","justify-content-center"],["id","slider-bar"],[1,"d-flex","flex-row","justify-content-center","align-items-center"],["id","start-button","role","button",1,"btn","btn-sm","btn-dark",3,"click"],[3,"icon"],["id","play-button","role","button",1,"btn","btn-dark","mx-2",3,"click"],["id","end-button","role","button",1,"btn","btn-sm","btn-dark",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"set-section-container")(1,"h6"),t._uU(2,"Barre Temporelle"),t.qZA(),t.TgZ(3,"set-badge-content",0),t._uU(4),t.ALo(5,"date"),t.qZA(),t.TgZ(6,"div",1),t.O4$(),t._UZ(7,"svg",2),t.qZA(),t.kcU(),t.TgZ(8,"div",3)(9,"a",4),t.NdJ("click",function(){return n.resetTimeLine()}),t._UZ(10,"fa-icon",5),t.qZA(),t.TgZ(11,"a",6),t.NdJ("click",function(){return n.startTimeLine()}),t._uU(12,"Play"),t.qZA(),t.TgZ(13,"a",7),t.NdJ("click",function(){return n.forwardTimeLine()}),t._UZ(14,"fa-icon",5),t.qZA()()()),2&e&&(t.xp6(4),t.Oqu(t.xi3(5,4,n.sliderDate,"MMMM y")),t.xp6(3),t.uIk("viewBox","0 10 "+n.width+" "+n.height),t.xp6(3),t.Q6J("icon",n.backwardIcon),t.xp6(4),t.Q6J("icon",n.forwardIcon))},dependencies:[_.BN,K.d,Et.H,y.uU],styles:[".events circle{stroke-width:1px;opacity:1;stroke:#f8f8ff}.trace-events circle.trace{fill:#686868;stroke:#f8f8ff;stroke-width:3px;stroke-opacity:1}.ticks{font-size:10px}.track,.track-inset,.track-overlay{stroke-linecap:round}.track{stroke:#000;stroke-opacity:.3;stroke-width:13px}.track-inset{stroke:#dcdcdc;stroke-width:11px}.track-overlay{pointer-events:stroke;stroke-width:50px;stroke:transparent;cursor:pointer}#handle{fill:#fff;stroke:#000;stroke-opacity:.5;stroke-width:1.25px}svg #trace{stroke:#6c6c6c;stroke-width:4}#play-button{width:90px}circle.preselected,circle.selected{stroke:#000!important;stroke-width:2px!important}#slider-bar{width:33em}@media (max-width: 576px){#slider-bar{width:20em}}\n"],encapsulation:2}),i})();function zt(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"button",5),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.zoomOnData())}),t._UZ(1,"fa-icon",6),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("icon",e.centerIcon)}}function Gt(i,o){if(1&i&&t._UZ(0,"app-theme-legend")(1,"app-time-legend",7),2&i){const e=t.oxw();t.xp6(1),t.Q6J("currentActivityIdSelected",e.fragment)("map",e.map)}}function Ut(i,o){1&i&&t.GkF(0)}function Jt(i,o){if(1&i&&(t.TgZ(0,"div",21),t._UZ(1,"img",22),t.qZA()),2&i){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("src",n.apiImgUrl+e.properties.img_activity,t.LSH)}}function $t(i,o){1&i&&t._UZ(0,"div")}function jt(i,o){if(1&i&&(t.TgZ(0,"div",16),t._uU(1),t.ALo(2,"date"),t.ALo(3,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.AsE("Du ",t.xi3(2,2,e.properties.start_date,"MM-yyyy")," au ",t.xi3(3,5,e.properties.end_date,"MM-yyyy"),"")}}function Bt(i,o){if(1&i&&(t.TgZ(0,"div",16),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.hij("Du ",t.xi3(2,1,e.properties.start_date,"MM-yyyy")," \xe0 aujourd'hui")}}function Qt(i,o){if(1&i&&(t.TgZ(0,"div",9)(1,"div",10)(2,"div",11)(3,"h5",12),t._uU(4),t.qZA()(),t.TgZ(5,"div",13),t.YNc(6,Jt,2,1,"div",14),t.TgZ(7,"div",15)(8,"h6",12),t._uU(9),t.qZA(),t.TgZ(10,"span",16),t._UZ(11,"fa-icon",17),t._uU(12),t.qZA(),t.YNc(13,$t,1,0,"div",18),t.YNc(14,jt,4,8,"ng-template",null,19,t.W1O),t.YNc(16,Bt,3,4,"ng-template",null,20,t.W1O),t.qZA()()()()),2&i){const e=o.$implicit,n=t.MAs(15),s=t.MAs(17),r=t.oxw(2);t.Q6J("id","popup-feature-"+e.properties.id),t.xp6(4),t.Oqu(e.properties.title),t.xp6(2),t.Q6J("ngIf","null"!==e.properties.img_activity),t.xp6(3),t.Oqu(e.properties.name),t.xp6(2),t.Q6J("icon",r.locationIcon),t.xp6(1),t.hij(" ",e.properties.location," "),t.xp6(1),t.Q6J("ngIf","InProgress"===e.properties.status)("ngIfThen",s)("ngIfElse",n)}}function Vt(i,o){if(1&i&&t.YNc(0,Qt,18,9,"div",8),2&i){const e=t.oxw();t.Q6J("ngForOf",e.geoFeaturesData)}}const Wt=function(){return{}},Ht=[{path:"",component:(()=>{class i{constructor(e,n,s,r,d){this.mapService=e,this.dataService=n,this.activatedRoute=s,this.titleService=r,this.controlerService=d,this.imageProfile=E.tz,this.fragment=null,this.experiencesRoute=H.I_.route,this.educationRoute=H.QD.route,this.travelId=null,this.isLegendDisplayed=!0,this.defaultActivitieLayerZoom=9,this.apiImgUrl=E.uV,this.locationIcon=D.FGq,this.tagIcon=D.tho,this.centerIcon=D.TL5,this.helpIcon=D.Fuz,this.helpPopup="Voici une cartographie spatio-temporelles de mes exp\xe9riences",this.popupWidth=330,this.popupHeight=190,this.zoomEventSubscription=this.mapService.zoomEvent.subscribe(a=>{this.mapService.zoomToLayerName(g,this.defaultActivitieLayerZoom)}),this.newCoordsSubscription=this.mapService.newCoords.subscribe(a=>{this.popupMoving(a[1])}),this.mapSubscription=this.mapService.map.subscribe(a=>{this.map=a}),this.pullActivitiesGeoDataToMapSubscription=this.dataService.activitiesGeoDataToMap.pipe((0,it.U)((a,p)=>[a,p])).subscribe(a=>{if(this.mapService.removeLayerByName(g),this.geoFeaturesData=a[0],console.log(this.geoFeaturesData),this.buildActivityLayer(this.geoFeaturesData),null!==this.fragment){const v=I(this.map,g,this.fragment,"id").getGeometry();void 0!==v&&this.mapService.zoomToExtent(v.getExtent(),13)}else 0===a[1]&&this.mapService.zoomToLayerName(g,this.defaultActivitieLayerZoom)}),this.pullTripsGeoDataToMapSubscription=this.dataService.tripsGeoDataToMap.subscribe(a=>{1===a.length&&this.travelId!==a[0].name&&(this.mapService.removeLayerByName(P),this.travelId=a[0].name,this.buildTravelLayer(a[0])),0===a.length&&(this.travelId=null,this.mapService.removeLayerByName(P))}),this.routeSubscription=this.activatedRoute.fragment.subscribe(a=>{this.fragment=null===a?null:a})}ngOnInit(){this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap(),this.sendResumeSubMenus(),this.zoomInitDone=!1,this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}ngOnDestroy(){this.mapSubscription.unsubscribe(),this.pullActivitiesGeoDataToMapSubscription.unsubscribe(),this.pullTripsGeoDataToMapSubscription.unsubscribe(),this.zoomEventSubscription.unsubscribe(),this.routeSubscription.unsubscribe(),this.newCoordsSubscription.unsubscribe(),this.mapService.removeLayerByName(g),this.mapService.removeLayerByName(P),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}zoomOnData(){this.mapService.sendZoomAction()}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title),this.titleService.setTitle(this.activatedRoute.snapshot.data.title)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}buildLayerFromFeatures(e,n,s){let r=new J.Z({features:[]}),d=new U.Z({source:r});return n.forEach((a,p)=>{let v=new L.Z({geometry:new k.Z(a.geometry.coordinates).transform("EPSG:4326","EPSG:3857"),id:a.properties.id,type:a.properties.type,name:a.properties.name,radius:2*a.properties.months});v.setStyle(s(a.properties)),r.addFeature(v)}),d.set("name",e),d}buildActivityLayer(e){let n=this.buildLayerFromFeatures(g,e,j);this.map.addLayer(n);let s=new nt.Z({condition:st.MJ,multi:!1,layers:[n],style:r=>B(r.get("radius"))});s.on("select",r=>{const d=r.selected,a=r.deselected;if(1===a.length){let p=a[0];this.currentFeatureSelectedId=null,this.mapService.unsetMapEvent("mapCoords"),l.Ys("#popup-feature-"+p.get("id")).style("display","none").style("right","unset").style("top","unset").style("left","unset"),this._handleActivityCircleOnLegend(p)}if(1===d.length){let p=d[0];this.currentFeatureSelectedId=p.get("id"),this.mapService.setMapEvent("mapCoords"),l.Ys("#popup-feature-"+p.get("id")).style("z-index","1"),this._handleActivityCircleOnLegend(p)}}),this.map.addInteraction(s)}_handleActivityCircleOnLegend(e){const n=l.Ys("#"+A+" circle."+e.get("type"));n.classed("selected",!n.classed("selected"));const s=l.Ys("circle#location_"+e.get("id"));s.classed("selected",!s.classed("selected"))}buildTravelLayer(e){let n=[];e.geojson_data.forEach(f=>{n.push((0,N.vs)(f.geometry.coordinates,"EPSG:4326","EPSG:3857"))});let s=new lt.Z(n);var r=new L.Z({type:"route",geometry:s});const d=new L.Z({type:"limit",geometry:new k.Z(s.getFirstCoordinate())}),a=new L.Z({type:"limit",geometry:new k.Z(s.getLastCoordinate())}),p=new k.Z(s.getFirstCoordinate()),v=new L.Z({type:"movingNode",geometry:p});let u=new J.Z({features:[]}),m=new U.Z({source:u});[r,v,d,a].forEach((f,z)=>{f.setStyle(W(f.get("type"))),u.addFeature(f)}),m.set("name",P),this.map.addLayer(m);let tt=Date.now(),Z=0;m.on("postrender",f=>{const z=f.frameState.time;Z=(Z+100*(z-tt)/1e6)%2,tt=z;const ee=s.getCoordinateAt(Z>1?2-Z:Z);p.setCoordinates(ee);const et=function ct(i){if(!(i.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const o=i.inversePixelTransform[0],e=i.frameState,n=(0,rt.Jp)(i.inversePixelTransform.slice(),e.coordinateToPixelTransform),s=(0,at.se)(e.viewState.resolution,o);let r;const d=(0,N.Cs)();return d&&(r=(0,N.WO)(d,e.viewState.projection)),new ot.Z(i.context,o,e.extent,n,e.viewState.rotation,s,r)}(f);et.setStyle(W("movingNode")),et.drawGeometry(p),this.map.render()})}popupMoving(e){l.Ys("#popup-feature-"+this.currentFeatureSelectedId).style("left",()=>e[0]+this.popupWidth+20>this.innerWidth?e[0]-this.popupWidth-15+"px":e[0]+15+"px").style("top",()=>e[1]+this.popupHeight+20>this.innerHeight?e[1]-this.popupHeight-15+"px":e[1]+15+"px").style("display","block")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(X.S),t.Y36(R),t.Y36(O.gz),t.Y36(Ct.Dx),t.Y36(Lt.L))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-map-view"]],decls:8,vars:3,consts:[["classes","position-fixed"],["buttonsTemplate",""],["controlersTemplate",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["activitiesPopups",""],["title","Centrer","type","button","checked","","autocomplete","off",1,"btn","btn-sm","btn-warning","mx-1",3,"click"],[1,"",3,"icon"],[3,"currentActivityIdSelected","map"],["class","card shadow-lg map-popup border border-3 border-secondary",3,"id",4,"ngFor","ngForOf"],[1,"card","shadow-lg","map-popup","border","border-3","border-secondary",3,"id"],[1,"card-body"],[1,"d-flex","flex-row","justify-content-around","mb-1"],[1,"fw-bolder","small"],[1,"d-flex","flex-row","justify-content-around"],["class","w-25 justify-content-around text-center",4,"ngIf"],[1,"my-auto"],[1,"small"],[1,"me-2","text-danger",3,"icon"],[4,"ngIf","ngIfThen","ngIfElse"],["pastJob",""],["currentJob",""],[1,"w-25","justify-content-around","text-center"],[1,"img-fluid","rounded","mx-auto","shadow","mini-img-thumbnail",3,"src"]],template:function(e,n){if(1&e&&(t.TgZ(0,"set-legend-container",0),t.YNc(1,zt,2,1,"ng-template",null,1,t.W1O),t.YNc(3,Gt,2,2,"ng-template",null,2,t.W1O),t.qZA(),t.YNc(5,Ut,1,0,"ng-container",3),t.YNc(6,Vt,1,1,"ng-template",null,4,t.W1O)),2&e){const s=t.MAs(7);t.xp6(5),t.Q6J("ngTemplateOutlet",s)("ngTemplateOutletContext",t.DdM(2,Wt))}},dependencies:[y.sg,y.O5,y.tP,_.BN,Mt.b,Yt,Rt,y.uU],styles:[".map-popup[_ngcontent-%COMP%]{position:fixed;display:none;background-color:#f8f8ff;max-width:400px}#map-title[_ngcontent-%COMP%]{background-color:#f1f1f1c9!important;padding:10px;border-bottom-right-radius:25px;border-bottom-left-radius:25px}#map-title[_ngcontent-%COMP%]:after{left:-30px;border-top:30px solid salmon;border-left:30px solid transparent;z-index:-10}.mini-img-thumbnail[_ngcontent-%COMP%]{width:15vw}"]}),i})(),data:{title:"Carte des activit\xe9s",page:"map-activities"},outlet:"map-activities"}];let Xt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[O.Bz.forChild(Ht),O.Bz]}),i})();var Kt=c(7157);let qt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({providers:[R],imports:[y.ez,Xt,_.uH,Kt.p]}),i})()}}]);