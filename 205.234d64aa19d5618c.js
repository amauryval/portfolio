"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[205],{205:(He,z,l)=>{l.r(z),l.d(z,{MapActivitiesModule:()=>Qe});var y=l(9808),I=l(9444),N=l(9560),ee=l(4004),L=l(3171),J=l(7053),$=l(5947),M=l(187),te=l(3324),ie=l(8313),ne=l(3620),se=l(483),re=l(8377),F=l(1274),ae=l(6527),c=l(9255),h=l(2397),Z=l(109),S=l(949),w=l(5044),x=l(6785);const g="activities",C="travel",A="legendActivity",j="slider-bar",_="rgba(225, 0, 1, 0.6)",O="rgba(0, 144, 29, 0.6)",Y="rgba(98, 0, 255, 0.6)",D="white",de=new S.Z({radius:0,fill:new w.Z({color:_}),stroke:new x.Z({color:D,width:2})}),pe=new S.Z({radius:0,fill:new w.Z({color:O}),stroke:new x.Z({color:D,width:2})}),ue=new S.Z({radius:0,fill:new w.Z({color:Y}),stroke:new x.Z({color:D,width:2})});function B(i){let o;return o="job"===i.type?de.clone():"education"===i.type?pe.clone():ue.clone(),o.setRadius(2*i.months),new Z.ZP({image:o})}function Q(i){return new Z.ZP({image:new S.Z({radius:i,fill:new w.Z({color:"rgba(255, 215, 0, 0.6)"}),stroke:new x.Z({color:"black",width:2})})})}const R="black",V="yellow",Te=new Z.ZP({stroke:new x.Z({width:4,color:"black"})}),Se=new Z.ZP({image:new S.Z({radius:2,fill:new w.Z({color:"black"}),stroke:new x.Z({color:R,width:1})})}),W=new Z.ZP({image:new S.Z({radius:7,fill:new w.Z({color:V}),stroke:new x.Z({color:R,width:3})})}),H=i=>"route"===i?Te:"limit"===i?Se:W;function P(i,o,t,n){return i.getLayers().getArray().filter(p=>p.get("name")===o)[0].getSource().getFeatures().filter(p=>p.get(n)===t)[0]}var e=l(5e3),X=l(9947),T=l(7579),we=l(520);let U=(()=>{class i{constructor(t){this.http=t,this.apiUrlActivitiesGeoData=h.JW+"activities_geodata",this.ErrorapiUrlActivitiesGeoDataApiFound=new T.x,this.activitiesGeoData=new T.x,this.dataToMap=new T.x,this.dateNotified=new T.x,this.timelineBuild=new T.x,this.activitiesGeoDataToMap=new T.x,this.tripsGeoDataToMap=new T.x}pullActivitiesGeoData(){this.http.get(this.apiUrlActivitiesGeoData).subscribe({complete:()=>{},error:t=>{this.ErrorapiUrlActivitiesGeoDataApiFound.next(t.error.message)},next:t=>{this.activitiesGeoData.next(t)}})}pullDataToMap(t){this.dataToMap.next(t)}pullActivitiesGeoDataToMap(t){this.activitiesGeoDataToMap.next(t)}pullTripsGeoDataToMap(t){this.tripsGeoDataToMap.next(t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(we.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var De=l(2313),be=l(3686);function Le(i,o){if(1&i&&(e.O4$(),e._UZ(0,"circle")),2&i){const t=o.$implicit,n=e.oxw();e.Tol(t.class),e.uIk("r",n.activityTypesLegendData.circleR)("cx",n.activityTypesLegendData.circleCxPos)("cy",t.cy)("fill",t.color)("stroke",t.strokeColor)}}function Ze(i,o){if(1&i&&(e.O4$(),e.TgZ(0,"text"),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.Tol(t.class+" label"),e.uIk("x",n.activityTypesLegendData.textXPos)("y",t.cy)("font-size",n.fontSize),e.xp6(1),e.hij("",t.label," ")}}function ke(i,o){if(1&i&&(e.O4$(),e._UZ(0,"circle",9)),2&i){const t=o.$implicit,n=e.oxw();e.uIk("r",t)("cx",n.activityMonthLegendData.circleCxPos)("cy",t)}}function Me(i,o){if(1&i&&(e.O4$(),e.TgZ(0,"text",10),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.uIk("x",n.activityMonthLegendData.textXPos)("y",2*t)("font-size",n.fontSize),e.xp6(1),e.hij("",t," mois ")}}function Ce(i,o){if(1&i&&(e.O4$(),e._UZ(0,"line",11)),2&i){const t=o.$implicit;e.uIk("y1",2*t+2)("y2",2*t+2)}}function Ae(i,o){if(1&i&&(e.O4$(),e._UZ(0,"line")),2&i){const t=o.$implicit;e.Tol(t.classLine),e.uIk("x1",t.x1)("x2",t.x2)("y1",t.y1)("y2",t.y2)("strokeColor",t.strokeColor)}}function _e(i,o){if(1&i&&(e.O4$(),e._UZ(0,"circle")),2&i){const t=o.$implicit;e.Tol(t.classMarker),e.uIk("r",t.r)("cx",t.y2/2)("cy",t.y2/2)("color",t.circleColor)("strokeColor",t.strokeColor)}}function Pe(i,o){if(1&i&&(e.O4$(),e._UZ(0,"text")),2&i){const t=o.$implicit,n=e.oxw();e.uIk("x",t.y2/2)("y",t.y2/2)("font-size",n.movesLineLegendData.markerFontSize)}}function Ie(i,o){if(1&i&&(e.O4$(),e.TgZ(0,"text",10),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.uIk("x",n.movesLineLegendData.textXPos)("y",t.y2/2)("font-size",n.fontSize),e.xp6(1),e.hij("",t.label," ")}}let Ne=(()=>{class i{constructor(){this.sliderBarId=j,this.legendActivitiesId=A,this.widthLegendElement=200,this.heightLegendElement=140,this.heightMoveLegendElement=60,this.fontSize="19px",this.activityMonthLegendData={circleMonthR:[40,20,10],circleCxPos:50,textXPos:120},this.activityTypesLegendData={circleR:18,circleCxPos:20,textXPos:50,circleJobs:[{cy:25,class:"education",label:"Formations",color:O,strokeColor:D},{cy:70,class:"job",label:"Entreprises",color:_,strokeColor:D},{cy:115,class:"volunteer",label:"B\xe9n\xe9volat",color:Y,strokeColor:D}]},this.movesLineLegendData={textXPos:50,markerFontSize:"12px",moves:[{x1:0,x2:45,y1:0,y2:45,r:12,classLine:"train-line",classMarker:"train-marker",classMarkerText:"train-marker-text",label:"Train",circleColor:V,strokeColor:R}]}}ngOnInit(){}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-theme-legend"]],decls:25,vars:13,consts:[["id","theme-legend",1,"row","py-2","mt-auto","justify-content-center"],[1,"col-4","col-lg-4"],[1,"col-lg-12"],[3,"id"],[3,"class",4,"ngFor","ngForOf"],["class","activity-months",4,"ngFor","ngForOf"],["class","label",4,"ngFor","ngForOf"],["x1","50","x2","115","class","line-dot",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"activity-months"],[1,"label"],["x1","50","x2","115",1,"line-dot"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h6"),e._uU(3,"Activit\xe9s"),e.qZA(),e.TgZ(4,"div",2),e.O4$(),e.TgZ(5,"svg",3),e.YNc(6,Le,1,7,"circle",4),e.YNc(7,Ze,2,6,"text",4),e.qZA()()(),e.kcU(),e.TgZ(8,"div",1)(9,"h6"),e._uU(10,"Dur\xe9e"),e.qZA(),e.TgZ(11,"div",2),e.O4$(),e.TgZ(12,"svg"),e.YNc(13,ke,1,3,"circle",5),e.YNc(14,Me,2,4,"text",6),e.YNc(15,Ce,1,2,"line",7),e.qZA()()(),e.kcU(),e.TgZ(16,"div",1)(17,"h6"),e._uU(18,"D\xe9placements"),e.qZA(),e.TgZ(19,"div",2),e.O4$(),e.TgZ(20,"svg"),e.YNc(21,Ae,1,7,"line",4),e.YNc(22,_e,1,7,"circle",4),e.YNc(23,Pe,1,3,"text",8),e.YNc(24,Ie,2,4,"text",6),e.qZA()()()()),2&t&&(e.xp6(5),e.Q6J("id",n.legendActivitiesId),e.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightLegendElement),e.xp6(1),e.Q6J("ngForOf",n.activityTypesLegendData.circleJobs),e.xp6(1),e.Q6J("ngForOf",n.activityTypesLegendData.circleJobs),e.xp6(5),e.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightLegendElement),e.xp6(1),e.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),e.xp6(1),e.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),e.xp6(1),e.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),e.xp6(5),e.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightMoveLegendElement),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves))},directives:[y.sg],styles:[".label[_ngcontent-%COMP%]{text-anchor:start;dominant-baseline:middle}svg[_ngcontent-%COMP%]{width:9em}@media (max-width: 576px){svg[_ngcontent-%COMP%]{width:6em}}"]}),i})(),Fe=(()=>{class i{constructor(t,n){this.dataService=t,this.mapService=n,this.backwardIcon=h.Gq,this.forwardIcon=h.cn,this.sliderBarId="#"+j,this.margin={top:10,right:15,bottom:0,left:15},this.width=600,this.height=90,this.fontSize="14px",this.sliderNodesSize=5,this.endDate=h.cQ,this.currentYear=h.VK,this.selectedDatePosition=0,this.maxDatePosition=this.width-this.margin.left-this.margin.right,this.currentCountNodes=0,this.mapSubscription=this.mapService.map.subscribe(s=>{this.map=s}),this.pullGeoDataSubscription=this.dataService.activitiesGeoData.subscribe(s=>{this.geoTripsData=s.trips_data,this.geoActivitiesData=s.activities_geojson;const r=new Date(s.start_date);r.setMonth(r.getMonth()-1),this.startDate=r,this.buildTimeline(String(this.currentYear))})}ngOnInit(){this.dataService.pullActivitiesGeoData()}ngOnDestroy(){this.pullGeoDataSubscription.unsubscribe(),this.mapSubscription.unsubscribe()}parseTime(t){return c.Z1g("%Y-%m-%d")(t)}formatDate(t){return c.i$Z("%b %Y")(t)}formatDateToYearString(t){return c.i$Z("%Y")(t)}formatDateToString(t){return c.i$Z("%Y-%m-%d")(t)}startTimeLine(){const t=c.Ys("#play-button");"Pause"===t.html()?(clearInterval(this.timer),t.text("Continue")):(t.html(),this.timer=setInterval(this.step.bind(this),100),t.html("Pause"))}resetTimeLine(){c.Ys("#play-button").html("Start"),this.sliderDate=this.startDate,this.update(this.startDate),this.selectedDatePosition=0,clearInterval(this.timer)}forwardTimeLine(){c.Ys("#play-button").html("Play"),this.sliderDate=this.startDate,this.update(this.endDate),this.selectedDatePosition=0,clearInterval(this.timer)}updateTrips(t){let n=[];this.geoTripsData.forEach(s=>{const d=s.end_date,a=this.parseTime(s.start_date),p=this.parseTime(d);null!==a&&null!==p&&t>=a&&t<p&&n.push(s)}),this.dataService.pullTripsGeoDataToMap(1===n.length?n:[])}update(t){this.updateTrips(t);const n=this.geoActivitiesData.features.filter(s=>{const r=this.parseTime(s.properties.start_date);return null!==r&&r>=this.startDate&&r<t});n.length!==this.currentCountNodes&&(this.dataService.pullActivitiesGeoDataToMap(n),this.displaySliderNodes(n)),this.currentCountNodes=n.length,c.Ys("#trace").attr("x2",this.dateRange(t)),c.Ys("#handle").attr("cx",this.dateRange(t)),this.sliderDate=t}step(){this.update(this.dateRange.invert(this.selectedDatePosition)),this.selectedDatePosition=this.selectedDatePosition+this.maxDatePosition/151,this.selectedDatePosition>this.maxDatePosition&&(this.selectedDatePosition=0,clearInterval(this.timer),c.Ys("#play-button").text("Play"))}_initDateRange(){this.dateRange=c.Xf().domain([this.startDate,this.endDate]).range([0,this.maxDatePosition]).clamp(!0)}buildTimeline(t){const n=c.Ys(this.sliderBarId),s=c.Ys("#play-button");this._initDateRange();const r=n.append("g").attr("class","slider-bar").attr("transform","translate("+this.margin.left+","+this.height/2+")");r.append("line").attr("class","track").attr("x1",this.dateRange.range()[0]).attr("x2",this.dateRange.range()[1]).select((m,u,b)=>b[u].parentNode.appendChild(b[u].cloneNode(!0))).attr("class","track-inset").select((m,u,b)=>b[u].parentNode.appendChild(b[u].cloneNode(!0))).attr("class","track-overlay").call(c.ohM().on("drag start",m=>{s.text("Pause"),this.selectedDatePosition=m.x,this.update(this.dateRange.invert(this.selectedDatePosition)),c.Ys("#slider-bar .events").selectAll("circle").style("pointer-events","none")}).on("end",()=>{c.Ys("#slider-bar .events").selectAll("circle").style("pointer-events","all");const m=this.dateRange.invert(this.selectedDatePosition).toTimeString();m===this.endDate.toTimeString()||m===this.startDate.toTimeString()?s.text("Play"):s.text("Continue")})),r.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,21)").selectAll("text").data(this.dateRange.ticks(10)).enter().append("text").attr("x",this.dateRange).attr("y",0).style("font-size",this.fontSize).attr("text-anchor","middle").text(m=>this.formatDateToYearString(m)),r.insert("g",".track-overlay").attr("class","ticks-line").attr("transform","translate(0,-6)").selectAll("line").data(this.dateRange.ticks(10)).enter().append("line").attr("x1",this.dateRange).attr("x2",this.dateRange).attr("y1",0).attr("y2",12).style("stroke","grey").style("stroke-width","2px"),r.insert("g",".track-overlay").attr("class","trace-events").selectAll("circle").data(this.geoActivitiesData.features).enter().append("circle").attr("class",m=>{const u=this.parseTime(m.properties.start_date);return null!==u&&u>=this.startDate?"trace":""}).attr("r",m=>{const u=this.parseTime(m.properties.start_date);return null!==u&&u>=this.startDate?4:2}).attr("cx",m=>{const u=this.parseTime(m.properties.start_date);return null===u?"":u>=this.startDate?this.dateRange(u):void 0}),r.insert("line",".track-overlay").attr("id","trace").attr("x1",this.dateRange(this.startDate)),r.insert("circle",".track-overlay").attr("id","handle").attr("r",10),r.append("g").attr("class","events"),this.sliderDate=this.endDate,this.update(this.endDate)}displaySliderNodes(t){const n=c.Ys("#slider-bar .events").selectAll("circle").data(t,s=>s.properties.id);n.enter().append("circle").attr("id",s=>"location_"+s.properties.id).attr("class",s=>{const r=c.td_("#"+A+" circle."+s.properties.type);return r.size()>0&&r.classed("disabled")?"invisible activityPoint "+s.properties.type:"activityPoint "+s.properties.type}).style("fill",s=>"job"===s.properties.type?_:"education"===s.properties.type?O:"volunteer"===s.properties.type?Y:_).attr("r",this.sliderNodesSize).attr("cursor","pointer").attr("cx",s=>this.dateRange(this.parseTime(s.properties.start_date))).on("click",(s,r)=>{const a=P(this.map,g,r.properties.id,"id").getGeometry();void 0!==a&&this.mapService.zoomToExtent(a.getExtent(),13)}).on("mouseover",(s,r)=>{this.interactionWithEventNode(s.currentTarget,r),c.Ys("#popup-feature-"+r.properties.id).style("display","block").style("right","1em").style("top","5em");const d=P(this.map,g,r.properties.id,"id");d.setStyle(Q(d.get("radius")))}).on("mouseout",(s,r)=>{this.interactionWithEventNode(s.currentTarget,r),c.Ys("#popup-feature-"+r.properties.id).style("display","none").style("right","unset").style("top","unset"),P(this.map,g,r.properties.id,"id").setStyle(B(r.properties))}),n.exit().remove()}interactionWithEventNode(t,n){const s=c.Ys(t);s.classed("selected",!s.classed("selected"));const r=c.Ys("#"+A+" circle."+n.properties.type);r.classed("selected",!r.classed("selected"))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(U),e.Y36(X.S))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-time-legend"]],inputs:{currentActivityIdSelected:"currentActivityIdSelected",map:"map"},decls:18,vars:7,consts:[["id","theme-legend",1,"d-flex","flex-column","flex-lg-row","mt-auto","py-2","justify-content-center"],[1,""],["id","slider-bar"],[1,"text-center","px-5"],[1,"d-flex","flex-column","justify-content-center"],["id","slider-value"],["id","start-button","role","button",1,"btn","btn-dark","btn-sm",3,"click"],[3,"icon"],["id","play-button","role","button",1,"btn","btn-dark","mx-2",3,"click"],["id","end-button","role","button",1,"btn","btn-dark","btn-sm",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h6"),e._uU(3,"Barre Temporelle"),e.qZA(),e.O4$(),e._UZ(4,"svg",2),e.qZA(),e.kcU(),e.TgZ(5,"div",3)(6,"div",4)(7,"div",1)(8,"h5",5),e._uU(9),e.ALo(10,"date"),e.qZA()(),e.TgZ(11,"div",1)(12,"a",6),e.NdJ("click",function(){return n.resetTimeLine()}),e._UZ(13,"fa-icon",7),e.qZA(),e.TgZ(14,"a",8),e.NdJ("click",function(){return n.startTimeLine()}),e._uU(15,"Play"),e.qZA(),e.TgZ(16,"a",9),e.NdJ("click",function(){return n.forwardTimeLine()}),e._UZ(17,"fa-icon",7),e.qZA()()()()()),2&t&&(e.xp6(4),e.uIk("viewBox","0 0 "+n.width+" "+n.height),e.xp6(5),e.Oqu(e.xi3(10,4,n.sliderDate,"MMMM y")),e.xp6(4),e.Q6J("icon",n.backwardIcon),e.xp6(4),e.Q6J("icon",n.forwardIcon))},directives:[I.BN],pipes:[y.uU],styles:[".events circle{stroke-width:1px;opacity:1;stroke:#f8f8ff}.trace-events circle.trace{fill:#686868;stroke:#f8f8ff;stroke-width:3px;stroke-opacity:1}.ticks{font-size:10px}.track,.track-inset,.track-overlay{stroke-linecap:round}.track{stroke:#000;stroke-opacity:.3;stroke-width:13px}.track-inset{stroke:#dcdcdc;stroke-width:11px}.track-overlay{pointer-events:stroke;stroke-width:50px;stroke:transparent;cursor:pointer}#handle{fill:#fff;stroke:#000;stroke-opacity:.5;stroke-width:1.25px}svg #trace{stroke:#6c6c6c;stroke-width:4}#play-button{width:90px}circle.preselected{stroke:#000!important;stroke-width:2px!important}#slider-bar{width:33em}@media (max-width: 576px){#slider-bar{width:20em}}\n"],encapsulation:2}),i})();function Oe(i,o){1&i&&e.GkF(0)}function Ye(i,o){1&i&&e._UZ(0,"div")}function Ee(i,o){if(1&i&&(e.TgZ(0,"div",18),e._UZ(1,"img",19),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("src",n.apiImgUrl+t.properties.img_activity,e.LSH)}}function Re(i,o){1&i&&e._UZ(0,"div")}function Ue(i,o){if(1&i&&(e.TgZ(0,"div",13),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.AsE("Du ",e.xi3(2,2,t.properties.start_date,"MM-yyyy")," au ",e.xi3(3,5,t.properties.end_date,"MM-yyyy"),"")}}function Ge(i,o){if(1&i&&(e.TgZ(0,"div",13),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij("Du ",e.xi3(2,1,t.properties.start_date,"MM-yyyy")," \xe0 aujourd'hui")}}function ze(i,o){if(1&i&&(e.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"h5",9),e._uU(5),e.qZA()()(),e.TgZ(6,"div",7),e.YNc(7,Ye,1,0,"div",10),e.YNc(8,Ee,2,1,"ng-template",null,11,e.W1O),e.TgZ(10,"div",12)(11,"h6",9),e._uU(12),e.qZA(),e.TgZ(13,"span",13),e._UZ(14,"fa-icon",14),e._uU(15),e.qZA(),e.YNc(16,Re,1,0,"div",15),e.YNc(17,Ue,4,8,"ng-template",null,16,e.W1O),e.YNc(19,Ge,3,4,"ng-template",null,17,e.W1O),e.qZA()()()()),2&i){const t=o.$implicit,n=e.MAs(9),s=e.MAs(18),r=e.MAs(20),d=e.oxw(2);e.Q6J("id","popup-feature-"+t.properties.id),e.xp6(5),e.Oqu(t.properties.title),e.xp6(2),e.Q6J("ngIf","null"!==t.properties.img_activity)("ngIfThen",n),e.xp6(5),e.Oqu(t.properties.name),e.xp6(2),e.Q6J("icon",d.locationIcon),e.xp6(1),e.hij(" ",t.properties.location," "),e.xp6(1),e.Q6J("ngIf","InProgress"===t.properties.status)("ngIfThen",r)("ngIfElse",s)}}function Je(i,o){if(1&i&&e.YNc(0,ze,21,10,"div",4),2&i){const t=e.oxw();e.Q6J("ngForOf",t.geoFeaturesData)}}const $e=function(){return{}},je=[{path:"",component:(()=>{class i{constructor(t,n,s,r,d){this.mapService=t,this.dataService=n,this.activatedRoute=s,this.titleService=r,this.controlerService=d,this.imageProfile=h.tz,this.fragment=null,this.experiencesRoute=h.I_.route,this.educationRoute=h.QD.route,this.travelId=null,this.isLegendDisplayed=!0,this.defaultActivitieLayerZoom=9,this.apiImgUrl=h.VH,this.locationIcon=h.pk,this.tagIcon=h.yK,this.centerIcon=h.HI,this.helpIcon=h.mv,this.helpPopup="Voici une cartographie spatio-temporelles de mes exp\xe9riences",this.popupWidth=330,this.popupHeight=190,this.zoomEventSubscription=this.mapService.zoomEvent.subscribe(a=>{this.mapService.zoomToLayerName(g,this.defaultActivitieLayerZoom)}),this.newCoordsSubscription=this.mapService.newCoords.subscribe(a=>{this.popupMoving(a[1])}),this.mapSubscription=this.mapService.map.subscribe(a=>{this.map=a}),this.pullActivitiesGeoDataToMapSubscription=this.dataService.activitiesGeoDataToMap.pipe((0,ee.U)((a,p)=>[a,p])).subscribe(a=>{if(this.mapService.removeLayerByName(g),this.geoFeaturesData=a[0],this.buildActivityLayer(this.geoFeaturesData),null!==this.fragment){const v=P(this.map,g,this.fragment,"id").getGeometry();void 0!==v&&this.mapService.zoomToExtent(v.getExtent(),13)}else 0===a[1]&&this.mapService.zoomToLayerName(g,this.defaultActivitieLayerZoom)}),this.pullTripsGeoDataToMapSubscription=this.dataService.tripsGeoDataToMap.subscribe(a=>{1===a.length&&this.travelId!==a[0].name&&(this.mapService.removeLayerByName(C),this.travelId=a[0].name,this.buildTravelLayer(a[0])),0===a.length&&(this.travelId=null,this.mapService.removeLayerByName(C))}),this.routeSubscription=this.activatedRoute.fragment.subscribe(a=>{this.fragment=null===a?null:a})}ngOnInit(){this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap(),this.sendResumeSubMenus(),this.zoomInitDone=!1,this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}ngOnDestroy(){this.mapSubscription.unsubscribe(),this.pullActivitiesGeoDataToMapSubscription.unsubscribe(),this.pullTripsGeoDataToMapSubscription.unsubscribe(),this.zoomEventSubscription.unsubscribe(),this.routeSubscription.unsubscribe(),this.newCoordsSubscription.unsubscribe(),this.mapService.removeLayerByName(g),this.mapService.removeLayerByName(C),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title),this.titleService.setTitle(this.activatedRoute.snapshot.data.title)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}buildLayerFromFeatures(t,n,s){let r=new $.Z({features:[]}),d=new J.Z({source:r});return n.forEach((a,p)=>{let v=new L.Z({geometry:new M.Z(a.geometry.coordinates).transform("EPSG:4326","EPSG:3857"),id:a.properties.id,type:a.properties.type,name:a.properties.name,radius:2*a.properties.months});v.setStyle(s(a.properties)),r.addFeature(v)}),d.set("name",t),d}buildActivityLayer(t){let n=this.buildLayerFromFeatures(g,t,B);this.map.addLayer(n);let s=new te.Z({condition:ie.MJ,multi:!1,layers:[n],style:r=>Q(r.get("radius"))});s.on("select",r=>{const d=r.selected,a=r.deselected;if(1===a.length){let p=a[0];this.currentFeatureSelectedId=null,this.mapService.unsetMapEvent("mapCoords"),c.Ys("#popup-feature-"+p.get("id")).style("display","none").style("right","unset").style("top","unset").style("left","unset"),this._handleActivityCircleOnLegend(p)}if(1===d.length){let p=d[0];this.currentFeatureSelectedId=p.get("id"),this.mapService.setMapEvent("mapCoords"),c.Ys("#popup-feature-"+p.get("id")).style("display","block").style("z-index","1"),this._handleActivityCircleOnLegend(p)}}),this.map.addInteraction(s)}_handleActivityCircleOnLegend(t){const n=c.Ys("#"+A+" circle."+t.get("type"));n.classed("selected",!n.classed("selected"));const s=c.Ys("circle#location_"+t.get("id"));s.classed("selected",!s.classed("selected"))}buildTravelLayer(t){let n=[];t.geojson_data.forEach(f=>{n.push((0,F.vs)(f.geometry.coordinates,"EPSG:4326","EPSG:3857"))});let s=new ae.Z(n);var r=new L.Z({type:"route",geometry:s});const d=new L.Z({type:"limit",geometry:new M.Z(s.getFirstCoordinate())}),a=new L.Z({type:"limit",geometry:new M.Z(s.getLastCoordinate())}),p=new M.Z(s.getFirstCoordinate()),v=new L.Z({type:"movingNode",geometry:p});let m=new $.Z({features:[]}),u=new J.Z({source:m});[r,v,d,a].forEach((f,G)=>{f.setStyle(H(f.get("type"))),m.addFeature(f)}),u.set("name",C),this.map.addLayer(u);let K=Date.now(),k=0;u.on("postrender",f=>{const G=f.frameState.time;k=(k+100*(G-K)/1e6)%2,K=G;const We=s.getCoordinateAt(k>1?2-k:k);p.setCoordinates(We);const q=function oe(i){if(!(i.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");var r,o=i.inversePixelTransform[0],t=i.frameState,n=(0,se.Jp)(i.inversePixelTransform.slice(),t.coordinateToPixelTransform),s=(0,re.se)(t.viewState.resolution,o),d=(0,F.Cs)();return d&&(r=(0,F.WO)(d,t.viewState.projection)),new ne.Z(i.context,o,t.extent,n,t.viewState.rotation,s,r)}(f);q.setStyle(H("movingNode")),q.drawGeometry(p),this.map.render()})}popupMoving(t){c.Ys("#popup-feature-"+this.currentFeatureSelectedId).style("left",()=>t[0]+this.popupWidth+20>this.innerWidth?t[0]-this.popupWidth-15+"px":t[0]+15+"px").style("top",()=>t[1]+this.popupHeight+20>this.innerHeight?t[1]-this.popupHeight-15+"px":t[1]+15+"px")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(X.S),e.Y36(U),e.Y36(N.gz),e.Y36(De.Dx),e.Y36(be.L))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-map-view"]],decls:6,vars:5,consts:[[1,"d-flex","flex-column","flex-xl-row","justify-content-around","align-items-center"],[3,"currentActivityIdSelected","map"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["activitiesPopups",""],["class","col-md-4 item card shadow map-popup",3,"id",4,"ngFor","ngForOf"],[1,"col-md-4","item","card","shadow","map-popup",3,"id"],[1,"card-body"],[1,"row","justify-content-around"],[1,"col-lg-12","mb-1"],[1,"fw-bolder","small"],[4,"ngIf","ngIfThen"],["ImgActivity",""],[1,"col-8","my-auto"],[1,"small"],[1,"me-2","text-danger",3,"icon"],[4,"ngIf","ngIfThen","ngIfElse"],["pastJob",""],["currentJob",""],[1,"col-4","my-auto","justify-content-around","text-center"],[1,"img-fluid","rounded","mx-auto","d-block","shadow","mini-img-thumbnail",3,"src"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-theme-legend")(2,"app-time-legend",1),e.qZA(),e.YNc(3,Oe,1,0,"ng-container",2),e.YNc(4,Je,1,1,"ng-template",null,3,e.W1O)),2&t){const s=e.MAs(5);e.xp6(2),e.Q6J("currentActivityIdSelected",n.fragment)("map",n.map),e.xp6(1),e.Q6J("ngTemplateOutlet",s)("ngTemplateOutletContext",e.DdM(4,$e))}},directives:[Ne,Fe,y.tP,y.sg,y.O5,I.BN],pipes:[y.uU],styles:['.map-popup{position:fixed;display:none;background-color:#f8f8ff;max-width:400px}#map-title{background-color:#f1f1f1c9!important;padding:10px;border-bottom-right-radius:25px;border-bottom-left-radius:25px}#map-title:after{left:-30px;border-top:30px solid salmon;border-left:30px solid transparent;z-index:-10}.mini-img-thumbnail{width:15vw}.train-line{stroke:#000;stroke-width:3px}.train-marker{fill:#ff0;stroke:#000;stroke-width:3px;color:#000}.train-marker-text{font-family:"Font Awesome 5 Free";font-weight:900;color:#000;text-anchor:middle;dominant-baseline:middle;pointer-events:none}\n'],encapsulation:2}),i})(),data:{title:"Carte des activit\xe9s",page:"map-activities"},outlet:"map-activities"}];let Be=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[N.Bz.forChild(je)],N.Bz]}),i})(),Qe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[U],imports:[[y.ez,Be,I.uH]]}),i})()}}]);