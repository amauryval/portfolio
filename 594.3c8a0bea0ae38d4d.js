"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[594],{4594:(En,it,p)=>{p.r(it),p.d(it,{MapSandboxModule:()=>W});var S=p(6895),j=p(4006),B=p(2216),Ge=p(9371),_=p(2687),i=p(4650),Ae=p(999),kt=p(926),R=p(7579);class O{constructor(){this.layerIdSelected=new R.x,this.layerObjectSelected=new R.x,this.selectableLayerId=new R.x,this.selectableAllLayers=new R.x,this.editBarActivation=new R.x,this.removeLayers=new R.x,this.selectingLayerStatus=new R.x}activateEditBar(e){this.editBarActivation.next(e)}removeAllLayers(){this.removeLayers.next(!0)}setSelectingLayers(e){this.selectingLayerStatus.next(e)}setSelectableLayer(e){this.selectableLayerId.next(e)}setSelectableAllLayers(){this.selectableAllLayers.next(!0)}sendSelectedLayerId(e){this.layerIdSelected.next(e)}sendSelectedLayer(e){this.layerObjectSelected.next(e)}}O.\u0275fac=function(e){return new(e||O)},O.\u0275prov=i.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"});var Zt=p(6422),nt=p(9851),y=p(6003),k=p(1729);const Oe="projection",st="coordinateFormat",At=class Gt extends Zt.Z{constructor(e){e=e||{};const t=document.createElement("div");t.className=void 0!==e.className?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.addChangeListener(Oe,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=void 0!==e.placeholder,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(st)}getProjection(){return this.get(Oe)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push((0,k.oL)(t,nt.Z.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push((0,k.oL)(t,nt.Z.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(st,e)}setProjection(e){this.set(Oe,(0,y.U2)(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const r=this.getProjection();this.transform_=r?(0,y.WO)(this.mapProjection_,r):y.gD}const s=this.getMap().getCoordinateFromPixelInternal(e);if(s){const r=(0,y.Cs)();r&&(this.transform_=(0,y.WO)(this.mapProjection_,r)),this.transform_(s,s);const a=this.getCoordinateFormat();t=a?a(s):s.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}};var w=p(3481);function Ot(o,e){if(1&o){const t=i.EpF();i.ynx(0),i._UZ(1,"input",13),i.TgZ(2,"label",14),i.NdJ("click",function(){const r=i.CHM(t).$implicit,a=i.oxw();return i.KtG(a.setProjection(r))}),i.TgZ(3,"div",15)(4,"span"),i._uU(5),i.qZA()()(),i.BQk()}if(2&o){const t=e.$implicit,n=e.index,s=i.oxw();i.xp6(1),i.Q6J("id","btnradio-selector-"+n)("checked",s.currentEpsg===t),i.xp6(1),i.Q6J("for","btnradio-selector-"+n),i.xp6(1),i.Q6J("ngClass",s.currentEpsg===t?"bg-info text-white ":""),i.xp6(2),i.Oqu(t)}}class X{constructor(e){this.mapService=e}ngOnInit(){}ngAfterViewInit(){this.initMousePosition()}ngOnDestroy(){}initMousePosition(){let e;e=document.getElementById("mouseCoordinates"),this.mousePositionControl=new At({coordinateFormat:this.setPrecisionFunc(4),placeholder:"x :<br>y : ",className:"mouse-position",target:e}),this.map.addControl(this.mousePositionControl)}updatePrecision(e){return this.mousePositionControl.setCoordinateFormat(this.setPrecisionFunc(e.target.value))}setPrecisionFunc(e){return function(n){return(0,w.WU)(n,"x : {x}<br>y : {y}",e)}}setMapEpsg(){this.currentEpsg=this.map.getView().getProjection().getCode()}setProjection(e){this.currentEpsg=e,this.mapService.setProjectionOnMap(e),this.setMapEpsg()}}X.\u0275fac=function(e){return new(e||X)(i.Y36(Ae.S))},X.\u0275cmp=i.Xpm({type:X,selectors:[["app-geoinfo"]],inputs:{currentEpsg:"currentEpsg",map:"map",epsgAvailable:"epsgAvailable"},decls:17,vars:1,consts:[[1,"d-flex","flex-row","align-items-center","justify-content-center","bg-info","text-white","p-2","px-3"],[1,"fw-bold"],["id","infosContainer",1,"d-flex","flex-column","mx-3"],[1,"d-flex","flex-row","my-1","justify-content-evenly"],[1,"d-flex","flex-column"],["id","epsgList",1,"btn-group-vertical","my-2","align-self-center","bg-white","rounded-3","border"],[4,"ngFor","ngForOf"],[1,"d-flex","flex-column","align-items-center","justify-content-center","small","mx-2"],[1,"d-flex","flex-column","align-items-center","justify-content-center","small"],[1,"fw-bold","m-2"],["id","precision","type","number","min","0","max","12","value","4",1,"small",3,"change"],[1,"d-flex","flex-column","align-items-center","align-self-center","justify-content-center","small","mb-3"],["id","mouseCoordinates"],["type","radio","name","btnRadio","autocomplete","off",1,"border","btn-check","mx-1",3,"id","checked"],[1,"pointer",3,"for","click"],[1,"dropdown-item","small","d-flex","flex-row",3,"ngClass"]],template:function(e,t){1&e&&(i.TgZ(0,"div",0)(1,"span",1),i._uU(2,"Informations"),i.qZA()(),i.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5),i.YNc(7,Ot,6,5,"ng-container",6),i.qZA()(),i.TgZ(8,"div",7)(9,"div",8)(10,"span",9),i._uU(11,"Pr\xe9cision"),i.qZA(),i.TgZ(12,"input",10),i.NdJ("change",function(s){return t.updatePrecision(s)}),i.qZA()()()(),i.TgZ(13,"div",11)(14,"span",1),i._uU(15,"Coordonn\xe9es"),i.qZA(),i._UZ(16,"span",12),i.qZA()()),2&e&&(i.xp6(7),i.Q6J("ngForOf",t.epsgAvailable))},dependencies:[S.mk,S.sg],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}"]});var G=p(3171),z=p(9972),Dt=p(7660),x=p(760);class he extends Dt.Z{constructor(e){super(),this.geometries_=e||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(k.bN),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push((0,k.oL)(this.geometries_[e],z.Z.CHANGE,this.changed,this))}clone(){const e=new he(null);return e.setGeometries(this.geometries_),e.applyProperties(this),e}closestPointXY(e,t,n,s){if(s<(0,x.qf)(this.getExtent(),e,t))return s;const r=this.geometries_;for(let a=0,l=r.length;a<l;++a)s=r[a].closestPointXY(e,t,n,s);return s}containsXY(e,t){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)if(n[s].containsXY(e,t))return!0;return!1}computeExtent(e){(0,x.YN)(e);const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)(0,x.l7)(e,t[n].getExtent());return e}getGeometries(){return rt(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)t[n].getType()===this.getType()?e=e.concat(t[n].getGeometriesArrayRecursive()):e.push(t[n]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],n=this.geometries_;let s=!1;for(let r=0,a=n.length;r<a;++r){const l=n[r],c=l.getSimplifiedGeometry(e);t.push(c),c!==l&&(s=!0)}if(s){const r=new he(null);return r.setGeometriesArray(t),r}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)if(t[n].intersectsExtent(e))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(e,t){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].rotate(e,t);this.changed()}scale(e,t,n){n||(n=(0,x.qg)(this.getExtent()));const s=this.geometries_;for(let r=0,a=s.length;r<a;++r)s[r].scale(e,t,n);this.changed()}setGeometries(e){this.setGeometriesArray(rt(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let n=0,s=t.length;n<s;++n)t[n].applyTransform(e);this.changed()}translate(e,t){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function rt(o){const e=[];for(let t=0,n=o.length;t<n;++t)e.push(o[t].clone());return e}const $=he;var T=p(119);const ot=class Nt{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let n=t.dataProjection?(0,y.U2)(t.dataProjection):this.readProjection(e);t.extent&&n&&"tile-pixels"===n.getUnits()&&(n=(0,y.U2)(n),n.setWorldExtent(t.extent)),t={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},e)}getType(){return(0,T.O3)()}readFeature(e,t){return(0,T.O3)()}readFeatures(e,t){return(0,T.O3)()}readGeometry(e,t){return(0,T.O3)()}readProjection(e){return(0,T.O3)()}writeFeature(e,t){return(0,T.O3)()}writeFeatures(e,t){return(0,T.O3)()}writeGeometry(e,t){return(0,T.O3)()}};function ue(o,e,t){const n=t?(0,y.U2)(t.featureProjection):null,s=t?(0,y.U2)(t.dataProjection):null;let r;if(r=n&&s&&!(0,y.OP)(n,s)?(e?o.clone():o).transform(e?n:s,e?s:n):o,e&&t&&void 0!==t.decimals){const a=Math.pow(10,t.decimals),l=function(c){for(let d=0,h=c.length;d<h;++d)c[d]=Math.round(c[d]*a)/a;return c};r===o&&(r=o.clone()),r.applyTransform(l)}return r}function ge(o){return"string"==typeof o?JSON.parse(o)||null:null!==o?o:null}const Rt=class jt extends ot{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(ge(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(ge(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return(0,T.O3)()}readFeaturesFromObject(e,t){return(0,T.O3)()}readGeometry(e,t){return this.readGeometryFromObject(ge(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return(0,T.O3)()}readProjection(e){return this.readProjectionFromObject(ge(e))}readProjectionFromObject(e){return(0,T.O3)()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return(0,T.O3)()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return(0,T.O3)()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return(0,T.O3)()}};var D=p(6527),V=p(2774),fe=p(5066),pe=p(8999),at=p(9182),J=p(2456),De=p(392),lt=p(410),ct=p(9644);class me extends V.ZP{constructor(e,t,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(void 0!==t&&n)this.setFlatCoordinates(t,e),this.ends_=n;else{let s=this.getLayout();const r=e,a=[],l=[];for(let c=0,d=r.length;c<d;++c){const h=r[c];0===c&&(s=h.getLayout()),(0,J.l7)(a,h.getFlatCoordinates()),l.push(a.length)}this.setFlatCoordinates(s,a),this.ends_=l}}appendLineString(e){this.flatCoordinates?(0,J.l7)(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new me(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,s){return s<(0,x.qf)(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,fe.Af)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,fe.Xl)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,n,s))}getCoordinateAtM(e,t,n){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(0,lt.dG)(this.flatCoordinates,0,this.ends_,this.stride,e,t=void 0!==t&&t,n=void 0!==n&&n)}getCoordinates(){return(0,De.o1)(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new D.Z(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,n=this.layout,s=[];let r=0;for(let a=0,l=t.length;a<l;++a){const c=t[a],d=new D.Z(e.slice(r,c),n);s.push(d),r=c}return s}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let n=0;const s=this.ends_,r=this.stride;for(let a=0,l=s.length;a<l;++a){const c=s[a],d=(0,lt.WW)(t,n,c,r,.5);(0,J.l7)(e,d),n=c}return e}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=(0,at.UJ)(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,n),new me(t,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(e){return(0,ct.AW)(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=(0,pe._5)(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===n.length?0:n[n.length-1],this.changed()}}const ye=me;var N=p(187),ee=p(2156);class Ne extends V.ZP{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){this.flatCoordinates?(0,J.l7)(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.changed()}clone(){const e=new Ne(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){if(s<(0,x.qf)(this.getExtent(),e,t))return s;const r=this.flatCoordinates,a=this.stride;for(let l=0,c=r.length;l<c;l+=a){const d=(0,ee.bI)(e,t,r[l],r[l+1]);if(d<s){s=d;for(let h=0;h<a;++h)n[h]=r[l+h];n.length=a}}return s}getCoordinates(){return(0,De.Ml)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){return e<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=e?null:new N.Z(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,n=this.stride,s=[];for(let r=0,a=e.length;r<a;r+=n){const l=new N.Z(e.slice(r,r+n),t);s.push(l)}return s}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,n=this.stride;for(let s=0,r=t.length;s<r;s+=n)if((0,x.jE)(e,t[s],t[s+1]))return!0;return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,pe.Sg)(this.flatCoordinates,0,e,this.stride),this.changed()}}const _e=Ne;var A=p(2275),Jt=p(2474),je=p(1265),Ut=p(8818),Vt=p(4325);class Ce extends V.ZP{constructor(e,t,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(e[0])){let s=this.getLayout();const r=e,a=[],l=[];for(let c=0,d=r.length;c<d;++c){const h=r[c];0===c&&(s=h.getLayout());const g=a.length,u=h.getEnds();for(let f=0,m=u.length;f<m;++f)u[f]+=g;(0,J.l7)(a,h.getFlatCoordinates()),l.push(u)}t=s,e=a,n=l}void 0!==t&&n?(this.setFlatCoordinates(t,e),this.endss_=n):this.setCoordinates(e,t)}appendPolygon(e){let t;if(this.flatCoordinates){const n=this.flatCoordinates.length;(0,J.l7)(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let s=0,r=t.length;s<r;++s)t[s]+=n}else this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let s=0;s<e;++s)t[s]=this.endss_[s].slice();const n=new Ce(this.flatCoordinates.slice(),this.layout,t);return n.applyProperties(this),n}closestPointXY(e,t,n,s){return s<(0,x.qf)(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,fe.sD)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,fe.gI)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,n,s))}containsXY(e,t){return(0,Vt.Zl)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return(0,Ut.Eu)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),(0,je.dL)(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,(0,De.ug)(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=function Bt(o,e,t,n){const s=[];let r=(0,x.lJ)();for(let a=0,l=t.length;a<l;++a){const c=t[a];r=(0,x.GN)(o,e,c[0],n),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=c[c.length-1]}return s}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=(0,Jt.U)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new _e(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;(0,je.Oj)(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=(0,je.dL)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=(0,at.Pp)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,n),new Ce(t,"XY",n)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(0===e)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const n=this.endss_[e].slice(),s=n[n.length-1];if(0!==t)for(let r=0,a=n.length;r<a;++r)n[r]-=t;return new A.ZP(this.flatCoordinates.slice(t,s),this.layout,n)}getPolygons(){const e=this.layout,t=this.flatCoordinates,n=this.endss_,s=[];let r=0;for(let a=0,l=n.length;a<l;++a){const c=n[a].slice(),d=c[c.length-1];if(0!==r)for(let g=0,u=c.length;g<u;++g)c[g]-=r;const h=new A.ZP(t.slice(r,d),e,c);s.push(h),r=d}return s}getType(){return"MultiPolygon"}intersectsExtent(e){return(0,ct.oW)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=(0,pe.QT)(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===n.length)this.flatCoordinates.length=0;else{const s=n[n.length-1];this.flatCoordinates.length=0===s.length?0:s[s.length-1]}this.changed()}}const xe=Ce;var Qt=p(1911),qt=p(9466);function Re(o,e){if(!o)return null;let t;switch(o.type){case"Point":t=function Kt(o){return new N.Z(o.coordinates)}(o);break;case"LineString":t=function Wt(o){return new D.Z(o.coordinates)}(o);break;case"Polygon":t=function ei(o){return new A.ZP(o.coordinates)}(o);break;case"MultiPoint":t=function zt(o){return new _e(o.coordinates)}(o);break;case"MultiLineString":t=function Xt(o){return new ye(o.coordinates)}(o);break;case"MultiPolygon":t=function $t(o){return new xe(o.coordinates)}(o);break;case"GeometryCollection":t=function Yt(o,e){const t=o.geometries.map(function(n){return Re(n,e)});return new $(t)}(o);break;default:throw new Error("Unsupported GeoJSON type: "+o.type)}return ue(t,!1,e)}function Je(o,e){const t=(o=ue(o,!0,e)).getType();let n;switch(t){case"Point":n=function oi(o,e){return{type:"Point",coordinates:o.getCoordinates()}}(o);break;case"LineString":n=function ii(o,e){return{type:"LineString",coordinates:o.getCoordinates()}}(o);break;case"Polygon":n=function ai(o,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:o.getCoordinates(t)}}(o,e);break;case"MultiPoint":n=function si(o,e){return{type:"MultiPoint",coordinates:o.getCoordinates()}}(o);break;case"MultiLineString":n=function ni(o,e){return{type:"MultiLineString",coordinates:o.getCoordinates()}}(o);break;case"MultiPolygon":n=function ri(o,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:o.getCoordinates(t)}}(o,e);break;case"GeometryCollection":n=function ti(o,e){return delete(e=Object.assign({},e)).featureProjection,{type:"GeometryCollection",geometries:o.getGeometriesArray().map(function(n){return Je(n,e)})}}(o,e);break;case"Circle":n={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+t)}return n}const dt=class Ht extends Rt{constructor(e){e=e||{},super(),this.dataProjection=(0,y.U2)(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=(0,y.U2)(e.featureProjection)),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let n=null;n="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null};const s=Re(n.geometry,t),r=new G.Z;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&r.setGeometryName(n.geometry_name),r.setGeometry(s),"id"in n&&r.setId(n.id),n.properties&&r.setProperties(n.properties,!0),r}readFeaturesFromObject(e,t){let s=null;if("FeatureCollection"===e.type){s=[];const a=e.features;for(let l=0,c=a.length;l<c;++l)s.push(this.readFeatureFromObject(a[l],t))}else s=[this.readFeatureFromObject(e,t)];return s}readGeometryFromObject(e,t){return Re(e,t)}readProjectionFromObject(e){const t=e.crs;let n;return t?"name"==t.type?n=(0,y.U2)(t.properties.name):"EPSG"===t.type?n=(0,y.U2)("EPSG:"+t.properties.code):(0,Qt.h)(!1,36):n=this.dataProjection,n}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={type:"Feature",geometry:null,properties:null},s=e.getId();if(void 0!==s&&(n.id=s),!e.hasProperties())return n;const r=e.getProperties(),a=e.getGeometry();return a&&(n.geometry=Je(a,t),delete r[e.getGeometryName()]),(0,qt.x)(r)||(n.properties=r),n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let s=0,r=e.length;s<r;++s)n.push(this.writeFeatureObject(e[s],t));return{type:"FeatureCollection",features:n}}writeGeometryObject(e,t){return Je(e,this.adaptOptions(t))}};var Te,li=new Uint8Array(16);function ci(){if(!Te&&!(Te=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Te(li)}const di=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,ui=function hi(o){return"string"==typeof o&&di.test(o)};for(var F=[],Ue=0;Ue<256;++Ue)F.push((Ue+256).toString(16).substr(1));const ht=function pi(o,e,t){var n=(o=o||{}).random||(o.rng||ci)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=n[s];return e}return function gi(o){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=(F[o[e+0]]+F[o[e+1]]+F[o[e+2]]+F[o[e+3]]+"-"+F[o[e+4]]+F[o[e+5]]+"-"+F[o[e+6]]+F[o[e+7]]+"-"+F[o[e+8]]+F[o[e+9]]+"-"+F[o[e+10]]+F[o[e+11]]+F[o[e+12]]+F[o[e+13]]+F[o[e+14]]+F[o[e+15]]).toLowerCase();if(!ui(t))throw TypeError("Stringified UUID is invalid");return t}(n)};var be=p(9889),ve=p(5002),ut=p(2909),we=p(4412),Q=p(1345);function gt(o){return o.feature?o.feature:o.element?o.element:void 0}const Be=[],yi=class mi extends ve.Z{constructor(e){const t=e=e||{};t.handleDownEvent||(t.handleDownEvent=Q.uX),t.stopDown||(t.stopDown=Q.Dv),super(t),this.source_=e.source?e.source:null,this.vertex_=void 0===e.vertex||e.vertex,this.edge_=void 0===e.edge||e.edge,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.rBush_=new ut.Z,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(e,t){t=void 0===t||t;const n=(0,T.sq)(e),s=e.getGeometry();if(s){const r=this.GEOMETRY_SEGMENTERS_[s.getType()];if(r){this.indexedFeaturesExtents_[n]=s.getExtent((0,x.lJ)());const a=[];if(r(a,s),1===a.length)this.rBush_.insert((0,x.hI)(a[0]),{feature:e,segment:a[0]});else if(a.length>1){const l=a.map(d=>(0,x.hI)(d)),c=a.map(d=>({feature:e,segment:d}));this.rBush_.load(l,c)}}}t&&(this.featureChangeListenerKeys_[n]=(0,k.oL)(e,z.Z.CHANGE,this.handleFeatureChange_,this))}forEachFeatureAdd_(e){this.addFeature(e)}forEachFeatureRemove_(e){this.removeFeature(e)}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}handleEvent(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel),super.handleEvent(e)}handleFeatureAdd_(e){const t=gt(e);this.addFeature(t)}handleFeatureRemove_(e){const t=gt(e);this.removeFeature(t)}handleFeatureChange_(e){const t=e.target;if(this.handlingDownUpSequence){const n=(0,T.sq)(t);n in this.pendingFeatures_||(this.pendingFeatures_[n]=t)}else this.updateFeature_(t)}handleUpEvent(e){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(e,t){const n=void 0===t||t,s=(0,T.sq)(e),r=this.indexedFeaturesExtents_[s];if(r){const a=this.rBush_,l=[];a.forEachInExtent(r,function(c){e===c.feature&&l.push(c)});for(let c=l.length-1;c>=0;--c)a.remove(l[c])}n&&((0,k.bN)(this.featureChangeListenerKeys_[s]),delete this.featureChangeListenerKeys_[s])}setMap(e){const t=this.getMap(),n=this.featuresListenerKeys_,s=this.getFeatures_();t&&(n.forEach(k.bN),n.length=0,s.forEach(this.forEachFeatureRemove_.bind(this))),super.setMap(e),e&&(this.features_?n.push((0,k.oL)(this.features_,be.Z.ADD,this.handleFeatureAdd_,this),(0,k.oL)(this.features_,be.Z.REMOVE,this.handleFeatureRemove_,this)):this.source_&&n.push((0,k.oL)(this.source_,we.Z.ADDFEATURE,this.handleFeatureAdd_,this),(0,k.oL)(this.source_,we.Z.REMOVEFEATURE,this.handleFeatureRemove_,this)),s.forEach(this.forEachFeatureAdd_.bind(this)))}snapTo(e,t,n){const s=n.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),r=n.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),a=(0,x.hI)([s,r]),l=this.rBush_.getInExtent(a),c=l.length;if(0===c)return null;const d=n.getView().getProjection(),h=(0,y.Vs)(t,d);let g,u=1/0;const f=this.pixelTolerance_*this.pixelTolerance_,m=()=>{if(g){const C=n.getPixelFromCoordinate(g);if((0,w.bI)(e,C)<=f)return{vertex:g,vertexPixel:[Math.round(C[0]),Math.round(C[1])]}}return null};if(this.vertex_){for(let v=0;v<c;++v){const L=l[v];"Circle"!==L.feature.getGeometry().getType()&&L.segment.forEach(E=>{const P=(0,y.Vs)(E,d),M=(0,w.bI)(h,P);M<u&&(g=E,u=M)})}const C=m();if(C)return C}if(this.edge_){for(let v=0;v<c;++v){let L=null;const E=l[v];if("Circle"===E.feature.getGeometry().getType()){let P=E.feature.getGeometry();const M=(0,y.Cs)();M&&(P=P.clone().transform(M,d)),L=(0,y.lO)((0,w.Ed)(h,P),d)}else{const[P,M]=E.segment;M&&(Be[0]=(0,y.Vs)(P,d),Be[1]=(0,y.Vs)(M,d),L=(0,w.oL)(h,Be))}if(L){const P=(0,w.bI)(h,L);P<u&&(g=L,u=P)}}const C=m();if(C)return C}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}segmentCircleGeometry_(e,t){const n=this.getMap().getView().getProjection();let s=t;const r=(0,y.Cs)();r&&(s=s.clone().transform(r,n));const a=(0,A.Bb)(s);r&&a.transform(n,r);const l=a.getCoordinates()[0];for(let c=0,d=l.length-1;c<d;++c)e.push(l.slice(c,c+2))}segmentGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let s=0;s<n.length;++s){const r=this.GEOMETRY_SEGMENTERS_[n[s].getType()];r&&r(e,n[s])}}segmentLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length-1;s<r;++s)e.push(n.slice(s,s+2))}segmentMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let l=0,c=a.length-1;l<c;++l)e.push(a.slice(l,l+2))}}segmentMultiPointGeometry_(e,t){t.getCoordinates().forEach(n=>{e.push([n])})}segmentMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let l=0,c=a.length;l<c;++l){const d=a[l];for(let h=0,g=d.length-1;h<g;++h)e.push(d.slice(h,h+2))}}}segmentPointGeometry_(e,t){e.push([t.getCoordinates()])}segmentPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let l=0,c=a.length-1;l<c;++l)e.push(a.slice(l,l+2))}}};var te=p(2815),Ve=p(8214),ft=p(7366),Z=p(6597);class qe extends Ve.ZP{constructor(e,t,n,s,r){super(e),this.features=t,this.coordinate=n,this.startCoordinate=s,this.mapBrowserEvent=r}}const Ci=class _i extends ve.Z{constructor(e){let t;if(super(e=e||{}),this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=void 0!==e.features?e.features:null,e.layers&&!this.features_)if("function"==typeof e.layers)t=e.layers;else{const n=e.layers;t=function(s){return n.includes(s)}}else t=Q.uX;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:Q.uX,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:Z.Bx,this.lastFeature_=null,this.addChangeListener(ft.Z.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new te.Z([this.lastFeature_]);return this.dispatchEvent(new qe("translatestart",t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new te.Z([this.lastFeature_]);return this.dispatchEvent(new qe("translateend",t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate,n=t[0]-this.lastCoordinate_[0],s=t[1]-this.lastCoordinate_[1],r=this.features_||new te.Z([this.lastFeature_]);r.forEach(function(a){const l=a.getGeometry();l.translate(n,s),a.setGeometry(l)}),this.lastCoordinate_=t,this.dispatchEvent(new qe("translating",r,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,function(n,s){if(this.filter_(n,s)&&(!this.features_||this.features_.getArray().includes(n)))return n}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const n=this.getActive();(!t||!n)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}};var I=p(4624),He=p(7053),ie=p(5947),U=p(109);const mt=[0,0,0,0],q=[];class Ke extends Ve.ZP{constructor(e,t,n){super(e),this.features=t,this.mapBrowserEvent=n}}function Ti(o,e){return o.index-e.index}function yt(o,e,t){const n=e.geometry;if("Circle"===n.getType()){let r=n;if(1===e.index){const a=(0,y.Cs)();a&&(r=r.clone().transform(a,t));const l=(0,w.bI)(r.getCenter(),(0,y.Vs)(o,t)),c=Math.sqrt(l)-r.getRadius();return c*c}}const s=(0,y.Vs)(o,t);return q[0]=(0,y.Vs)(e.segment[0],t),q[1]=(0,y.Vs)(e.segment[1],t),(0,w.Bs)(s,q)}function _t(o,e,t){const n=e.geometry;if("Circle"===n.getType()&&1===e.index){let r=n;const a=(0,y.Cs)();return a&&(r=r.clone().transform(a,t)),(0,y.lO)(r.getClosestPoint((0,y.Vs)(o,t)),t)}const s=(0,y.Vs)(o,t);return q[0]=(0,y.Vs)(e.segment[0],t),q[1]=(0,y.Vs)(e.segment[1],t),(0,y.lO)((0,w.oL)(s,q),t)}function bi(){const o=(0,U.Ly)();return function(e,t){return o.Point}}const vi=class xi extends ve.Z{constructor(e){let t;if(super(e),this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Z.Xp,this.defaultDeleteCondition_=function(n){return(0,Z.Ko)(n)&&(0,Z.Kf)(n)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Z.Bx,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ut.Z,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new He.Z({source:new ie.Z({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:bi(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,e.features?t=e.features:e.source&&(this.source_=e.source,t=new te.Z(this.source_.getFeatures()),this.source_.addEventListener(we.Z.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(we.Z.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(be.Z.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(be.Z.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===e.snapToPointer?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),e.addEventListener(z.Z.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new te.Z;const n=this.featuresBeingModified_.getArray();for(let s=0,r=t.length;s<r;++s){const a=t[s];for(let l=0,c=a.length;l<c;++l){const d=a[l].feature;d&&!n.includes(d)&&this.featuresBeingModified_.push(d)}}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new Ke("modifystart",this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(z.Z.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,n=[];t.forEach(function(s){e===s.feature&&n.push(s)});for(let s=n.length-1;s>=0;--s){const r=n[s];for(let a=this.dragSegments_.length-1;a>=0;--a)this.dragSegments_[a][0]===r&&this.dragSegments_.splice(a,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const n=t.getCoordinates(),s={feature:e,geometry:t,segment:[n,n]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s],l={feature:e,geometry:t,depth:[s],index:s,segment:[a,a]};this.rBush_.insert(t.getExtent(),l)}}writeLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length-1;s<r;++s){const a=n.slice(s,s+2),l={feature:e,geometry:t,index:s,segment:a};this.rBush_.insert((0,x.hI)(a),l)}}writeMultiLineStringGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let l=0,c=a.length-1;l<c;++l){const d=a.slice(l,l+2),h={feature:e,geometry:t,depth:[s],index:l,segment:d};this.rBush_.insert((0,x.hI)(d),h)}}}writePolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let l=0,c=a.length-1;l<c;++l){const d=a.slice(l,l+2),h={feature:e,geometry:t,depth:[s],index:l,segment:d};this.rBush_.insert((0,x.hI)(d),h)}}}writeMultiPolygonGeometry_(e,t){const n=t.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let l=0,c=a.length;l<c;++l){const d=a[l];for(let h=0,g=d.length-1;h<g;++h){const u=d.slice(h,h+2),f={feature:e,geometry:t,depth:[l,s],index:h,segment:u};this.rBush_.insert((0,x.hI)(u),f)}}}}writeCircleGeometry_(e,t){const n=t.getCenter(),s={feature:e,geometry:t,index:0,segment:[n,n]},r={feature:e,geometry:t,index:1,segment:[n,n]},a=[s,r];s.featureSegments=a,r.featureSegments=a,this.rBush_.insert((0,x.HK)(n),s);let l=t;const c=(0,y.Cs)();if(c&&this.getMap()){const d=this.getMap().getView().getProjection();l=l.clone().transform(c,d),l=(0,A.Bb)(l).transform(d,c)}this.rBush_.insert(l.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const n=t.getGeometriesArray();for(let s=0;s<n.length;++s){const r=n[s];(0,this.SEGMENT_WRITERS_[r.getType()])(e,r)}}createOrUpdateVertexFeature_(e,t,n){let s=this.vertexFeature_;return s?s.getGeometry().setCoordinates(e):(s=new G.Z(new N.Z(e)),this.vertexFeature_=s,this.overlay_.getSource().addFeature(s)),s.set("features",t),s.set("geometries",n),s}handleEvent(e){if(!e.originalEvent)return!0;let t;return this.lastPointerEvent_=e,!e.map.getView().getInteracting()&&e.type==I.Z.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=!(e.type!=I.Z.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==I.Z.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],n=[],s=[];for(let r=0,a=this.dragSegments_.length;r<a;++r){const l=this.dragSegments_[r],c=l[0],d=c.feature;n.includes(d)||n.push(d);const h=c.geometry;s.includes(h)||s.push(h);const g=c.depth;let u;const f=c.segment,m=l[1];for(;t.length<h.getStride();)t.push(f[m][t.length]);switch(h.getType()){case"Point":u=t,f[0]=t,f[1]=t;break;case"MultiPoint":u=h.getCoordinates(),u[c.index]=t,f[0]=t,f[1]=t;break;case"LineString":u=h.getCoordinates(),u[c.index+m]=t,f[m]=t;break;case"MultiLineString":case"Polygon":u=h.getCoordinates(),u[g[0]][c.index+m]=t,f[m]=t;break;case"MultiPolygon":u=h.getCoordinates(),u[g[1]][g[0]][c.index+m]=t,f[m]=t;break;case"Circle":if(f[0]=t,f[1]=t,0===c.index)this.changingFeature_=!0,h.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const C=e.map.getView().getProjection();let v=(0,w.TE)((0,y.Vs)(h.getCenter(),C),(0,y.Vs)(t,C));const L=(0,y.Cs)();if(L){const E=h.clone().transform(L,C);E.setRadius(v),v=E.transform(C,L).getRadius()}h.setRadius(v),this.changingFeature_=!1}}u&&this.setGeometryCoordinates_(h,u)}this.createOrUpdateVertexFeature_(t,n,s)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(n){const s=e.map.getView().getProjection(),r=[],a=n.getGeometry().getCoordinates(),l=(0,x.hI)([a]),c=this.rBush_.getInExtent(l),d={};c.sort(Ti);for(let h=0,g=c.length;h<g;++h){const u=c[h],f=u.segment;let m=(0,T.sq)(u.geometry);const C=u.depth;if(C&&(m+="-"+C.join("-")),d[m]||(d[m]=new Array(2)),"Circle"!==u.geometry.getType()||1!==u.index)if(!(0,w.fS)(f[0],a)||d[m][0])if(!(0,w.fS)(f[1],a)||d[m][1])(0,T.sq)(f)in this.vertexSegments_&&!d[m][0]&&!d[m][1]&&this.insertVertexCondition_(e)&&r.push(u);else{if(d[m][0]&&0===d[m][0].index){let v=u.geometry.getCoordinates();switch(u.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":v=v[C[1]];case"Polygon":if(u.index!==v[C[0]].length-2)continue}}this.dragSegments_.push([u,1]),d[m][1]=u}else this.dragSegments_.push([u,0]),d[m][0]=u;else{const v=_t(t,u,s);(0,w.fS)(v,a)&&!d[m][0]&&(this.dragSegments_.push([u,0]),d[m][0]=u)}}r.length&&this.willModifyFeatures_(e,[r]);for(let h=r.length-1;h>=0;--h)this.insertVertex_(r[h],a)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const n=this.dragSegments_[t][0],s=n.geometry;if("Circle"===s.getType()){const r=s.getCenter(),a=n.featureSegments[0],l=n.featureSegments[1];a.segment[0]=r,a.segment[1]=r,l.segment[0]=r,l.segment[1]=r,this.rBush_.update((0,x.HK)(r),a);let c=s;const d=(0,y.Cs)();if(d){const h=e.map.getView().getProjection();c=c.clone().transform(d,h),c=(0,A.Bb)(c).transform(h,d)}this.rBush_.update(c.getExtent(),l)}else this.rBush_.update((0,x.hI)(n.segment),n)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ke("modifyend",this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,n){const s=n||t.getCoordinateFromPixel(e),r=t.getView().getProjection(),a=function(d,h){return yt(s,d,r)-yt(s,h,r)};let l,c;if(this.hitDetection_&&t.forEachFeatureAtPixel(e,(h,g,u)=>{if("Point"===(u=u||h.getGeometry()).getType()&&this.features_.getArray().includes(h)){c=u;const f=u.getFlatCoordinates().slice(0,2);l=[{feature:h,geometry:u,segment:[f,f]}]}return!0},{layerFilter:"object"==typeof this.hitDetection_?h=>h===this.hitDetection_:void 0}),!l){const d=(0,y.dY)((0,x.HK)(s,mt),r),h=t.getView().getResolution()*this.pixelTolerance_,g=(0,y.Fj)((0,x.f3)(d,h,mt),r);l=this.rBush_.getInExtent(g)}if(l&&l.length>0){const d=l.sort(a)[0],h=d.segment;let g=_t(s,d,r);const u=t.getPixelFromCoordinate(g);let f=(0,w.TE)(e,u);if(c||f<=this.pixelTolerance_){const m={};if(m[(0,T.sq)(h)]=!0,this.snapToPointer_||(this.delta_[0]=g[0]-s[0],this.delta_[1]=g[1]-s[1]),"Circle"===d.geometry.getType()&&1===d.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(g,[d.feature],[d.geometry]);else{const C=t.getPixelFromCoordinate(h[0]),v=t.getPixelFromCoordinate(h[1]),L=(0,w.bI)(u,C),E=(0,w.bI)(u,v);f=Math.sqrt(Math.min(L,E)),this.snappedToVertex_=f<=this.pixelTolerance_,this.snappedToVertex_&&(g=L>E?h[1]:h[0]),this.createOrUpdateVertexFeature_(g,[d.feature],[d.geometry]);const P={};P[(0,T.sq)(d.geometry)]=!0;for(let M=1,Sn=l.length;M<Sn;++M){const de=l[M].segment;if(!((0,w.fS)(h[0],de[0])&&(0,w.fS)(h[1],de[1])||(0,w.fS)(h[0],de[1])&&(0,w.fS)(h[1],de[0])))break;{const It=(0,T.sq)(l[M].geometry);It in P||(P[It]=!0,m[(0,T.sq)(de)]=!0)}}}return void(this.vertexSegments_=m)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const n=e.segment,s=e.feature,r=e.geometry,a=e.depth,l=e.index;let c;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":case"Polygon":c=r.getCoordinates(),c[a[0]].splice(l+1,0,t);break;case"MultiPolygon":c=r.getCoordinates(),c[a[1]][a[0]].splice(l+1,0,t);break;case"LineString":c=r.getCoordinates(),c.splice(l+1,0,t);break;default:return}this.setGeometryCoordinates_(r,c);const d=this.rBush_;d.remove(e),this.updateSegmentIndices_(r,l,a,1);const h={segment:[n[0],t],feature:s,geometry:r,depth:a,index:l};d.insert((0,x.hI)(h.segment),h),this.dragSegments_.push([h,1]);const g={segment:[t,n[1]],feature:s,geometry:r,depth:a,index:l+1};d.insert((0,x.hI)(g.segment),g),this.dragSegments_.push([g,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=I.Z.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ke("modifyend",this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let s,r,a,l,c,d,h,g,u,f,m,n=!1;for(c=e.length-1;c>=0;--c)a=e[c],f=a[0],m=(0,T.sq)(f.feature),f.depth&&(m+="-"+f.depth.join("-")),m in t||(t[m]={}),0===a[1]?(t[m].right=f,t[m].index=f.index):1==a[1]&&(t[m].left=f,t[m].index=f.index+1);for(m in t){switch(u=t[m].right,h=t[m].left,d=t[m].index,g=d-1,f=void 0!==h?h:u,g<0&&(g=0),l=f.geometry,r=l.getCoordinates(),s=r,n=!1,l.getType()){case"MultiLineString":r[f.depth[0]].length>2&&(r[f.depth[0]].splice(d,1),n=!0);break;case"LineString":r.length>2&&(r.splice(d,1),n=!0);break;case"MultiPolygon":s=s[f.depth[1]];case"Polygon":s=s[f.depth[0]],s.length>4&&(d==s.length-1&&(d=0),s.splice(d,1),n=!0,0===d&&(s.pop(),s.push(s[0]),g=s.length-1))}if(n){this.setGeometryCoordinates_(l,r);const C=[];if(void 0!==h&&(this.rBush_.remove(h),C.push(h.segment[0])),void 0!==u&&(this.rBush_.remove(u),C.push(u.segment[1])),void 0!==h&&void 0!==u){const v={depth:f.depth,feature:f.feature,geometry:f.geometry,index:g,segment:C};this.rBush_.insert((0,x.hI)(v.segment),v)}this.updateSegmentIndices_(l,d,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return n}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,n,s){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(void 0===n||void 0===r.depth||(0,J.fS)(r.depth,n))&&r.index>t&&(r.index+=s)})}};var Ct=p(874);class Pe extends V.ZP{constructor(e,t,n){super(),void 0!==n&&void 0===t?this.setFlatCoordinates(n,e):this.setCenterAndRadius(e,t=t||0,n)}clone(){const e=new Pe(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,s){const r=this.flatCoordinates,a=e-r[0],l=t-r[1],c=a*a+l*l;if(c<s){if(0===c)for(let d=0;d<this.stride;++d)n[d]=r[d];else{const d=this.getRadius()/Math.sqrt(c);n[0]=r[0]+d*a,n[1]=r[1]+d*l;for(let h=2;h<this.stride;++h)n[h]=r[h]}return n.length=this.stride,c}return s}containsXY(e,t){const n=this.flatCoordinates,s=e-n[0],r=t-n[1];return s*s+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return(0,x.T9)(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if((0,x.kK)(e,t)){const n=this.getCenter();return e[0]<=n[0]&&e[2]>=n[0]||e[1]<=n[1]&&e[3]>=n[1]||(0,x.H6)(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,n=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+n;for(let r=1;r<t;++r)s[t+r]=e[r];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let r=(0,pe.IG)(s,0,e,this.stride);s[r++]=s[0]+t;for(let a=1,l=this.stride;a<l;++a)s[r++]=s[a];s.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),s=this.getStride();this.setCenter((0,Ct.U1)(n,0,n.length,s,e,t,n)),this.changed()}translate(e,t){const n=this.getCenter(),s=this.getStride();this.setCenter((0,Ct.Iu)(n,0,n.length,s,e,t,n)),this.changed()}}const wi=Pe;var Pi=p(1994);class Le extends Ve.ZP{constructor(e,t){super(e),this.feature=t}}function Se(o,e){return(0,ee.bI)(o[0],o[1],e[0],e[1])}function H(o,e){const t=o.length;return e<0?o[e+t]:e>=t?o[e-t]:o[e]}function Ee(o,e,t){let n,s;e<t?(n=e,s=t):(n=t,s=e);const r=Math.ceil(n),a=Math.floor(s);if(r>a)return Se(Y(o,n),Y(o,s));let l=0;n<r&&(l+=Se(Y(o,n),H(o,r))),a<s&&(l+=Se(H(o,a),Y(o,s)));for(let c=r;c<a-1;++c)l+=Se(H(o,c),H(o,c+1));return l}function xt(o,e,t){if(e instanceof D.Z)Me(o,e.getCoordinates(),!1,t);else if(e instanceof ye){const n=e.getCoordinates();for(let s=0,r=n.length;s<r;++s)Me(o,n[s],!1,t)}else if(e instanceof A.ZP){const n=e.getCoordinates();for(let s=0,r=n.length;s<r;++s)Me(o,n[s],!0,t)}else if(e instanceof xe){const n=e.getCoordinates();for(let s=0,r=n.length;s<r;++s){const a=n[s];for(let l=0,c=a.length;l<c;++l)Me(o,a[l],!0,t)}}else if(e instanceof $){const n=e.getGeometries();for(let s=0;s<n.length;++s)xt(o,n[s],t)}}const We={index:-1,endIndex:NaN};function Me(o,e,t,n){const s=o[0],r=o[1];for(let a=0,l=e.length-1;a<l;++a){const h=Tt(s,r,e[a],e[a+1]);if(0===h.squaredDistance){const g=a+h.along;return void n.push({coordinates:e,ring:t,startIndex:g,endIndex:g})}}}const Xe={along:0,squaredDistance:0};function Tt(o,e,t,n){const s=t[0],r=t[1],c=n[0]-s,d=n[1]-r;let h=0,g=s,u=r;return(0!==c||0!==d)&&(h=(0,ee.uZ)(((o-s)*c+(e-r)*d)/(c*c+d*d),0,1),g+=c*h,u+=d*h),Xe.along=h,Xe.squaredDistance=(0,ee.FH)((0,ee.bI)(o,e,g,u),10),Xe}function Y(o,e){const t=o.length;let n=Math.floor(e);const s=e-n;n>=t?n-=t:n<0&&(n+=t);let r=n+1;r>=t&&(r-=t);const a=o[n],l=a[0],c=a[1],d=o[r];return[l+(d[0]-l)*s,c+(d[1]-c)*s]}function Ei(){const o=(0,U.Ly)();return function(e,t){return o[e.getGeometry().getType()]}}const Ii=class Si extends ve.Z{constructor(e){const t=e;t.stopDown||(t.stopDown=Q.Dv),super(t),this.shouldHandle_=!1,this.downPx_=null,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function Mi(o){switch(o){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+o)}}(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Q.uX,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let n=e.geometryFunction;if(!n){const s=this.mode_;if("Circle"===s)n=function(r,a,l){const c=a||new wi([NaN,NaN]),d=(0,y.Vs)(r[0],l),h=(0,w.bI)(d,(0,y.Vs)(r[r.length-1],l));c.setCenterAndRadius(d,Math.sqrt(h),this.geometryLayout_);const g=(0,y.Cs)();return g&&c.transform(l,g),c};else{let r;"Point"===s?r=N.Z:"LineString"===s?r=D.Z:"Polygon"===s&&(r=A.ZP),n=function(a,l,c){return l?l.setCoordinates("Polygon"===s?a[0].length?[a[0].concat([a[0][0]])]:[]:a,this.geometryLayout_):l=new r(a,this.geometryLayout_),l}}}this.geometryFunction_=n,this.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new He.Z({source:new ie.Z({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:Ei(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Z.rM,this.freehandCondition_=e.freehand?Z.Bx:e.freehandCondition?e.freehandCondition:Z.vY,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(ft.Z.ACTIVE,this.updateState_)}setTrace(e){let t;t=e?!0===e?Z.Bx:e:Z.Fi,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===z.Z.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(e);let t=e.type===I.Z.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&e.type===I.Z.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===I.Z.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),n=!1):this.freehand_&&e.type===I.Z.POINTERDOWN?n=!1:t&&this.getPointerCount()<2?(n=e.type===I.Z.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):("mouse"===e.originalEvent.pointerType||e.type===I.Z.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e)):e.type===I.Z.DBLCLICK&&(n=!1),super.handleEvent(e)&&n}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new Pi.Z(I.Z.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active)return void this.deactivateTrace_();const t=this.getMap(),n=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=(0,x.hI)([n,s]),a=this.traceSource_.getFeaturesInExtent(r);if(0===a.length)return;const l=function Fi(o,e){const t=[];for(let n=0;n<e.length;++n)xt(o,e[n].getGeometry(),t);return t}(e.coordinate,a);l.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:l,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const n=e.startIndex<=e.endIndex;n===e.startIndex<=t?n&&t>e.endIndex||!n&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(n&&t<e.endIndex||!n&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let n=0;if(e<t){const s=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),n=r-s+1}else{const s=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),n=s-r+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(e,t,n){if(t===n)return;const s=[];if(t<n){const r=Math.ceil(t);let a=Math.floor(n);a===n&&(a-=1);for(let l=r;l<=a;++l)s.push(H(e.coordinates,l))}else{const r=Math.floor(t);let a=Math.ceil(n);a===n&&(a+=1);for(let l=r;l>=a;--l)s.push(H(e.coordinates,l))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active||-1===t.targetIndex&&(0,w.TE)(t.startPx,e.pixel)<this.snapTolerance_)return;const n=function Li(o,e,t,n){const s=o[0],r=o[1];let a=1/0,l=-1,c=NaN;for(let g=0;g<e.targets.length;++g){const u=e.targets[g],f=u.coordinates;let C,m=1/0;for(let v=0;v<f.length-1;++v){const P=Tt(s,r,f[v],f[v+1]);P.squaredDistance<m&&(m=P.squaredDistance,C=v+P.along)}m<a&&(a=m,u.ring&&e.targetIndex===g&&(u.endIndex>u.startIndex?C<u.startIndex&&(C+=f.length):u.endIndex<u.startIndex&&C>u.startIndex&&(C-=f.length)),c=C,l=g)}const d=e.targets[l];let h=d.ring;if(e.targetIndex===l&&h){const g=Y(d.coordinates,c),u=t.getPixelFromCoordinate(g);(0,w.TE)(u,e.startPx)>n&&(h=!1)}if(h){const g=d.coordinates,u=g.length,f=d.startIndex,m=c;if(f<m){const C=Ee(g,f,m);Ee(g,f,m-u)<C&&(c-=u)}else{const C=Ee(g,f,m);Ee(g,f,m+u)<C&&(c+=u)}}return We.index=l,We.endIndex=c,We}(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==n.index){if(-1!==t.targetIndex){const c=t.targets[t.targetIndex];this.removeTracedCoordinates_(c.startIndex,c.endIndex)}const l=t.targets[n.index];this.addTracedCoordinates_(l,l.startIndex,n.endIndex)}else this.addOrRemoveTracedCoordinates_(t.targets[t.targetIndex],n.endIndex);t.targetIndex=n.index;const s=t.targets[t.targetIndex];s.endIndex=n.endIndex;const r=Y(s.coordinates,s.endIndex),a=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(a[0]),Math.round(a[1])]}handleUpEvent(e){let t=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const n=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||"Point"===this.mode_)&&(this.atFinish_(e.pixel,n)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,n=e.pixel,s=t[0]-n[0],r=t[1]-n[1],a=s*s+r*r;if(this.shouldHandle_=this.freehand_?a>this.squaredClickTolerance_:a<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(e),this.modifyDrawing_(e.coordinate)):this.createOrUpdateSketchPoint_(e.coordinate.slice())}atFinish_(e,t){let n=!1;if(this.sketchFeature_){let s=!1,r=[this.finishCoordinate_];const a=this.mode_;if("Point"===a)n=!0;else if("Circle"===a)n=2===this.sketchCoords_.length;else if("LineString"===a)s=!t&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===a){const l=this.sketchCoords_;s=l[0].length>this.minPoints_,r=[l[0][0],l[0][l[0].length-2]],r=t?[l[0][0]]:[l[0][0],l[0][l[0].length-2]]}if(s){const l=this.getMap();for(let c=0,d=r.length;c<d;c++){const h=r[c],g=l.getPixelFromCoordinate(h),u=e[0]-g[0],f=e[1]-g[1],m=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(u*u+f*f)<=m,n){this.finishCoordinate_=h;break}}}}return n}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new G.Z(new N.Z(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new G.Z);const t=e.getLinearRing(0);let n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),n.changed()):(n=new D.Z(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(e){const t=this.getMap().getView().getProjection(),n=(0,V.tP)(this.geometryLayout_);for(;e.length<n;)e.push(0);this.finishCoordinate_=e,"Point"===this.mode_?this.sketchCoords_=e.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new G.Z(new D.Z(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new G.Z,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new Le("drawstart",this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),n=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),r=(0,V.tP)(this.geometryLayout_);let a,l;for(;e.length<r;)e.push(0);"Point"===this.mode_?l=this.sketchCoords_:"Polygon"===this.mode_?(a=this.sketchCoords_[0],l=a[a.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(a=this.sketchCoords_,l=a[a.length-1]),l[0]=e[0],l[1]=e[1],this.geometryFunction_(this.sketchCoords_,n,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),"Polygon"===n.getType()&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();let s,r;const a=this.mode_;"LineString"===a||"Circle"===a?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(e.slice()),this.geometryFunction_(r,t,n)):"Polygon"===a&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():s=!0),r.push(e.slice()),s&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,n)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s&&this.finishDrawing()}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),s=this.mode_;for(let r=0;r<e;++r){let a;if("LineString"===s||"Circle"===s){if(a=this.sketchCoords_,a.splice(-2,1),a.length>=2){this.finishCoordinate_=a[a.length-2].slice();const l=this.finishCoordinate_.slice();a[a.length-1]=l,this.createOrUpdateSketchPoint_(l)}this.geometryFunction_(a,t,n),"Polygon"===t.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if("Polygon"===s){a=this.sketchCoords_[0],a.splice(-2,1);const l=this.sketchLine_.getGeometry();if(a.length>=2){const c=a[a.length-2].slice();a[a.length-1]=c,this.createOrUpdateSketchPoint_(c)}l.setCoordinates(a),this.geometryFunction_(this.sketchCoords_,t,n)}if(1===a.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return;let t=this.sketchCoords_;const n=e.getGeometry(),s=this.getMap().getView().getProjection();"LineString"===this.mode_?(t.pop(),this.geometryFunction_(t,n,s)):"Polygon"===this.mode_&&(t[0].pop(),this.geometryFunction_(t,n,s),t=n.getCoordinates()),"MultiPoint"===this.type_?e.setGeometry(new _e([t])):"MultiLineString"===this.type_?e.setGeometry(new ye([t])):"MultiPolygon"===this.type_&&e.setGeometry(new xe([t])),this.dispatchEvent(new Le("drawend",e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Le("drawabort",e))}appendCoordinates(e){const t=this.mode_,n=!this.sketchFeature_;let s;if(n&&this.startDrawing_(e[0]),"LineString"===t||"Circle"===t)s=this.sketchCoords_;else{if("Polygon"!==t)return;s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}n&&s.shift(),s.pop();for(let a=0;a<e.length;a++)this.addToDrawing_(e[a]);const r=e[e.length-1];this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const n=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=n.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new G.Z(new N.Z(s)),this.updateSketchFeatures_(),this.dispatchEvent(new Le("drawstart",this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}};var ki=p(154);function Ie(o){return"string"==typeof o?o:""}const Gi=class Zi extends ot{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(Ie(e),this.adaptOptions(t))}readFeatureFromText(e,t){return(0,T.O3)()}readFeatures(e,t){return this.readFeaturesFromText(Ie(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return(0,T.O3)()}readGeometry(e,t){return this.readGeometryFromText(Ie(e),this.adaptOptions(t))}readGeometryFromText(e,t){return(0,T.O3)()}readProjection(e){return this.readProjectionFromText(Ie(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return(0,T.O3)()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return(0,T.O3)()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return(0,T.O3)()}},Ai={POINT:N.Z,LINESTRING:D.Z,POLYGON:A.ZP,MULTIPOINT:_e,MULTILINESTRING:ye,MULTIPOLYGON:xe},Di={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class Ni{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=void 0!==t&&t,e>="0"&&e<="9"||"."==e&&!t}isWhiteSpace_(e){return" "==e||"\t"==e||"\r"==e||"\n"==e}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),t=this.index_;let s,n=e;if("("==e)s=2;else if(","==e)s=5;else if(")"==e)s=3;else if(this.isNumeric_(e)||"-"==e)s=4,n=this.readNumber_();else if(this.isAlpha_(e))s=1,n=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);s=6}return{position:t,value:n,type:s}}readNumber_(){let e;const t=this.index_;let n=!1,s=!1;do{"."==e?n=!0:("e"==e||"E"==e)&&(s=!0),e=this.nextChar_()}while(this.isNumeric_(e,n)||!s&&("e"==e||"E"==e)||s&&("-"==e||"+"==e));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let e;const t=this.index_;do{e=this.nextChar_()}while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}class ji{constructor(e){this.lexer_=e,this.token_={position:0,type:0},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(1)){const n=t.value;"Z"===n?e="XYZ":"M"===n?e="XYM":"ZM"===n&&(e="XYZM"),"XY"!==e&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(2)){const e=[];do{e.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(2)){const e=this.parsePoint_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(2)){const e=this.parsePointList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(2)){const e=this.parseLineStringTextList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(2)){let e;if(e=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(2)){const e=this.parseLineStringTextList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(2)){const e=this.parsePolygonTextList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let n=0;n<t;++n){const s=this.token_;if(!this.match(4))break;e.push(s.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(5);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(5);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(5);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(5);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(1)&&"EMPTY"==this.token_.value;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(1)){const t=e.value;this.layout_=this.parseGeometryLayout_();const n=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==t){if(n)return new $([]);const s=this.parseGeometryCollectionText_();return new $(s)}{const s=Ai[t];if(!s)throw new Error("Invalid geometry type: "+t);let r;if(n)r="POINT"==t?[NaN,NaN]:[];else switch(t){case"POINT":r=this.parsePointText_();break;case"LINESTRING":r=this.parseLineStringText_();break;case"POLYGON":r=this.parsePolygonText_();break;case"MULTIPOINT":r=this.parseMultiPointText_();break;case"MULTILINESTRING":r=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":r=this.parseMultiPolygonText_()}return new s(r,this.layout_)}}throw new Error(this.formatErrorMessage_())}}function Pt(o){const e=o.getCoordinates();return 0===e.length?"":e.join(" ")}function ze(o){const e=o.getCoordinates(),t=[];for(let n=0,s=e.length;n<s;++n)t.push(e[n].join(" "));return t.join(",")}function Ft(o){const e=[],t=o.getLinearRings();for(let n=0,s=t.length;n<s;++n)e.push("("+ze(t[n])+")");return e.join(",")}const qi={Point:Pt,LineString:ze,Polygon:Ft,MultiPoint:function Ji(o){const e=[],t=o.getPoints();for(let n=0,s=t.length;n<s;++n)e.push("("+Pt(t[n])+")");return e.join(",")},MultiLineString:function Bi(o){const e=[],t=o.getLineStrings();for(let n=0,s=t.length;n<s;++n)e.push("("+ze(t[n])+")");return e.join(",")},MultiPolygon:function Vi(o){const e=[],t=o.getPolygons();for(let n=0,s=t.length;n<s;++n)e.push("("+Ft(t[n])+")");return e.join(",")},GeometryCollection:function Ui(o){const e=[],t=o.getGeometries();for(let n=0,s=t.length;n<s;++n)e.push(Lt(t[n]));return e.join(",")}};function Lt(o){const e=o.getType(),n=(0,qi[e])(o);let s=Di[e];if("function"==typeof o.getFlatCoordinates){const r=function Qi(o){const e=o.getLayout();let t="";return("XYZ"===e||"XYZM"===e)&&(t+="Z"),("XYM"===e||"XYZM"===e)&&(t+="M"),t}(o);r.length>0&&(s+=" "+r)}return 0===n.length?s+" EMPTY":s+"("+n+")"}const St=class Ri extends Gi{constructor(e){super(),this.splitCollection_=void 0!==(e=e||{}).splitCollection&&e.splitCollection}parse_(e){const t=new Ni(e);return new ji(t).parse()}readFeatureFromText(e,t){const n=this.readGeometryFromText(e,t),s=new G.Z;return s.setGeometry(n),s}readFeaturesFromText(e,t){let n=[];const s=this.readGeometryFromText(e,t);n=this.splitCollection_&&"GeometryCollection"==s.getType()?s.getGeometriesArray():[s];const r=[];for(let a=0,l=n.length;a<l;++a){const c=new G.Z;c.setGeometry(n[a]),r.push(c)}return r}readGeometryFromText(e,t){return ue(this.parse_(e),!1,t)}writeFeatureText(e,t){const n=e.getGeometry();return n?this.writeGeometryText(n,t):""}writeFeaturesText(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);const n=[];for(let r=0,a=e.length;r<a;++r)n.push(e[r].getGeometry());const s=new $(n);return this.writeGeometryText(s,t)}writeGeometryText(e,t){return Lt(ue(e,!0,t))}};var Hi=p(3324),ke=p(5044),Yi=p(7392),Ze=p(6785);class $e{constructor(e,t,n,s,r=null){this.counter=0,this.holePolygonDrawingStatus=!1,this.allFeatures=[],this.fillColor="#ffcc33",this.strokeColor="black",this.strokeWidth=2,this.deleted=!1,this.locked=!1,this.featuresSelected=[],this.featuresDeselected=[],this.zoomPadding=[100,100,100,100],this.maxZoom=14,this.map=e,this.layerName=t,this.geomType=n,this.groupId=r,this.id=ht(),this.zIndexValue=s,this.setLayer(),this.initSelect(),this.initTranslate(),this.initSnap(),this.initModifier(),this.map.addLayer(this.vectorLayer)}setLayer(){this.sourceFeatures=new ie.Z,this.vectorLayer=new He.Z({source:this.sourceFeatures,style:(e,t)=>Mt(e)}),this.vectorLayer.set("name",this.layerName,!0),this.vectorLayer.set("geomType",this.geomType,!0),this.vectorLayer.setZIndex(this.zIndexValue)}removeLayer(){this.map.removeLayer(this.vectorLayer),this.deleted=!0}initSelect(){this.select=new Hi.Z({condition:Z.V4,multi:!1,layers:[this.vectorLayer]})}initSnap(){this.snap=new yi({source:this.sourceFeatures})}initTranslate(){this.translate=new Ci({features:this.select.getFeatures()})}enableTranslating(){this.map.addInteraction(this.translate)}disableTranslating(){this.map.removeInteraction(this.translate)}enableSelecting(){this.map.addInteraction(this.select)}disableSelecting(){this.map.removeInteraction(this.select)}initModifier(){this.modifier=new vi({features:this.select.getFeatures()}),this.modifier.on("modifyend",e=>{e.mapBrowserEvent.originalEvent.ctrlKey&&this.removeHoles(e),e.features.getArray().length>0&&e.features.getArray().forEach(t=>{this.updateFeature(t)})})}enableDrawing(e=!1){this.holePolygonDrawingStatus=e,this.draw=new Ii({type:this.geomType,stopClick:!1,source:this.vectorLayer.getSource()}),this.map.addInteraction(this.draw),this.map.addInteraction(this.snap),this.draw.on("drawstart",this.onDrawStart.bind(this)),this.draw.on("drawend",this.onDrawEnd.bind(this)),this.draw.on("drawabort",this.onDrawAborting.bind(this))}disableDrawing(){this.map.removeInteraction(this.draw),this.map.removeInteraction(this.snap)}enableEditing(){this.disableEditing(),this.map.addInteraction(this.modifier),this.map.addInteraction(this.snap)}disableEditing(){this.map.removeInteraction(this.modifier),this.map.removeInteraction(this.snap)}cleanEvents(){this.disableDrawing(),this.disableEditing(),this.disableSelecting()}onDrawAborting(e){this.holePolygonDrawingStatus&&void 0!==this.polygonIntersected&&(this.polygonIntersected.setGeometry(this.previousPolygonGeometry),this.polygonIntersected=void 0)}onDrawStart(e){if(this.holePolygonDrawingStatus&&"Polygon"===e.feature.getGeometry()?.getType()){let t=this.checkIfCoordIntersectLayer(e.feature);if(this.polygonIntersected=t,void 0===this.polygonIntersected)return e.target.abortDrawing(),this.onDrawAborting(e),void alert("An hole is possible only on a polygon!");if(void 0!==this.polygonIntersected){this.previousPolygonGeometry=this.polygonIntersected.getGeometry();const n=this.polygonIntersected.getGeometry();this.coordsLength=n.getCoordinates().length,e.feature.getGeometry().on("change",this.onGeomChangeBuildHole.bind(this))}}}checkIfCoordIntersectLayer(e){let t;return this.vectorLayer.getSource().forEachFeatureIntersectingExtent(e.getGeometry().getExtent(),n=>{t=n}),t}onDrawEnd(e){if(this.holePolygonDrawingStatus)return setTimeout(()=>{this.sourceFeatures.removeFeature(e.feature)},5),void 0!==this.polygonIntersected&&(e.feature.setGeometry(this.polygonIntersected.getGeometry()),this.select.getFeatures().clear()),void(this.polygonIntersected=void 0);this.addProperties(e.feature)}addProperties(e){++this.counter;const t=ht();let n;return e.setId(t),n=void 0!==e.get("name")?e.get("name")+" copy":"feature "+this.counter,e.setProperties({id:e.getId(),layer_id:this.id,no:this.counter,name:n,geom_type:e.getGeometry()?.getType(),status:"added",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},!0),void 0===e.get("fill_color")&&e.set("fill_color",this.fillColor,!0),void 0===e.get("stroke_width")&&e.set("stroke_width",this.strokeWidth,!0),void 0===e.get("stroke_color")&&e.set("stroke_color",this.strokeColor,!0),e}addFeaturesAndUpdateIds(e){e.length>0&&e.forEach(t=>{let n=t.clone(),s=this.addProperties(n);this.sourceFeatures.addFeature(s)})}onGeomChangeBuildHole(e){if(void 0!==this.polygonIntersected){let n=this.polygonIntersected.getGeometry().getCoordinates(),s=new A.ZP(n.slice(0,this.coordsLength)),r=new ki.Z(e.target.getCoordinates()[0]);s.appendLinearRing(r),this.polygonIntersected.setGeometry(s)}}removeFeature(e){const t=this.sourceFeatures.getFeatureById(e);null!==t&&this.sourceFeatures.removeFeature(t)}duplicateFeature(e){const t=this.sourceFeatures.getFeatureById(e);if(null!==t){const n=this.addProperties(t.clone());this.sourceFeatures.addFeature(n)}}getFeatureAttribute(e,t){const n=this.sourceFeatures.getFeatureById(e);if(null!==n)return n.get(t)}features(){return this.deleted?[]:this.sourceFeatures.getFeatures().sort((t,n)=>t.get("no")-n.get("no"))}removeHoles(e){const t=e.features.getArray()[0],n=e.mapBrowserEvent.coordinate;if("Polygon"==t.getGeometry().getType()){const s=t.getGeometry().getLinearRings();if(s.length>1){let r=new ie.Z;s.forEach((c,d)=>{const h=new D.Z(c.getCoordinates());let g=new G.Z({geometry:h});g.setId(d),r.addFeature(g)});const a=r.getClosestFeatureToCoordinate(n);let l=[];s.forEach((c,d)=>{d!==a.getId()&&l.push(c.getCoordinates())}),t.getGeometry().setCoordinates(l)}}}updateFeature(e){e.setProperties({updated_at:(new Date).toISOString(),status:"modified"},!0)}getOpacity(){return this.vectorLayer.getOpacity()}setOpacity(e){this.vectorLayer.setOpacity(e.target.valueAsNumber)}setName(e){this.layerName=e.target.value,this.vectorLayer.set("name",this.layerName,!0)}setStyleForAllFeatures(e,t){let n;"stroke_width"===t?n=e.target.value:(n=e,"fill_color"===t?this.fillColor=e:"stroke_color"===t&&(this.strokeColor=e)),this.features().forEach(s=>{s.set(t,n,!1)})}exportToGeoJSON(){let e=new dt;return JSON.stringify(JSON.parse(e.writeFeatures(this.features())),null,2)}exportToWkt(){let e=[];return this.features().forEach(t=>{e.push(et(t.getGeometry()))}),e.join("\n")}exportToPytestFixture(){let t=[];return void 0!==this.features()&&this.features().forEach(n=>{t.push("\n@pytest.fixture\ndef "+n.get("name").replace(" ","_")+"():\n\treturn '"+et(n.getGeometry())+"'")}),"import pytest\n"+t.join("\n")}zoomToLayer(){this.sourceFeatures.getFeatures().length>0&&this.map.getView().fit(this.sourceFeatures.getExtent(),{size:this.map.getSize(),maxZoom:this.maxZoom,padding:this.zoomPadding})}zoomToFeature(e){this.features().filter(t=>{t.getId()===e&&this.map.getView().fit(t.getGeometry(),{size:this.map.getSize(),maxZoom:this.maxZoom})})}}function Et(o,e,t){let n=[];const s=o.findIndex(l=>l.id===e),r=o[s].zIndexValue,a=r+t;return a>=0&&a<o.length?(o.splice(a,0,o.splice(r,1)[0]),o.forEach((l,c)=>{l.zIndexValue=c,l.vectorLayer.setZIndex(c),n.push(l)}),n):o}function et(o){return(new St).writeGeometry(o)}function Mt(o){let e,t=o.getGeometry();if(void 0!==t){const n=o.get("fill_color"),s=o.get("stroke_width"),r=o.get("stroke_color");return"Point"===t.getType()?e=function zi(o,e,t){return new U.ZP({image:new Yi.Z({radius:7,fill:new ke.Z({color:o}),stroke:new Ze.Z({color:t,width:e})})})}(n,s,r):"LineString"===t.getType()?e=function $i(o,e,t){return[new U.ZP({fill:new ke.Z({color:o}),stroke:new Ze.Z({color:t,width:2*e})}),new U.ZP({fill:new ke.Z({color:o}),stroke:new Ze.Z({color:o,width:e})})]}(n,s,r):"Polygon"===t.getType()&&(e=function en(o,e,t){return new U.ZP({fill:new ke.Z({color:o}),stroke:new Ze.Z({color:t,width:e})})}(n,s,r)),e}return new U.ZP}var tt=p(3396),se=p(4945);function sn(o,e){if(1&o&&(i.O4$(),i.TgZ(0,"svg",13),i._UZ(1,"circle",14),i.qZA()),2&o){const t=i.oxw();i.xp6(1),i.uIk("stroke",t.feature.get("stroke_color"))("stroke-width",t.feature.get("stroke_width"))("fill",t.feature.get("fill_color"))}}function rn(o,e){if(1&o&&(i.O4$(),i.TgZ(0,"svg",13),i._UZ(1,"line",15)(2,"line",15),i.qZA()),2&o){const t=i.oxw();i.xp6(1),i.uIk("stroke",t.feature.get("stroke_color"))("stroke-width",2*t.feature.get("stroke_width")),i.xp6(1),i.uIk("stroke",t.feature.get("fill_color"))("stroke-width",1.5*t.feature.get("stroke_width"))}}function on(o,e){if(1&o&&(i.O4$(),i.TgZ(0,"svg",16),i._UZ(1,"rect",17),i.qZA()),2&o){const t=i.oxw();i.xp6(1),i.uIk("stroke",t.feature.get("stroke_color"))("stroke-width",t.feature.get("stroke_width"))("fill",t.feature.get("fill_color"))}}function an(o,e){if(1&o){const t=i.EpF();i.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"strong"),i._uU(4),i.qZA(),i.TgZ(5,"em",21),i._uU(6),i.qZA(),i.TgZ(7,"em",6),i._uU(8),i.qZA(),i.TgZ(9,"button",22),i.NdJ("click",function(){i.CHM(t);const s=i.oxw();return i.KtG(s.showPopup())}),i.qZA()(),i.TgZ(10,"div",23)(11,"div",24)(12,"span",25),i._uU(13,"Actions :"),i.qZA(),i.TgZ(14,"span",26),i.NdJ("click",function(){i.CHM(t);const s=i.oxw();return i.KtG(s.copyToClipboard(s.getWktFromFeature(s.feature)))}),i._uU(15," WKT "),i.qZA()(),i.TgZ(16,"div",27)(17,"span"),i._uU(18),i.ALo(19,"date"),i.qZA(),i.TgZ(20,"span"),i._uU(21),i.ALo(22,"date"),i.qZA()(),i.TgZ(23,"div",28)(24,"h6",5),i._uU(25,"Style"),i.qZA(),i.TgZ(26,"div",29)(27,"span",30),i._uU(28,"Couleur de fond :"),i.qZA(),i.TgZ(29,"input",31,32),i.NdJ("change",function(){i.CHM(t);const s=i.MAs(30),r=i.oxw();return i.KtG(r.updateFillColor(s.value))}),i.qZA(),i._UZ(31,"label"),i.qZA(),i.TgZ(32,"div",29)(33,"span",30),i._uU(34,"Couleur du contour :"),i.qZA(),i.TgZ(35,"input",33,34),i.NdJ("change",function(){i.CHM(t);const s=i.MAs(36),r=i.oxw();return i.KtG(r.updateStrokeColor(s.value))}),i.qZA(),i._UZ(37,"label"),i.qZA(),i.TgZ(38,"div",29)(39,"span",30),i._uU(40,"Epaisseur du contour :"),i.qZA(),i.TgZ(41,"input",35),i.NdJ("change",function(s){i.CHM(t);const r=i.oxw();return i.KtG(r.updateStrokeWidth(s))}),i.qZA()()(),i.TgZ(42,"span",5),i._uU(43),i.qZA()()()()}if(2&o){const t=i.oxw();i.Q6J("id","featurePopup"+t.feature.getId()),i.xp6(4),i.Oqu(t.feature.get("name")),i.xp6(2),i.hij("(",t.feature.get("geom_type"),")"),i.xp6(2),i.hij("Couche: ",t.currentLayer.layerName,""),i.xp6(10),i.hij("Cr\xe9\xe9 \xe0 ",i.xi3(19,14,t.feature.get("created_at"),"HH:mm:ss"),""),i.xp6(3),i.hij("Modifi\xe9 \xe0 ",i.xi3(22,17,t.feature.get("updated_at"),"HH:mm:ss"),""),i.xp6(8),i.Q6J("id","fillColor-"+t.feature.getId())("value",t.feature.get("fill_color")),i.xp6(2),i.uIk("for","fillColor-"+t.feature.getId()),i.xp6(4),i.Q6J("id","strokeColor-"+t.feature.getId())("value",t.feature.get("stroke_color")),i.xp6(2),i.uIk("for","strokeColor-"+t.feature.getId()),i.xp6(4),i.Q6J("value",t.currentStrokeWidth),i.xp6(2),i.Oqu(t.getWktFromFeature(t.feature))}}class re{constructor(e){this.elementRef=e,this.disabledIcon=_.g82,this.duplicateIcon=tt.WM4,this.centerIcon=_.TL5,this.paramIcon=_.gr5,this.displayPopup=!1}ngOnInit(){this.currentFillColor=this.feature.get("fill_color"),this.currentStrokeColor=this.feature.get("stroke_color"),this.currentStrokeWidth=this.feature.get("stroke_width")}ngOnDestroy(){this.elementRef.nativeElement.remove()}ngOnChanges(e){e.currentFeatureIdSelected&&e.currentFeatureIdSelected.currentValue!==this.feature.getId()&&(this.displayPopup=!1)}removeFeature(){this.currentLayer.removeFeature(this.feature.getId())}duplicateFeature(){this.currentLayer.select.getFeatures().clear(),this.currentLayer.duplicateFeature(this.feature.getId())}showPopup(){this.displayPopup=!this.displayPopup}copyToClipboard(e){const t=document.createElement("textarea");t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.opacity="0",t.value=e,document.body.appendChild(t),t.focus(),t.select(),document.execCommand("copy"),document.body.removeChild(t)}updateFillColor(e){this.feature.set("fill_color",e,!1)}updateStrokeWidth(e){this.feature.set("stroke_width",e.target.value,!0)}updateStrokeColor(e){this.feature.set("stroke_color",e,!0)}zoomToFeature(){this.currentLayer.zoomToFeature(this.feature.getId())}getWktFromFeature(e){return et(e.getGeometry())}}function ln(o,e){if(1&o&&i._UZ(0,"fa-icon",53),2&o){const t=i.oxw();i.Q6J("icon",t.pointIcon)}}function cn(o,e){if(1&o&&i._UZ(0,"fa-icon",53),2&o){const t=i.oxw();i.Q6J("icon",t.lineStringIcon)}}function dn(o,e){if(1&o&&i._UZ(0,"fa-icon",53),2&o){const t=i.oxw();i.Q6J("icon",t.polygonIcon)}}function hn(o,e){if(1&o){const t=i.EpF();i.ynx(0),i.TgZ(1,"app-feature",60),i.NdJ("click",function(){const r=i.CHM(t).$implicit,a=i.oxw(2);return i.KtG(a.selectFeatureById(r.getId()))}),i.qZA(),i.BQk()}if(2&o){const t=e.$implicit,n=i.oxw(2);i.xp6(1),i.Q6J("ngClass",n.featureIdSelected==t.getId()?"fw-bold bg-secondary bg-opacity-25":"")("currentFeatureIdSelected",n.featureIdSelected)("feature",t)("currentLayer",n.layer)}}function un(o,e){if(1&o){const t=i.EpF();i.TgZ(0,"div",54)(1,"ul",55)(2,"li",56),i.NdJ("click",function(){i.CHM(t);const s=i.oxw();return i.KtG(s.unSelectFeature())}),i.TgZ(3,"div",57)(4,"div",13),i._UZ(5,"fa-icon",58),i.qZA(),i.TgZ(6,"div",13),i._uU(7," D\xe9sel\xe9ctionner "),i.qZA()()(),i.YNc(8,hn,2,4,"ng-container",59),i.qZA()()}if(2&o){const t=i.oxw();i.xp6(1),i.Q6J("id","featuresLayer-"+t.layer.id),i.xp6(1),i.Q6J("ngClass","none"==t.featureIdSelected&&t.isSelected?"fw-bold bg-secondary bg-opacity-25":""),i.xp6(3),i.Q6J("icon",t.disabledIcon),i.xp6(3),i.Q6J("ngForOf",t.layer.features())}}re.\u0275fac=function(e){return new(e||re)(i.Y36(i.SBq))},re.\u0275cmp=i.Xpm({type:re,selectors:[["app-feature"]],inputs:{feature:"feature",currentFeatureIdSelected:"currentFeatureIdSelected",currentLayer:"currentLayer"},features:[i.TTD],decls:18,vars:9,consts:[[1,"feature","py-0","d-flex","justify-content-between","align-items-center","pointer"],[1,"d-flex","flex-row","pointer","justify-content-start","align-items-center","flex-fill"],[1,"m-1"],["height","25","width","25",4,"ngIf"],["height","15","width","25",4,"ngIf"],[1,""],[1,"ms-auto"],["ngbPopover","Center sur l'object","triggers","mouseenter:mouseleave",1,"ms-auto","btn","p-1","bg-transparent","border-0",3,"click"],["size","xs",1,"",3,"icon"],["ngbPopover","Dupliquer l'object","triggers","mouseenter:mouseleave",1,"ms-auto","btn","p-1","bg-transparent","border-0",3,"click"],["ngbPopover","Supprimer l'object","triggers","mouseenter:mouseleave",1,"btn","m-0","bg-transparent","border-0","text-danger",3,"click"],["ngbPopover","Options de l'objet","triggers","mouseenter:mouseleave",1,"p-1","bg-transparent","border-0","text-black",3,"click"],["class","featureToasts position-fixed bottom-0 end-0 p-3 d-flex flex-row overflow-auto fw-normal pointer-none","style","z-index: 11",3,"id",4,"ngIf"],["height","25","width","25"],["cx","12","cy","12","r","8"],["x1","0","y1","10","x2","25","y2","10"],["height","15","width","25"],["x","0","y","0","width","25","height","15"],[1,"featureToasts","position-fixed","bottom-0","end-0","p-3","d-flex","flex-row","overflow-auto","fw-normal","pointer-none",2,"z-index","11",3,"id"],["role","alert","aria-live","assertive","aria-atomic","true",1,"toast","toastFeature","faded"],[1,"toast-header","justify-content-between"],[1,"ms-2","me-auto","me-auto"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"toast-body","bg-white"],["id","toastActions",1,"d-flex","flex-row","justify-content-start","align-items-center"],[1,"fw-bold"],["data-bs-toggle","tooltip","data-bs-placement","bottom","title","Copier le WKT",1,"badge","bg-dark","rounded","m-1","small","pointer",3,"click"],[1,"d-flex","flex-row","justify-content-between"],[1,"d-flex","flex-column","my-3"],[1,"d-flex","flex-row","ms-2","my-1"],[1,"me-2"],["type","color",1,"fillColor","m-1","pointer",3,"id","value","change"],["fillColor",""],["type","color",1,"strokeColor","m-1","pointer",3,"id","value","change"],["strokeColor",""],["type","number","min","0","max","12",1,"small","strokeWidth",3,"value","change"]],template:function(e,t){1&e&&(i.TgZ(0,"li",0)(1,"div",1)(2,"div",2),i.YNc(3,sn,2,3,"svg",3),i.YNc(4,rn,3,4,"svg",3),i.YNc(5,on,2,3,"svg",4),i.qZA(),i.TgZ(6,"div",5),i._uU(7),i.qZA(),i.TgZ(8,"div",6)(9,"button",7),i.NdJ("click",function(){return t.zoomToFeature()}),i._UZ(10,"fa-icon",8),i.qZA(),i.TgZ(11,"button",9),i.NdJ("click",function(){return t.duplicateFeature()}),i._UZ(12,"fa-icon",8),i.qZA(),i.TgZ(13,"button",10),i.NdJ("click",function(){return t.removeFeature()}),i._UZ(14,"fa-icon",8),i.qZA(),i.TgZ(15,"button",11),i.NdJ("click",function(){return t.showPopup()}),i._UZ(16,"fa-icon",8),i.qZA()()()(),i.YNc(17,an,44,20,"div",12)),2&e&&(i.xp6(3),i.Q6J("ngIf","Point"===t.feature.get("geom_type")),i.xp6(1),i.Q6J("ngIf","LineString"===t.feature.get("geom_type")),i.xp6(1),i.Q6J("ngIf","Polygon"===t.feature.get("geom_type")),i.xp6(2),i.hij(" ",t.feature.get("name")," "),i.xp6(3),i.Q6J("icon",t.centerIcon),i.xp6(2),i.Q6J("icon",t.duplicateIcon),i.xp6(2),i.Q6J("icon",t.disabledIcon),i.xp6(2),i.Q6J("icon",t.paramIcon),i.xp6(1),i.Q6J("ngIf",(t.currentLayer.id===t.feature.get("layer_id")||t.currentFeatureIdSelected===t.feature.getId())&&t.displayPopup))},dependencies:[S.O5,B.BN,se.o8,S.uU],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}.pointer-none[_ngcontent-%COMP%]{cursor:auto}.feature[_ngcontent-%COMP%]:hover{font-weight:700}.toast[_ngcontent-%COMP%]{opacity:0;display:unset!important;transition:opacity .5s}.faded[_ngcontent-%COMP%]{opacity:1!important;transition:opacity .5s!important}"]});class oe{constructor(e,t){this.elementRef=e,this.interactionsService=t,this.layerIdCurrentlySelected=new i.vpe,this.layerMoveUp=new i.vpe,this.layerMoveDown=new i.vpe,this.layerCloned=new i.vpe,this.removeLayerId=new i.vpe,this.groupIcon=_.Krp,this.helpIcon=_.FDd,this.addIcon=_.EQ8,this.editIcon=_.TzT,this.paramIcon=_.gr5,this.disabledIcon=_.g82,this.EditIcon=_.diR,this.pointIcon=_.diR,this.lineStringIcon=_.fQK,this.polygonIcon=_.ubJ,this.visibleIcon=_.Mdf,this.invisibleIcon=_.Aq,this.upIcon=_.l1h,this.downIcon=_.eW2,this.duplicateIcon=tt.WM4,this.centerIcon=_.TL5,this.lockIcon=_.byT,this.unLockIcon=_._1N,this.isVisible=!0,this.isDrawn=!1,this.isEdited=!1,this.isShown=!1,this.isHole=!1,this.isLocked=!1,this.displayLayerModal=!1,this.exportData="",this.exportDataMode="geojson",this.removeLayerSubscription=this.interactionsService.removeLayers.subscribe(n=>{this.removeLayer()}),this.selectableLayerStatusSubscription=this.interactionsService.selectableLayerId.subscribe(n=>{this.layer.id!==n?this.layer.disableSelecting():(this.layer.disableSelecting(),this.layer.enableSelecting())}),this.selectableAllLayersStatusSubscription=this.interactionsService.selectableAllLayers.subscribe(n=>{this.layer.disableSelecting(),this.layer.enableSelecting()})}ngOnInit(){this.layer.enableSelecting(),this.layer.select.on("select",e=>{let n=e.selected;e.deselected.length>0&&0===n.length&&this.unSelectFeature(),n.length>0&&n.forEach(s=>{this.selectFeatureById(s.getId())})}),this.layer.sourceFeatures.on("changefeature",e=>{Mt(e.feature)})}ngOnDestroy(){let e=document.getElementById("modalLayer-"+this.layer.id);null!==e&&e.remove();let t=document.getElementById("modalWktLayer-"+this.layer.id);null!==t&&t.remove(),this.removeLayerSubscription.unsubscribe(),this.selectableLayerStatusSubscription.unsubscribe(),this.selectableAllLayersStatusSubscription.unsubscribe(),this.layer.disableSelecting(),this.elementRef.nativeElement.remove()}ngOnChanges(e){e.isSelected&&(e.isSelected.currentValue||this.unSelectFeature()),e.isLocked&&this.layer.locked!==e.isLocked.currentValue&&this.lockingLayer(e.isLocked.currentValue),e.isVisible&&this.visibleHandler(e.isVisible.currentValue)}visibleHandler(e){this.isVisible=e,this.layer.vectorLayer.setVisible(e)}lockingLayer(e){this.isLocked=e,this.layer.locked=this.isLocked,this.isSelected&&this.interactionsService.activateEditBar(!this.layer.locked)}removeLayer(){this.layer.removeLayer(),this.removeLayerId.emit(this.layer.id),this.ngOnDestroy()}layerGoUp(){this.layerMoveUp.emit(this.layer.id)}layerGoDown(){this.layerMoveDown.emit(this.layer.id)}selectLayer(){this.interactionsService.sendSelectedLayerId(this.layer.id),this.interactionsService.sendSelectedLayer(this.layer)}zoomToLayer(){this.layer.zoomToLayer()}duplicateLayer(){this.unSelectFeature();const e=Object.create(this.layer);this.layerCloned.emit(e)}hideModalLayer(){this.displayLayerModal=!1}moveModalToBody(){this.displayLayerModal=!0,this.exportBuilder(this.exportDataMode);let e=document.getElementById("modalLayer-"+this.layer.id);if(null!==e){let t=document.body;null!==t&&t.appendChild(e)}}exportBuilder(e){this.exportDataMode=e,"wkt"===e?this.exportData=this.layer.exportToWkt():"geojson"===e?this.exportData=this.layer.exportToGeoJSON():"pytestFixture"===e&&(this.exportData=this.layer.exportToPytestFixture())}unSelectFeature(){this.featureIdSelected="none",this.layer.select.getFeatures().clear()}selectFeatureById(e){this.featureIdSelected=e;let t=this.getFeature(this.featureIdSelected);this.layer.select.getFeatures().clear(),this.layer.select.getFeatures().push(t),this.selectLayer()}getFeature(e){let t=this.layer.features().filter(n=>n.getId()===e);return 1===t.length?t[0]:null}}oe.\u0275fac=function(e){return new(e||oe)(i.Y36(i.SBq),i.Y36(O))},oe.\u0275cmp=i.Xpm({type:oe,selectors:[["app-layer"]],inputs:{layer:"layer",isSelected:"isSelected",layersVisibleStatus:"layersVisibleStatus",isVisible:"isVisible",isLocked:"isLocked"},outputs:{layerIdCurrentlySelected:"layerIdCurrentlySelected",layerMoveUp:"layerMoveUp",layerMoveDown:"layerMoveDown",layerCloned:"layerCloned",removeLayerId:"removeLayerId"},features:[i.TTD],decls:102,vars:53,consts:[[1,"layer","pointer","d-flex","flex-column","small","mt-1","mx-1","px-1","align-items-around"],[1,"d-flex","flex-row","border","rounded",3,"ngClass"],[1,"d-flex","flex-row","justify-content-start","align-items-center","me-1"],["type","checkbox",1,"btn-check",3,"id","checked","click"],["btnVisible",""],["container","body","triggers","mouseenter:mouseleave",1,"p-1","bg-transparent","border-0","pointer",3,"for","ngClass","ngbPopover"],["size","xs",1,"",3,"icon"],["btnLocked",""],["container","body","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","bg-transparent","border-0","pointer",3,"for","ngbPopover"],[1,"d-flex","flex-column",3,"ngClass"],["container","body","ngbPopover","Remonter","triggers","mouseenter:mouseleave",1,"p-0","bg-transparent","border-0","text-danger",3,"click"],["container","body","ngbPopover","Descendre","triggers","mouseenter:mouseleave",1,"p-0","bg-transparent","border-0","text-danger",3,"click"],[1,"d-flex","flex-row","pointer","justify-content-start","align-items-center","flex-fill","p-1",3,"ngClass","click"],[1,""],["class","me-2","size","xs",3,"icon",4,"ngIf"],[1,"layer-name"],[1,"ms-auto","d-flex","flex-row",3,"ngClass"],["ngbPopover","Dupliquer","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","bg-transparent","border-0",3,"click"],["ngbPopover","Supprimer","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","bg-transparent","border-0","text-danger",3,"ngClass","click"],[1,"ms-auto","d-flex","flex-row"],["ngbPopover","Centrer","triggers","mouseenter:mouseleave",1,"ms-auto","p-1","bg-transparent","border-0",3,"click"],["data-bs-toggle","modal","ngbPopover","Options de la couche","triggers","mouseenter:mouseleave",1,"p-1","bg-transparent","border-0","text-black",3,"click"],["class","d-flex flex-row small mb-1",4,"ngIf"],["data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade",3,"id"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","staticBackdropLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"d-flex","flex-column","my-3",3,"ngClass"],[1,"d-flex","flex-row","ms-2"],[1,"me-2"],["type","text","aria-label","layerName",1,"form-control",3,"placeholder","change"],[1,"d-flex","flex-row","ms-2","my-1"],["id","","type","range","min","0","max","1","step","0.1",1,"small","opacity-setter",3,"value","change"],["type","color",1,"fillColor","m-1","pointer",3,"id","value","change"],["layerFillColor",""],["layerStrokeColor",""],["type","number","min","0","max","12",1,"small","strokeWidth",3,"value","change"],[1,"d-flex","flex-column","my-3"],["role","tablist",1,"nav","nav-pills","align-items-center","justify-content-center"],["role","presentation",1,"nav-item","border","m-1"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold","active",3,"click"],["data-bs-toggle","tab","type","button","role","tab",1,"nav-link","fw-bold",3,"click"],["id","'tabContent' + layer.id",1,"d-flex","flex-row","mx-2","tab-content"],["role","tabpanel",1,"tab-pane","fade","w-100","show",3,"ngClass","id"],["aria-label","With textarea","readonly","",1,"form-control","vh-100",3,"click"],["exportGeoJsonStringGeomDiv",""],["exportWktStringGeomDiv",""],["exportPytestFixturesGeomDiv",""],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["size","xs",1,"me-2",3,"icon"],[1,"d-flex","flex-row","small","mb-1"],["id","featuresList",1,"w-100","list-group","list-group-flush","mx-3","border","rounded",3,"id"],[1,"feature","py-0","d-flex","justify-content-between","align-items-center","pointer",3,"ngClass","click"],[1,"d-flex","flex-row","pointer","justify-content-start","align-items-center","flex-fill","m-1"],[1,"me-1",3,"icon"],[4,"ngFor","ngForOf"],[3,"ngClass","currentFeatureIdSelected","feature","currentLayer","click"]],template:function(e,t){if(1&e){const n=i.EpF();i.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"input",3,4),i.NdJ("click",function(){i.CHM(n);const r=i.MAs(4);return i.KtG(t.visibleHandler(r.checked))}),i.qZA(),i.TgZ(5,"label",5),i._UZ(6,"fa-icon",6),i.qZA(),i.TgZ(7,"input",3,7),i.NdJ("click",function(){i.CHM(n);const r=i.MAs(8);return i.KtG(t.lockingLayer(r.checked))}),i.qZA(),i.TgZ(9,"label",8),i._UZ(10,"fa-icon",6),i.qZA(),i.TgZ(11,"div",9)(12,"button",10),i.NdJ("click",function(){return t.layerGoUp()}),i._UZ(13,"fa-icon",6),i.qZA(),i.TgZ(14,"button",11),i.NdJ("click",function(){return t.layerGoDown()}),i._UZ(15,"fa-icon",6),i.qZA()()(),i.TgZ(16,"div",12),i.NdJ("click",function(){return t.selectLayer()}),i.TgZ(17,"div",13),i.YNc(18,ln,1,1,"fa-icon",14),i.YNc(19,cn,1,1,"fa-icon",14),i.YNc(20,dn,1,1,"fa-icon",14),i.qZA(),i.TgZ(21,"div",15)(22,"span"),i._uU(23),i.qZA()()(),i.TgZ(24,"div",16)(25,"button",17),i.NdJ("click",function(){return t.duplicateLayer()}),i._UZ(26,"fa-icon",6),i.qZA(),i.TgZ(27,"button",18),i.NdJ("click",function(){return t.removeLayer()}),i._UZ(28,"fa-icon",6),i.qZA()(),i.TgZ(29,"div",19)(30,"button",20),i.NdJ("click",function(){return t.zoomToLayer()}),i._UZ(31,"fa-icon",6),i.qZA(),i.TgZ(32,"button",21),i.NdJ("click",function(){return t.moveModalToBody()}),i._UZ(33,"fa-icon",6),i.qZA()()(),i.YNc(34,un,9,4,"div",22),i.qZA(),i.TgZ(35,"div",23)(36,"div",24)(37,"div",25)(38,"div",26)(39,"h5",27),i._uU(40),i.qZA(),i.TgZ(41,"button",28),i.NdJ("click",function(){return t.hideModalLayer()}),i.qZA()(),i.TgZ(42,"div",29)(43,"div",30)(44,"h4",13),i._uU(45,"G\xe9n\xe9ral"),i.qZA(),i.TgZ(46,"div",31)(47,"span",32),i._uU(48,"Nom de la couche :"),i.qZA(),i.TgZ(49,"input",33),i.NdJ("change",function(r){return t.layer.setName(r)}),i.qZA()()(),i.TgZ(50,"div",30)(51,"h4",13),i._uU(52,"Style"),i.qZA(),i.TgZ(53,"div",34)(54,"span",32),i._uU(55,"Opacit\xe9 :"),i.qZA(),i.TgZ(56,"input",35),i.NdJ("change",function(r){return t.layer.setOpacity(r)}),i.qZA()(),i.TgZ(57,"div",34)(58,"span",32),i._uU(59,"Couleur de fond :"),i.qZA(),i.TgZ(60,"input",36,37),i.NdJ("change",function(){i.CHM(n);const r=i.MAs(61);return i.KtG(t.layer.setStyleForAllFeatures(r.value,"fill_color"))}),i.qZA(),i._UZ(62,"label"),i.qZA(),i.TgZ(63,"div",34)(64,"span",32),i._uU(65,"Couleur du contour :"),i.qZA(),i.TgZ(66,"input",36,38),i.NdJ("change",function(){i.CHM(n);const r=i.MAs(67);return i.KtG(t.layer.setStyleForAllFeatures(r.value,"stroke_color"))}),i.qZA(),i._UZ(68,"label"),i.qZA(),i.TgZ(69,"div",34)(70,"span",32),i._uU(71,"Epaisseur du contour :"),i.qZA(),i.TgZ(72,"input",39),i.NdJ("change",function(r){return t.layer.setStyleForAllFeatures(r,"stroke_width")}),i.qZA()()(),i.TgZ(73,"div",40)(74,"h4",13),i._uU(75,"Export"),i.qZA(),i.TgZ(76,"ul",41)(77,"li",42)(78,"a",43),i.NdJ("click",function(){return t.exportBuilder("geojson")}),i._uU(79," GeoJSON "),i.qZA()(),i.TgZ(80,"li",42)(81,"a",44),i.NdJ("click",function(){return t.exportBuilder("wkt")}),i._uU(82," WKT "),i.qZA()(),i.TgZ(83,"li",42)(84,"a",44),i.NdJ("click",function(){return t.exportBuilder("pytestFixture")}),i._uU(85," Pytest Fixtures "),i.qZA()()(),i.TgZ(86,"div",45)(87,"div",46)(88,"textarea",47,48),i.NdJ("click",function(){i.CHM(n);const r=i.MAs(89);return i.KtG(r.select())}),i._uU(90),i.qZA()(),i.TgZ(91,"div",46)(92,"textarea",47,49),i.NdJ("click",function(){i.CHM(n);const r=i.MAs(93);return i.KtG(r.select())}),i._uU(94),i.qZA()(),i.TgZ(95,"div",46)(96,"textarea",47,50),i.NdJ("click",function(){i.CHM(n);const r=i.MAs(97);return i.KtG(r.select())}),i._uU(98),i.qZA()()()()(),i.TgZ(99,"div",51)(100,"button",52),i._uU(101,"Fermer"),i.qZA()()()()()}if(2&e){const n=i.MAs(4),s=i.MAs(8),r=i.MAs(67);i.xp6(1),i.Q6J("ngClass",t.isSelected?"border-dark border-2":""),i.xp6(2),i.Q6J("id","btnVisible"+t.layer.id)("checked",t.isVisible),i.xp6(2),i.Q6J("for","btnVisible"+t.layer.id)("ngClass",n.checked?"text-success":"text-danger")("ngbPopover",n.checked?"Masquer":"Afficher"),i.xp6(1),i.Q6J("icon",n.checked?t.visibleIcon:t.invisibleIcon),i.xp6(1),i.Q6J("id","btnLocked"+t.layer.id)("checked",t.isLocked),i.xp6(2),i.Q6J("for","btnLocked"+t.layer.id)("ngbPopover",s.checked?"D\xe9verrouiler":"Verrouiller"),i.xp6(1),i.Q6J("icon",s.checked?t.lockIcon:t.unLockIcon),i.xp6(1),i.Q6J("ngClass",t.isSelected?"pe-auto":"pe-none"),i.xp6(2),i.Q6J("icon",t.upIcon),i.xp6(2),i.Q6J("icon",t.downIcon),i.xp6(1),i.Q6J("ngClass",t.isSelected?"fw-bold":"text-black"),i.xp6(2),i.Q6J("ngIf","Point"===t.layer.geomType),i.xp6(1),i.Q6J("ngIf","LineString"===t.layer.geomType),i.xp6(1),i.Q6J("ngIf","Polygon"===t.layer.geomType),i.xp6(3),i.Oqu(t.layer.layerName),i.xp6(1),i.Q6J("ngClass",t.isSelected?"d-block":"d-none"),i.xp6(2),i.Q6J("icon",t.duplicateIcon),i.xp6(1),i.Q6J("ngClass",t.layer.locked?"pe-none":"pe-auto"),i.xp6(1),i.Q6J("icon",t.disabledIcon),i.xp6(3),i.Q6J("icon",t.centerIcon),i.xp6(1),i.uIk("data-bs-target","#modalLayer-"+t.layer.id),i.xp6(1),i.Q6J("icon",t.paramIcon),i.xp6(1),i.Q6J("ngIf",t.layer.features().length>0),i.xp6(1),i.Q6J("id","modalLayer-"+t.layer.id),i.xp6(5),i.Oqu(t.layer.layerName),i.xp6(3),i.Q6J("ngClass",t.layer.locked?"pe-none":"pe-auto"),i.xp6(6),i.Q6J("placeholder",t.layer.layerName),i.xp6(1),i.Q6J("ngClass",t.layer.locked?"pe-none":"pe-auto"),i.xp6(6),i.Q6J("value",t.layer.getOpacity()),i.xp6(4),i.Q6J("id","fillColor-"+t.layer.id)("value",t.layer.fillColor),i.xp6(2),i.uIk("for","fillColor-"+t.layer.id),i.xp6(4),i.Q6J("id","strokeColor-"+t.layer.id)("value",r.value),i.xp6(2),i.uIk("for","strokeColor-"+t.layer.id),i.xp6(4),i.Q6J("value",t.layer.strokeWidth),i.xp6(6),i.uIk("data-bs-target","#GeoJsonTab"+t.layer.id),i.xp6(3),i.uIk("data-bs-target","#wktTab"+t.layer.id),i.xp6(3),i.uIk("data-bs-target","#pytestFixture"+t.layer.id),i.xp6(3),i.Q6J("ngClass","geojson"===t.exportDataMode?"active":"")("id","GeoJsonTab"+t.layer.id),i.xp6(3),i.Oqu(t.exportData),i.xp6(1),i.Q6J("ngClass","wkt"===t.exportDataMode?"active":"")("id","wktTab"+t.layer.id),i.xp6(3),i.Oqu(t.exportData),i.xp6(1),i.Q6J("ngClass","pytestFixture"===t.exportDataMode?"active":"")("id","pytestFixture"+t.layer.id),i.xp6(3),i.Oqu(t.exportData)}},dependencies:[S.mk,S.sg,S.O5,B.BN,se.o8,re],styles:[".layer[_ngcontent-%COMP%]:hover   .layer-name[_ngcontent-%COMP%], .feature[_ngcontent-%COMP%]:hover{font-weight:700}.toast[_ngcontent-%COMP%]{opacity:0;display:unset!important;transition:opacity .5s}.faded[_ngcontent-%COMP%]{opacity:1!important;transition:opacity .5s!important}.pointer[_ngcontent-%COMP%]{cursor:pointer}.colorPicker[_ngcontent-%COMP%]{width:10px;height:25px;cursor:pointer}"]});const gn=["exportStringGeomDiv"],fn=["layersListDiv"];function pn(o,e){if(1&o){const t=i.EpF();i.ynx(0),i.TgZ(1,"button",34),i.NdJ("click",function(){const r=i.CHM(t).$implicit,a=i.oxw();return i.KtG(a.addLayer(r.mode))}),i._UZ(2,"fa-icon",35),i.qZA(),i.BQk()}if(2&o){const t=e.$implicit;i.xp6(1),i.Q6J("ngbPopover",t.label),i.xp6(1),i.Q6J("icon",t.icon)}}function mn(o,e){if(1&o){const t=i.EpF();i.ynx(0),i.TgZ(1,"button",36),i.NdJ("click",function(){const r=i.CHM(t).$implicit,a=i.oxw();return i.KtG(a.setImportDataType(r.label_text))}),i._UZ(2,"fa-icon",37),i._uU(3),i.qZA(),i.BQk()}if(2&o){const t=e.$implicit;i.xp6(1),i.Q6J("ngbPopover",t.label),i.xp6(1),i.Q6J("icon",t.icon),i.xp6(1),i.hij("",t.label_text," ")}}function yn(o,e){if(1&o){const t=i.EpF();i.ynx(0),i.TgZ(1,"app-layer",38),i.NdJ("layerMoveUp",function(s){i.CHM(t);const r=i.oxw();return i.KtG(r.layerGoUp(s))})("layerMoveDown",function(s){i.CHM(t);const r=i.oxw();return i.KtG(r.layerGoDown(s))})("layerCloned",function(s){i.CHM(t);const r=i.oxw();return i.KtG(r.duplicateLayer(s))})("removeLayerId",function(s){i.CHM(t);const r=i.oxw();return i.KtG(r.removeLayer(s))}),i.qZA(),i.BQk()}if(2&o){const t=e.$implicit,n=i.oxw();i.xp6(1),i.Q6J("layer",t)("isSelected",n.currentLayerIdSelected==t.id)("isVisible",n.forceVisibleStatus)("isLocked",n.layersLockStatus)}}function _n(o,e){if(1&o&&(i.TgZ(0,"option",39),i._uU(1),i.qZA()),2&o){const t=e.$implicit;i.Q6J("value",t),i.xp6(1),i.Oqu(t)}}function Cn(o,e){if(1&o&&(i.TgZ(0,"option",39),i._uU(1),i.qZA()),2&o){const t=e.$implicit;i.Q6J("value",t.id),i.xp6(1),i.hij("Importer dans la couche : ",t.layerName,"")}}class ae{constructor(e,t){this.mapService=e,this.interactionsService=t,this.disabledIcon=_.g82,this.pointIcon=_.diR,this.lineStringIcon=_.fQK,this.polygonIcon=_.ubJ,this.loadIcon=_.cf$,this.visibleIcon=tt.Mdf,this.invisibleIcon=_.Aq,this.centerIcon=_.TL5,this.lockIcon=_.byT,this.unLockIcon=_._1N,this.forceVisibleStatus=!0,this.layersLockStatus=!1,this.existingLayers=[],this.allLayers=[],this.layerNamedIncrement=-1,this.createModesSupported=[{mode:"Point",label:"Ajouter une couche de Points",icon:this.pointIcon},{mode:"LineString",label:"Ajouter une couche de LineString",icon:this.lineStringIcon},{mode:"Polygon",label:"Ajouter une couche de Polygones",icon:this.polygonIcon}],this.createFromModesSupported=[{mode:"GeoJSON",label:"Importer un GeoJSON",label_text:"GeoJSON",icon:this.loadIcon},{mode:"WKT",label:"Importer un/des WKT(s)",label_text:"WKT(s)",icon:this.loadIcon}],this.strInputDataValues=null,this.strInputEpsgInput=null,this.modeImportInput="new",this.zoomPadding=[100,100,100,100],this.epsgChangesSubscription=this.mapService.setMapProjectionFromEpsg.subscribe(n=>{this.existingLayers.forEach(s=>{s.features().forEach(r=>{r.setGeometry(r.getGeometry().transform(this.currentEpsg,n))})}),this.currentEpsg=n}),this.layerIdSelectedSubscription=this.interactionsService.layerIdSelected.subscribe(n=>{this.currentLayerIdSelected=n})}ngOnInit(){this.moveImportDataModalToBody()}ngOnDestroy(){this.existingLayers.forEach(e=>{this.map.removeLayer(e.vectorLayer),e.cleanEvents()}),this.epsgChangesSubscription.unsubscribe(),this.layerIdSelectedSubscription.unsubscribe()}ngOnChanges(e){e.layersListDiv&&this.refreshLayers()}addLayer(e,t=null){const n=++this.layerNamedIncrement;let s=new $e(this.map,"layer "+n,e,n,t);this.existingLayers.push(s),this.refreshLayers()}duplicateLayer(e){let n=new $e(this.map,e.layerName+" copy",e.geomType,this.existingLayers.length,null);n.addFeaturesAndUpdateIds(e.features()),this.existingLayers.push(n),this.refreshLayers()}addLayerFromFeatures(e,t){const n=++this.layerNamedIncrement;let s=new $e(this.map,"layer "+n,e,n,null);s.addFeaturesAndUpdateIds(t),this.existingLayers.push(s),this.refreshLayers()}layerGoUp(e){this.existingLayers=Et(this.existingLayers,e,1),this.refreshLayers()}layerGoDown(e){this.existingLayers=Et(this.existingLayers,e,-1),this.refreshLayers()}removeLayer(e){this.existingLayers=this.existingLayers.filter(t=>t.id!==e),this.buildLayersIndexes()}getLayerFromId(e){return this.existingLayers.filter(n=>n.id===e)[0]}refreshLayers(){this.allLayers=this.existingLayers.filter(e=>!e.deleted).sort((e,t)=>e.zIndexValue>t.zIndexValue?-1:1)}unSelectLayer(){this.interactionsService.sendSelectedLayerId("none"),this.interactionsService.sendSelectedLayer(null)}buildLayersIndexes(){let e=this.existingLayers;this.existingLayers=[],e.forEach((t,n)=>{t.zIndexValue=n,t.vectorLayer.setZIndex(n),this.existingLayers.push(t)})}moveImportDataModalToBody(){let e=document.getElementById("modalDataImport");if(null!==e){let t=document.body;null!==t&&t.appendChild(e)}}setImportDataType(e){this.importDataType=e}importFromFormat(){let t,e={};if(this.strInputEpsgInput!==this.currentEpsg&&(e={dataProjection:this.strInputEpsgInput,featureProjection:this.currentEpsg}),null!==this.strInputDataValues)if("GeoJSON"===this.importDataType?t=function xn(o,e){let t={};return t=function bn(o){return o.reduce((e,t)=>{let n=t.getGeometry().getType();return e[n]||(e[n]=[]),e[n].push(t),e},{})}(new ie.Z({features:(new dt).readFeatures(JSON.parse(o,e))}).getFeatures()),t}(this.strInputDataValues,e):"WKT(s)"===this.importDataType&&(t=function Tn(o,e){let t={};return o.forEach(n=>{let s;try{s=(new St).readFeature(n,e)}catch(r){alert(r.message)}if(void 0!==s){const r=s.getGeometry(),a=r.getType();a in t||(t[a]=[]),void 0!==r&&t[a].push(s)}}),t}(this.strInputDataValues.split("\n"),e)),"new"===this.modeImportInput)Object.keys(t).forEach(n=>{let s=t[n];"Point"===n&&this.addLayerFromFeatures(n,s),"LineString"===n&&this.addLayerFromFeatures(n,s),"Polygon"===n&&this.addLayerFromFeatures(n,s)});else{let n=this.getLayerFromId(this.modeImportInput);Object.keys(t).forEach(s=>{s===n.geomType&&(n.addFeaturesAndUpdateIds(t[s]),this.refreshLayers())})}this.strInputDataValues=null,this.strInputEpsgInput=null,this.modeImportInput="new"}zoomLayers(){let e=(0,x.lJ)();this.existingLayers.forEach(t=>{(0,x.l7)(e,t.sourceFeatures.getExtent())}),e[0]!==1/0&&e[1]!==1/0&&e[2]!==1/0&&e[3]!==1/0&&this.map.getView().fit(e,{size:this.map.getSize(),padding:this.zoomPadding})}visibleLayers(e){this.forceVisibleStatus=e}lockLayers(e){this.layersLockStatus=e}removeLayers(){this.interactionsService.removeAllLayers()}}function vn(o,e){if(1&o){const t=i.EpF();i.ynx(0),i.TgZ(1,"input",9,16),i.NdJ("click",function(){i.CHM(t);const s=i.MAs(2),r=i.oxw(2);return i.KtG(r.drawHoleHandler(s.checked,!0))}),i.qZA(),i.TgZ(3,"label",17),i._UZ(4,"fa-icon",12),i.qZA(),i.BQk()}if(2&o){const t=i.oxw(2);i.xp6(1),i.Q6J("id","btnHole"+t.layer.id)("checked",t.isHole),i.xp6(2),i.Q6J("for","btnHole"+t.layer.id)("ngClass",t.isHole?"text-danger":"text-success"),i.xp6(1),i.Q6J("icon",t.polygonIcon)}}function wn(o,e){if(1&o){const t=i.EpF();i.ynx(0),i.TgZ(1,"input",9,18),i.NdJ("click",function(){i.CHM(t);const s=i.MAs(2),r=i.oxw(2);return i.KtG(r.translateHandler(s.checked))}),i.qZA(),i.TgZ(3,"label",19),i._UZ(4,"fa-icon",12),i.qZA(),i.BQk()}if(2&o){const t=i.oxw(2);i.xp6(1),i.Q6J("id","btnMove"+t.layer.id)("checked",t.isMoved),i.xp6(2),i.Q6J("for","btnMove"+t.layer.id)("ngClass",t.isMoved?"text-danger":"text-success"),i.xp6(1),i.Q6J("icon",t.moveIcon)}}function Pn(o,e){if(1&o){const t=i.EpF();i.TgZ(0,"div",5)(1,"div",6)(2,"span",7),i._uU(3,"Ajouter"),i.qZA(),i.TgZ(4,"div",8)(5,"input",9,10),i.NdJ("click",function(){i.CHM(t);const s=i.MAs(6),r=i.oxw();return i.KtG(r.drawHandler(s.checked))}),i.qZA(),i.TgZ(7,"label",11),i._UZ(8,"fa-icon",12),i.qZA()()(),i.TgZ(9,"div",6)(10,"span",7),i._uU(11,"Editer"),i.qZA(),i.TgZ(12,"div",8)(13,"input",9,13),i.NdJ("click",function(){i.CHM(t);const s=i.MAs(14),r=i.oxw();return i.KtG(r.editHandler(s.checked))}),i.qZA(),i.TgZ(15,"label",14),i._UZ(16,"fa-icon",12),i.qZA(),i.YNc(17,vn,5,5,"ng-container",15),i.YNc(18,wn,5,5,"ng-container",15),i.qZA()()()}if(2&o){const t=i.oxw();i.xp6(5),i.Q6J("id","btnDraw"+t.layer.id)("checked",t.isDrawn),i.xp6(2),i.Q6J("for","btnDraw"+t.layer.id)("ngClass",t.isDrawn?"text-danger":"text-success")("ngbPopover","Ajouter un objet de type '"+t.layer.geomType+"'"),i.xp6(1),i.Q6J("icon",t.addIcon),i.xp6(5),i.Q6J("id","btnEdit"+t.layer.id)("checked",t.isEdited),i.xp6(2),i.Q6J("for","btnEdit"+t.layer.id)("ngClass",t.isEdited?"text-danger":"text-success"),i.xp6(1),i.Q6J("icon",t.editIcon),i.xp6(1),i.Q6J("ngIf","Polygon"===t.layer.geomType),i.xp6(1),i.Q6J("ngIf","Point"!==t.layer.geomType)}}ae.\u0275fac=function(e){return new(e||ae)(i.Y36(Ae.S),i.Y36(O))},ae.\u0275cmp=i.Xpm({type:ae,selectors:[["app-layer-manager"]],viewQuery:function(e,t){if(1&e&&(i.Gf(gn,5),i.Gf(fn,5)),2&e){let n;i.iGM(n=i.CRH())&&(t.exportStringGeomDiv=n.first),i.iGM(n=i.CRH())&&(t.layersListDiv=n.first)}},inputs:{map:"map",currentEpsg:"currentEpsg",epsgAvailable:"epsgAvailable"},features:[i.TTD],decls:58,vars:21,consts:[[1,"d-flex","flex-row","align-items-center","justify-content-center","bg-dark","bg-gradient","text-white","py-2","px-3"],[1,"fw-bold"],["id","creationTools",1,"d-flex","flex-column"],[1,"d-flex","flex-row","justify-content-center","my-2","mx-3"],[4,"ngFor","ngForOf"],["id","layersTools",1,"d-flex","flex-row","justify-content-evenly","align-items-center","mx-2"],["type","checkbox","id","btnVisibleLayers",1,"btn-check",3,"checked","click"],["btnVisible",""],["for","btnVisibleLayers","container","body","triggers","mouseenter:mouseleave",1,"p-1","bg-transparent","border-0","pointer",3,"ngClass","ngbPopover"],["size","1x",1,"",3,"icon"],["ngbPopover","Centrer","triggers","mouseenter:mouseleave",1,"p-1","bg-transparent","border-0",3,"click"],["type","checkbox","id","btnLockLayers",1,"btn-check",3,"checked","change"],["btnLock",""],["for","btnLockLayers","container","body","triggers","mouseenter:mouseleave",1,"p-1","bg-transparent","border-0","pointer",3,"ngbPopover"],["ngbPopover","Supprimer toutes les couches","triggers","mouseenter:mouseleave",1,"p-1","bg-transparent","border-0","text-danger",3,"click"],["id","layersContainer",1,"d-flex","flex-column","mx-2","overflow-auto"],["id","layersList",1,"d-flex","flex-column","justify-content-start","mb-2"],["layersListDi",""],[1,"layer","pointer","d-flex","flex-column","small","mt-1","mx-1","px-1","align-items-around",3,"ngClass","click"],[1,"pointer","p-2","d-flex","flex-row","pointer","justify-content-start","align-items-center","border","rounded"],[1,"me-1",3,"icon"],["id","modalDataImport","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-lg","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"modal-body"],[1,"form-control",3,"ngModel","ngModelChange"],[1,"form-select","form-select-sm",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["value","new"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"ngClass","click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["placement","bottom","triggers","mouseenter:mouseleave",1,"badge","bg-dark","border-0","me-1","text-warning",3,"ngbPopover","click"],[1,"",3,"icon"],["data-bs-toggle","modal","data-bs-target","#modalDataImport","type","button","role","tab","placement","bottom","triggers","mouseenter:mouseleave",1,"badge","bg-dark","border-0","me-1","text-warning",3,"ngbPopover","click"],[1,"mx-1",3,"icon"],[3,"layer","isSelected","isVisible","isLocked","layerMoveUp","layerMoveDown","layerCloned","removeLayerId"],[3,"value"]],template:function(e,t){if(1&e){const n=i.EpF();i.TgZ(0,"div",0)(1,"span",1),i._uU(2,"Cr\xe9er des couches"),i.qZA()(),i.TgZ(3,"div",2)(4,"div",3),i.YNc(5,pn,3,2,"ng-container",4),i.qZA()(),i.TgZ(6,"div",0)(7,"span",1),i._uU(8,"Importer des donn\xe9es"),i.qZA()(),i.TgZ(9,"div",2)(10,"div",3),i.YNc(11,mn,4,3,"ng-container",4),i.qZA()(),i.TgZ(12,"div",0)(13,"span",1),i._uU(14,"Couches"),i.qZA()(),i.TgZ(15,"div",5)(16,"input",6,7),i.NdJ("click",function(){i.CHM(n);const r=i.MAs(17);return i.KtG(t.visibleLayers(r.checked))}),i.qZA(),i.TgZ(18,"label",8),i._UZ(19,"fa-icon",9),i.qZA(),i.TgZ(20,"button",10),i.NdJ("click",function(){return t.zoomLayers()}),i._UZ(21,"fa-icon",9),i.qZA(),i.TgZ(22,"input",11,12),i.NdJ("change",function(){i.CHM(n);const r=i.MAs(23);return i.KtG(t.lockLayers(r.checked))}),i.qZA(),i.TgZ(24,"label",13),i._UZ(25,"fa-icon",9),i.qZA(),i.TgZ(26,"button",14),i.NdJ("click",function(){return t.removeLayers()}),i._UZ(27,"fa-icon",9),i.qZA()(),i.TgZ(28,"div",15)(29,"div",16,17)(31,"div",18),i.NdJ("click",function(){return t.unSelectLayer()}),i.TgZ(32,"div",19),i._UZ(33,"fa-icon",20),i.TgZ(34,"span"),i._uU(35,"D\xe9s\xe9lectionner"),i.qZA()()(),i.YNc(36,yn,2,4,"ng-container",4),i.qZA()(),i.TgZ(37,"div",21)(38,"div",22)(39,"div",23)(40,"div",24)(41,"h5",25),i._uU(42),i.qZA()(),i.TgZ(43,"div",26)(44,"textarea",27),i.NdJ("ngModelChange",function(r){return t.strInputDataValues=r}),i.qZA(),i._uU(45," EPSG des donn\xe9es \xe0 importer "),i.TgZ(46,"select",28),i.NdJ("ngModelChange",function(r){return t.strInputEpsgInput=r}),i.YNc(47,_n,2,2,"option",29),i.qZA(),i._uU(48," Type d'importation "),i.TgZ(49,"select",28),i.NdJ("ngModelChange",function(r){return t.modeImportInput=r}),i.TgZ(50,"option",30),i._uU(51,"Cr\xe9er de nouvelles couches"),i.qZA(),i.YNc(52,Cn,2,2,"option",29),i.qZA()(),i.TgZ(53,"div",31)(54,"button",32),i.NdJ("click",function(){return t.importFromFormat()}),i._uU(55,"Ajouter"),i.qZA(),i.TgZ(56,"button",33),i._uU(57,"Fermer"),i.qZA()()()()()}if(2&e){const n=i.MAs(17),s=i.MAs(23);i.xp6(5),i.Q6J("ngForOf",t.createModesSupported),i.xp6(6),i.Q6J("ngForOf",t.createFromModesSupported),i.xp6(5),i.Q6J("checked",!0),i.xp6(2),i.Q6J("ngClass",n.checked?"text-success":"text-danger")("ngbPopover",n.checked?"Masquer":"Afficher"),i.xp6(1),i.Q6J("icon",n.checked?t.visibleIcon:t.invisibleIcon),i.xp6(2),i.Q6J("icon",t.centerIcon),i.xp6(1),i.Q6J("checked",!1),i.xp6(2),i.Q6J("ngbPopover",s.checked?"D\xe9v\xe9rouiller":"Verrouiller"),i.xp6(1),i.Q6J("icon",s.checked?t.lockIcon:t.unLockIcon),i.xp6(2),i.Q6J("icon",t.disabledIcon),i.xp6(4),i.Q6J("ngClass","none"===t.currentLayerIdSelected?"bg-secondary  bg-gradient bg-opacity-25 fw-bold text-black":"text-black"),i.xp6(2),i.Q6J("icon",t.disabledIcon),i.xp6(3),i.Q6J("ngForOf",t.allLayers),i.xp6(6),i.hij("Importer ",t.importDataType,""),i.xp6(2),i.Q6J("ngModel",t.strInputDataValues),i.xp6(2),i.Q6J("ngModel",t.strInputEpsgInput),i.xp6(1),i.Q6J("ngForOf",t.epsgAvailable),i.xp6(2),i.Q6J("ngModel",t.modeImportInput),i.xp6(3),i.Q6J("ngForOf",t.existingLayers),i.xp6(2),i.Q6J("ngClass",null!==t.strInputEpsgInput&&null!==t.strInputDataValues?"":"pe-none")}},dependencies:[S.mk,S.sg,B.BN,se.o8,j.YN,j.Kr,j.Fj,j.EJ,j.JJ,j.On,oe],styles:[".faded[_ngcontent-%COMP%]{opacity:1!important;transition:opacity .5s!important}.pointer[_ngcontent-%COMP%]{cursor:pointer}.modal-backdrop[_ngcontent-%COMP%]{z-index:1040!important}.modal-content[_ngcontent-%COMP%]{margin:2px auto;z-index:1100!important}"]});class le{constructor(e,t){this.interactionsService=e,this.cdRef=t,this.addIcon=_.EQ8,this.editIcon=_.TzT,this.paramIcon=_.gr5,this.lockIcon=_.byT,this.unLockIcon=_._1N,this.polygonIcon=_.ubJ,this.moveIcon=_.$pG,this.isDrawn=!1,this.isEdited=!1,this.isHole=!1,this.isMoved=!1,this.epsgAvailable=["EPSG:4326","EPSG:3857"],this.strInputDataValues=null,this.strInputEspgInput=null,this.layerLockStatusSubscription=this.interactionsService.editBarActivation.subscribe(n=>{n?this.isEditBarEnabled=!0:(this.isEditBarEnabled=!1,this.disableEditing()),this.cdRef.detectChanges()})}ngOnInit(){this.isEditBarEnabled=!this.layer.locked}ngOnDestroy(){this.disableEditing(),this.layerLockStatusSubscription.unsubscribe()}ngOnChanges(e){}enablingSelectOnlyOnTheCurrentLayer(){this.interactionsService.setSelectableLayer(this.layer.id)}enableSelectingOnAllLayers(){this.interactionsService.setSelectableAllLayers()}disableEditing(e=!0){this.drawHoleHandler(!1),this.drawHandler(!1),this.editHandler(!1),this.translateHandler(!1),e&&this.unSelectFeature()}unSelectFeature(){this.layer.select.getFeatures().clear()}removeFeature(){}translateHandler(e){e?(this.disableEditing(!1),this.translateFeatureEnable()):this.translateFeatureDisable()}editHandler(e){e?(this.disableEditing(!1),this.editFeatureEnable()):this.editFeatureDisable()}drawHandler(e,t=!1){e?(this.disableEditing(!1),this.enablingSelectOnlyOnTheCurrentLayer(),this.addFeatureEnable(t)):(this.addFeatureDisable(),this.enableSelectingOnAllLayers())}drawHoleHandler(e,t=!0){e?(this.disableEditing(!1),this.enablingSelectOnlyOnTheCurrentLayer(),this.addHoleFeatureEnable(t)):(this.addHoleFeatureDisable(),this.enableSelectingOnAllLayers())}translateFeatureEnable(){this.layer.enableTranslating(),this.isMoved=!0}translateFeatureDisable(){this.layer.disableTranslating(),this.isMoved=!1}addFeatureEnable(e=!1){this.layer.enableDrawing(e),this.isDrawn=!0}addFeatureDisable(){this.layer.disableDrawing(),this.isDrawn=!1}editFeatureEnable(){this.layer.enableEditing(),this.isEdited=!0}editFeatureDisable(){this.layer.disableEditing(),this.isEdited=!1}addHoleFeatureEnable(e=!0){this.layer.enableDrawing(e),this.isHole=!0}addHoleFeatureDisable(){this.layer.disableDrawing(),this.isHole=!1}}function Fn(o,e){if(1&o&&i._UZ(0,"app-edit-bar",12),2&o){const t=i.oxw();i.Q6J("layer",t.currentLayerSelected)("currentEpsg",t.currentEpsg)}}le.\u0275fac=function(e){return new(e||le)(i.Y36(O),i.Y36(i.sBO))},le.\u0275cmp=i.Xpm({type:le,selectors:[["app-edit-bar"]],inputs:{layer:"layer",currentEpsg:"currentEpsg"},features:[i.TTD],decls:7,vars:3,consts:[[1,"d-flex","flex-column","mx-4","editTools","bg-dark","bg-gradient","p-2","m-1","rounded-3","shadow"],[1,"d-flex","flex-row","justify-content-around","text-warning","m-2"],[1,"fw-bold","me-1"],[1,"fst-italic"],["class","d-flex flex-row",4,"ngIf"],[1,"d-flex","flex-row"],[1,"d-flex","flex-row","mx-2","align-items-center","shadow","border","rounded","bg-light"],[1,"text-dark","mx-2","fw-bold","small"],[1,"d-flex","flex-row","border-start","rounded-end","p-1"],["type","checkbox",1,"btn-check",3,"id","checked","click"],["btnDraw",""],["triggers","mouseenter:mouseleave",1,"edit-button","btn","px-1","py-0","border","m-1",3,"for","ngClass","ngbPopover"],["size","1x",1,"",3,"icon"],["btnEdit",""],["ngbPopover","Editer","triggers","mouseenter:mouseleave",1,"edit-button","btn","px-1","py-0","border","border","m-1",3,"for","ngClass"],[4,"ngIf"],["btnHole",""],["ngbPopover","Ajouter un trou","triggers","mouseenter:mouseleave",1,"edit-button","btn","px-1","py-0","border","m-1",3,"for","ngClass"],["btnMove",""],["ngbPopover","D\xe9placer","triggers","mouseenter:mouseleave",1,"edit-button","btn","px-1","py-0","border","m-1",3,"for","ngClass"]],template:function(e,t){1&e&&(i.TgZ(0,"div",0)(1,"div",1)(2,"span",2),i._uU(3),i.qZA(),i.TgZ(4,"span",3),i._uU(5),i.qZA()(),i.YNc(6,Pn,19,13,"div",4),i.qZA()),2&e&&(i.xp6(3),i.Oqu(t.layer.layerName),i.xp6(2),i.hij("(",t.layer.geomType,")"),i.xp6(1),i.Q6J("ngIf",t.isEditBarEnabled))},dependencies:[S.mk,S.O5,B.BN,se.o8],styles:[".edit-button[_ngcontent-%COMP%]{background-color:rgba(var(--bs-light-rgb))}"]});class ce{constructor(e,t,n,s,r){this.mapService=e,this.controlerService=t,this.activatedRoute=n,this.interactionsService=s,this.cdRef=r,this.epsgAvailable=["EPSG:4326","EPSG:3857"],this.geoIcon=_.g4A,this.leftSideIcon=_._Wx,this.rightSideIcon=_.ccb,this.layersIcon=_.Krp,this.isLegendDisplayed=!0,this.currentMenuDisplayed="createTools",this.mapSubscription=this.mapService.map.subscribe(a=>{this.map=a,this.currentEpsg=this.map.getView().getProjection().getCode(),this.defaultMapView=this.map.getView()}),this.layerObjectSelectedSubscription=this.interactionsService.layerObjectSelected.subscribe(a=>{a!==this.currentLayerSelected?(this.editBarEnabled=!1,this.cdRef.detectChanges(),this.editBarEnabled=!0):null===a&&(this.editBarEnabled=!1),this.currentLayerSelected=a})}ngOnInit(){this.sendResumeSubMenus(),this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap()}ngOnDestroy(){this.map.setView(this.defaultMapView),this.mapSubscription.unsubscribe(),this.layerObjectSelectedSubscription.unsubscribe(),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}}ce.\u0275fac=function(e){return new(e||ce)(i.Y36(Ae.S),i.Y36(kt.L),i.Y36(Ge.gz),i.Y36(O),i.Y36(i.sBO))},ce.\u0275cmp=i.Xpm({type:ce,selectors:[["app-app-layout"]],decls:14,vars:16,consts:[[1,"container-fluid","g-0"],["id","sandbox",1,"d-flex","flex-row","position-fixed"],["id","mapTools",1,"d-flex","flex-column","bg-light","shadow-map-tools","position-relative",3,"ngClass"],["id","geoTools",1,"d-flex","flex-column","overflow-auto",3,"ngClass","map","currentEpsg","epsgAvailable"],["id","createTools",1,"d-flex","flex-column","overflow-auto",3,"ngClass","map","currentEpsg","epsgAvailable"],["id","legendLabels",1,"d-flex","flex-column"],[1,"tool","btn","btn-warning","text-black","my-3","shadow","rounded-end",3,"ngClass","click"],[1,"",3,"icon"],[1,"tool","btn","btn-info","text-white","mb-1","shadow","rounded-end",3,"ngClass","click"],["type","button",1,"tool","btn","btn-dark","text-white","mb-1","shadow","rounded-end",3,"ngClass","click"],[1,"d-flex","flex-row","justify-content-center"],["id","editBar","class","d-flex flex-row align-items-center justify-content-center m-2",3,"layer","currentEpsg",4,"ngIf"],["id","editBar",1,"d-flex","flex-row","align-items-center","justify-content-center","m-2",3,"layer","currentEpsg"]],template:function(e,t){1&e&&(i.TgZ(0,"div",0)(1,"div",1)(2,"div",2),i._UZ(3,"app-geoinfo",3)(4,"app-layer-manager",4),i.qZA(),i.TgZ(5,"div",5)(6,"span",6),i.NdJ("click",function(){return t.showHideLegend()}),i._UZ(7,"fa-icon",7),i.qZA(),i.TgZ(8,"span",8),i.NdJ("click",function(){return t.currentMenuDisplayed="geoTools"}),i._UZ(9,"fa-icon",7),i.qZA(),i.TgZ(10,"span",9),i.NdJ("click",function(){return t.currentMenuDisplayed="createTools"}),i._UZ(11,"fa-icon",7),i.qZA()()()(),i.TgZ(12,"div",10),i.YNc(13,Fn,1,2,"app-edit-bar",11),i.qZA()),2&e&&(i.xp6(2),i.Q6J("ngClass",t.isLegendDisplayed?"displayed":"hidden"),i.xp6(1),i.Q6J("ngClass","geoTools"==t.currentMenuDisplayed?"d-block":"d-none")("map",t.map)("currentEpsg",t.currentEpsg)("epsgAvailable",t.epsgAvailable),i.xp6(1),i.Q6J("ngClass","createTools"==t.currentMenuDisplayed?"d-block":"d-none")("map",t.map)("currentEpsg",t.currentEpsg)("epsgAvailable",t.epsgAvailable),i.xp6(2),i.Q6J("ngClass",t.isLegendDisplayed?"selected":""),i.xp6(1),i.Q6J("icon",t.isLegendDisplayed?t.leftSideIcon:t.rightSideIcon),i.xp6(1),i.Q6J("ngClass","geoTools"===t.currentMenuDisplayed?"selected":""),i.xp6(1),i.Q6J("icon",t.geoIcon),i.xp6(1),i.Q6J("ngClass","createTools"===t.currentMenuDisplayed?"selected":""),i.xp6(1),i.Q6J("icon",t.layersIcon),i.xp6(2),i.Q6J("ngIf",t.editBarEnabled&&null!==t.currentLayerSelected))},dependencies:[S.mk,S.O5,B.BN,X,ae,le],styles:[".button-title[_ngcontent-%COMP%]{border-radius:unset;z-index:1}.button-title[_ngcontent-%COMP%]   .vertical-text[_ngcontent-%COMP%]{writing-mode:vertical-rl;text-orientation:upright;letter-spacing:-5px}.button-title[_ngcontent-%COMP%]   .horizontal-text[_ngcontent-%COMP%]{writing-mode:horizontal-tb;letter-spacing:0px}.hidden[_ngcontent-%COMP%]   .d-flex[_ngcontent-%COMP%]{visibility:hidden!important;opacity:0;transition:all .3s}#sandbox[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}#mapTools.displayed[_ngcontent-%COMP%]{opacity:1;width:18vw;transition:all .3s}#mapTools.hidden[_ngcontent-%COMP%]{width:1vw;transition:all .3s}.shadow-map-tools[_ngcontent-%COMP%]{box-shadow:1em 0 1rem #00000026!important}#mapTools[_ngcontent-%COMP%]{height:calc(100vh - 56px)}@media (max-width: 960px){#mapTools.hidden[_ngcontent-%COMP%]{width:3vw}#mapTools.displayed[_ngcontent-%COMP%]{width:75vw}}.tool.btn[_ngcontent-%COMP%]{width:45px;border-radius:unset;transition:width 1s ease-in-out}.tool.btn[_ngcontent-%COMP%]:hover, .tool.btn.selected[_ngcontent-%COMP%]{width:60px;transition:width 1s ease-in-out}#editBar[_ngcontent-%COMP%]{position:fixed;bottom:0;-webkit-user-select:none;user-select:none}"]});const Ln=[{path:"",component:ce,data:{title:"Bac \xe0 sable",page:"map-sandbox"},outlet:"map-sandbox"}];class K{}K.\u0275fac=function(e){return new(e||K)},K.\u0275mod=i.oAB({type:K}),K.\u0275inj=i.cJS({imports:[Ge.Bz.forChild(Ln),Ge.Bz]});class W{}W.\u0275fac=function(e){return new(e||W)},W.\u0275mod=i.oAB({type:W}),W.\u0275inj=i.cJS({imports:[S.ez,K,B.uH,se.IJ,j.u5]})}}]);