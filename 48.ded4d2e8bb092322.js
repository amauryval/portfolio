"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[48],{1048:(ae,W,l)=>{l.r(W),l.d(W,{MapGtfsViewerModule:()=>ie});var I=l(9808),E=l(9444),F=l(9560),Z=l(801),_=l(109),O=l(949),U=l(5044),B=l(6785);const dt=Z.uYr,pt=Z.Ybx,ht=Z.FGq,mt=Z.TL5,X=Z.tho;!function ft(){const n=new Date;n.setHours(0,0,0,0)}();const N="gtfs",K="rgb(255, 0, 0)",q="rgb(153, 76, 0)",tt="rgb(102, 178, 255)",C="white",M=1.5,vt=new _.ZP({image:new O.Z({radius:4,fill:new U.Z({color:K}),stroke:new B.Z({color:C,width:M})})}),gt=new _.ZP({image:new O.Z({radius:4,fill:new U.Z({color:q}),stroke:new B.Z({color:C,width:M})})}),yt=new _.ZP({image:new O.Z({radius:4,fill:new U.Z({color:tt}),stroke:new B.Z({color:C,width:M})})}),xt=new _.ZP({image:new O.Z({radius:4,fill:new U.Z({color:"black"}),stroke:new B.Z({color:C,width:M})})});function et(n){return"0"===n.get("route_type")?gt:"1"===n.get("route_type")?yt:"2"===n.get("route_type")?vt:xt}var n,it=l(8610),St=l(3171),bt=l(187),wt=l(4511),Tt=l(2121),b=l(521),G=l(8587),Dt=l(4569),nt=l(6597),x=l(483),R=l(9466),m=l(760),rt=l(1274),Rt=(n=function(a,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])})(a,t)},function(a,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=a}n(a,t),a.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),At=function(n){function a(t){var i=n.call(this,t)||this;return i.image_=null,i}return Rt(a,n),a.prototype.getImage=function(){return this.image_?this.image_.getImage():null},a.prototype.prepareFrame=function(t){var i=t.layerStatesArray[t.layerIndex],r=t.pixelRatio,o=t.viewState,d=o.resolution,c=this.getLayer().getSource(),s=t.viewHints,u=t.extent;if(void 0!==i.extent&&(u=(0,m.Ed)(u,(0,rt.dY)(i.extent,o.projection))),!s[G.Z.ANIMATING]&&!s[G.Z.INTERACTING]&&!(0,m.xb)(u))if(c){var p=o.projection;if(!Dt.j){var g=c.getProjection();g&&(p=g)}var f=c.getImage(u,d,r,p);f&&(this.loadImage(f)?this.image_=f:f.getState()===b.Z.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_},a.prototype.getData=function(t){var i=this.frameState;if(!i)return null;var r=this.getLayer(),o=(0,x.nn)(i.pixelToCoordinateTransform,t.slice()),d=r.getExtent();if(d&&!(0,m.b8)(d,o))return null;var c=this.image_.getExtent(),s=this.image_.getImage(),u=(0,m.dz)(c),p=Math.floor(s.width*((o[0]-c[0])/u));if(p<0||p>=s.width)return null;var g=(0,m.Cr)(c),f=Math.floor(s.height*((c[3]-o[1])/g));return f<0||f>=s.height?null:this.getImageData(s,p,f)},a.prototype.renderFrame=function(t,i){var r=this.image_,o=r.getExtent(),d=r.getResolution(),c=r.getPixelRatio(),s=t.layerStatesArray[t.layerIndex],u=t.pixelRatio,p=t.viewState,g=p.center,j=u*d/(p.resolution*c),A=t.extent,V=p.resolution,w=p.rotation,S=Math.round((0,m.dz)(A)/V*u),T=Math.round((0,m.Cr)(A)/V*u);(0,x.qC)(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/u,1/u,w,-S/2,-T/2),(0,x.nb)(this.inversePixelTransform,this.pixelTransform);var D=(0,x.BB)(this.pixelTransform);this.useContainer(i,D,this.getBackground(t));var y=this.context,L=y.canvas;L.width!=S||L.height!=T?(L.width=S,L.height=T):this.containerReused||y.clearRect(0,0,S,T);var H=!1,J=!0;if(s.extent){var Q=(0,rt.dY)(s.extent,p.projection);(H=(J=(0,m.kK)(Q,t.extent))&&!(0,m.r4)(Q,t.extent))&&this.clipUnrotated(y,t,Q)}var P=r.getImage(),Y=(0,x.qC)(this.tempTransform,S/2,T/2,j,j,0,c*(o[0]-g[0])/d,c*(g[1]-o[3])/d);this.renderedResolution=d*u/c;var lt=P.width*Y[0],ct=P.height*Y[3];if(this.getLayer().getSource().getInterpolate()||(0,R.f0)(y,nt.$),this.preRender(y,t),J&&lt>=.5&&ct>=.5){var ne=Y[4],re=Y[5],$=s.opacity,ut=void 0;1!==$&&(ut=y.globalAlpha,y.globalAlpha=$),y.drawImage(P,0,0,+P.width,+P.height,ne,re,lt,ct),1!==$&&(y.globalAlpha=ut)}return this.postRender(y,t),H&&y.restore(),(0,R.f0)(y,nt.s),D!==L.style.transform&&(L.style.transform=D),this.container},a}(Tt.Z);const Lt=At;var It=l(8707),Zt=l(9972),Ct=l(3154),Mt=function(){var n=function(a,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])})(a,t)};return function(a,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=a}n(a,t),a.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),kt=function(n){function a(t,i,r,o,d){var c=this;return(c=n.call(this,t,i,r,void 0!==d?b.Z.IDLE:b.Z.LOADED)||this).loader_=void 0!==d?d:null,c.canvas_=o,c.error_=null,c}return Mt(a,n),a.prototype.getError=function(){return this.error_},a.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=b.Z.ERROR):this.state=b.Z.LOADED,this.changed()},a.prototype.load=function(){this.state==b.Z.IDLE&&(this.state=b.Z.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},a.prototype.getImage=function(){return this.canvas_},a}(Ct.Z);const Vt=kt;var Pt=l(2402),Et=function(){var n=function(a,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])})(a,t)};return function(a,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=a}n(a,t),a.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),Ft=function(n){function a(t){var i=n.call(this,t)||this;return i.vectorRenderer_=new It.Z(t),i.layerImageRatio_=t.getImageRatio(),i.coordinateToVectorPixelTransform_=(0,x.Ue)(),i.renderedPixelToCoordinateTransform_=null,i}return Et(a,n),a.prototype.disposeInternal=function(){this.vectorRenderer_.dispose(),n.prototype.disposeInternal.call(this)},a.prototype.getFeatures=function(t){if(!this.vectorRenderer_)return new Promise(function(r){return r([])});var i=(0,x.nn)(this.coordinateToVectorPixelTransform_,(0,x.nn)(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(i)},a.prototype.handleFontsChanged=function(){this.vectorRenderer_.handleFontsChanged()},a.prototype.prepareFrame=function(t){var i=t.pixelRatio,r=t.viewState,o=r.resolution,d=t.viewHints,c=this.vectorRenderer_,s=t.extent;1!==this.layerImageRatio_&&(s=s.slice(0),(0,m.H9)(s,this.layerImageRatio_));var u=(0,m.dz)(s)/o,p=(0,m.Cr)(s)/o;if(!d[G.Z.ANIMATING]&&!d[G.Z.INTERACTING]&&!(0,m.xb)(s)){c.useContainer(null,null);var g=c.context,f=t.layerStatesArray[t.layerIndex];g.globalAlpha=f.opacity;var j=(0,R.f0)({},f,{opacity:1}),A=(0,R.f0)({},t,{declutterTree:new Pt(9),extent:s,size:[u,p],viewState:(0,R.f0)({},t.viewState,{rotation:0}),layerStatesArray:[j],layerIndex:0}),V=!0,w=new Vt(s,o,i,g.canvas,function(S){c.prepareFrame(A)&&c.replayGroupChanged&&(c.clipping=!1,c.renderFrame(A,null)&&(c.renderDeclutter(A),V=!1),S())});w.addEventListener(Zt.Z.CHANGE,function(){if(w.getState()===b.Z.LOADED){this.image_=V?null:w;var S=w.getResolution(),T=w.getPixelRatio(),D=S*i/T;this.renderedResolution=D,this.coordinateToVectorPixelTransform_=(0,x.qC)(this.coordinateToVectorPixelTransform_,u/2,p/2,1/D,-1/D,0,-r.center[0],-r.center[1])}}.bind(this)),w.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice()),!!this.image_},a.prototype.preRender=function(){},a.prototype.postRender=function(){},a.prototype.renderDeclutter=function(){},a.prototype.forEachFeatureAtCoordinate=function(t,i,r,o,d){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,i,r,o,d):n.prototype.forEachFeatureAtCoordinate.call(this,t,i,r,o,d)},a}(Lt);const _t=Ft;var Ot=function(){var n=function(a,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])})(a,t)};return function(a,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=a}n(a,t),a.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),Ut=function(n){function a(t){var i=this,r=t||{},o=(0,R.f0)({},r);return delete o.imageRatio,(i=n.call(this,o)||this).imageRatio_=void 0!==r.imageRatio?r.imageRatio:1,i}return Ot(a,n),a.prototype.getImageRatio=function(){return this.imageRatio_},a.prototype.createRenderer=function(){return new _t(this)},a}(wt.Z);const Bt=Ut;var at=l(5947),e=l(5e3),v=l(7579),Gt=l(5993),zt=l(520);let ot=(()=>{class n{constructor(t){this.http=t,this.apiUrl=Gt.n+"api/v1/gtfs_builder/",this.mapContainer=new v.x,this.screenMapBound=new v.x,this.availableAreas=new v.x,this.availableRouteTypes=new v.x,this.ErrorapiUrlDataApiFound=new v.x,this.GeoData=new v.x,this.rangeDateData=new v.x,this.GeoDataToMap=new v.x}pullGeoData(t,i,r){this.http.get(this.apiUrl+t.toLowerCase()+"/moving_nodes_by_date?current_date="+i+"&bounds="+r).subscribe({complete:()=>{},error:o=>{this.ErrorapiUrlDataApiFound.next(o.error.message)},next:o=>{this.GeoData.next(o)}})}pullRangeDateData(t){this.http.get(this.apiUrl+t.toLowerCase()+"/range_dates").subscribe({complete:()=>{},error:i=>{this.ErrorapiUrlDataApiFound.next(i.error.message)},next:i=>{this.rangeDateData.next(i)}})}pullAvailableAreas(){this.http.get(this.apiUrl+"/existing_study_areas").subscribe({complete:()=>{},error:t=>{this.ErrorapiUrlDataApiFound.next(t.error.message)},next:t=>{this.availableAreas.next(t)}})}pullAvailableRouteTypes(t){this.http.get(this.apiUrl+t.toLowerCase()+"/route_types").subscribe({complete:()=>{},error:i=>{this.ErrorapiUrlDataApiFound.next(i.error.message)},next:i=>{this.availableRouteTypes.next(i)}})}pullGeoDataToMap(t){this.GeoDataToMap.next(t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(zt.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var st=l(9947),jt=l(2313),Yt=l(3686);let z=(()=>{class n{constructor(){this.timeLineInputs=new v.x,this.dateUpdated=new v.x,this.defaultSpeedValue=new v.x,this.updatedSpeedValue=new v.x}pushTimeLineInputs(t,i,r){this.timeLineInputs.next({startDate:t,endDate:i,currentDate:r})}pushDateUpdated(t){this.dateUpdated.next(t)}pushDefaultSpeedValue(t){this.defaultSpeedValue.next(t)}pushUpdatedSpeedValue(t){this.updatedSpeedValue.next(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Nt=l(6423),h=l(9255);function Ht(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"div",14)(1,"span",15),e._uU(2,"Vitesse"),e.qZA(),e.TgZ(3,"div",16)(4,"div",15),e._uU(5,"-"),e.qZA(),e.TgZ(6,"div",17)(7,"input",18),e.NdJ("change",function(r){return e.CHM(t),e.oxw().updateStepValue(r)}),e.qZA()(),e.TgZ(8,"div",15),e._uU(9,"+"),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(7),e.Q6J("min",t.minStepValue)("max",t.maxStepValue)("step",t.minStepValue)("value",t.stepValue)}}let Jt=(()=>{class n{constructor(t,i){this.mapService=t,this.timelineService=i,this.backwardIcon=dt,this.forwardIcon=pt,this.tagIcon=X,this.timelineMarkerFontSize="35",this.sliderHandleTimeStyle=[{from:0,to:7,font_unicode:"\uf186",color:"#4575b4",stroke:"white",description:"La nuit",brightness:60},{from:7,to:11,font_unicode:"\uf185",color:"#fdae61",stroke:"black",description:"Le matin"},{from:11,to:14,font_unicode:"\uf185",color:"#d73027",stroke:"black",description:"Le milieu de journ\xe9e"},{from:14,to:19,font_unicode:"\uf185",color:"#fdae61",stroke:"black",description:"L'apr\xe8s midi"},{from:19,to:24,font_unicode:"\uf186",color:"#4575b4",stroke:"white",description:"Le soir"}],this.brightnessValuesAtEachHours=[.5,.5,.5,.5,.5,.65,.74,.83,.93,1,1,1,1,1,1,1,1,1,1,.93,.83,.72,.65,.5,.5],this.margin={top:10,right:15,bottom:0,left:15},this.width=500,this.height=90,this.selectedDatePosition=0,this.fontSize="14px",this.maxDatePosition=this.width-this.margin.left-this.margin.right,this.stepValue=4e3,this.minStepValue=50,this.timerStep=25,this.mapContainerSubscription=this.mapService.map.subscribe(r=>{this.map=r}),this.defaultSpeedValueSubscription=this.timelineService.defaultSpeedValue.subscribe(r=>{this.stepValue=r,this.maxStepValue=2*r-this.minStepValue}),this.updatedSpeedValueSubscription=this.timelineService.updatedSpeedValue.subscribe(r=>{this.stepValue=r}),this.notifyTimelineSubscription=this.timelineService.timeLineInputs.subscribe(r=>{this.startDate=r.startDate,this.endDate=r.endDate;const o=h.Z1g("%Y-%m-%d %H:%M:%S");this.currentDate=o(r.currentDate),this.buildTimeline()})}ngOnInit(){this.mapService.getMap()}ngOnDestroy(){this.mapContainerSubscription.unsubscribe(),this.notifyTimelineSubscription.unsubscribe(),this.setMapTileBrightness()}updateStepValue(t){this.stepValue=t.target.value}buildTimeline(){h.td_(".slider-bar").remove();const t=h.Ys("#"+this.timeLineId),i=h.Ys("#play-button");this.initDateRange();const r=t.append("g").attr("class","slider-bar").attr("transform",`translate(${this.margin.left},${this.height/2})`);r.append("line").attr("class","track").attr("x1",this.dateRange.range()[0]).attr("x2",this.dateRange.range()[1]).select((s,u,p)=>p[u].parentNode.appendChild(p[u].cloneNode(!0))).attr("class","track-inset").select((s,u,p)=>p[u].parentNode.appendChild(p[u].cloneNode(!0))).attr("class","track-overlay").call(h.ohM().on("drag start",s=>{i.text("Pause"),i.dispatch("click"),this.selectedDatePosition=s.x,this.update(this.dateRange.invert(this.selectedDatePosition)),h.Ys("#timeline-slider .events").selectAll("circle").style("pointer-events","none")}).on("end",s=>{h.Ys("#timeline-slider .events").selectAll("circle").style("pointer-events","all"),null!==this.startDate&&null!==this.endDate&&(this.dateRange.invert(this.selectedDatePosition).toTimeString()===this.endDate.toTimeString()||this.dateRange.invert(this.selectedDatePosition).toTimeString()===this.startDate.toTimeString()?i.text("Play"):i.text("Continue"))})),r.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,21)").selectAll("text").data(this.dateRange.ticks(10)).enter().append("text").attr("x",this.dateRange).attr("y",0).style("font-size",this.fontSize).attr("text-anchor","middle").text(s=>this.formatDateToTimeString(s)),r.insert("g",".track-overlay").attr("class","ticks-line").attr("transform","translate(0,-6)").selectAll("line").data(this.dateRange.ticks(10)).enter().append("line").attr("x1",this.dateRange).attr("x2",this.dateRange).attr("y1",0).attr("y2",12).style("stroke","grey").style("stroke-width","2px"),r.insert("g",".track-overlay").attr("class","trace-events");const d=r.insert("line",".track-overlay").attr("id","trace").attr("x1",this.dateRange(this.startDate)).attr("x2",this.dateRange(this.currentDate));this.sliderDayStyleEnabled?r.insert("text",".track-overlay").attr("id","handle-timeline").attr("class","marker-fontawesome fa-solid").attr("font-size",this.timelineMarkerFontSize):r.insert("circle",".track-overlay").attr("id","handle-timeline").attr("r",10),r.append("g").attr("class","events"),this.update(this.currentDate),this.selectedDatePosition=parseInt(d.attr("x2"))}updateHandleTimelineStyleFromTime(t){let i=t.getHours(),r=this.sliderHandleTimeStyle.filter(o=>i>=o.from&&i<o.to)[0];h.Ys("#handle-timeline").style("fill",r.color).style("stroke",r.stroke).style("stroke-width","1px").text(r.font_unicode),this.setMapTileBrightness(i)}setMapTileBrightness(t){h.td_(".ol-viewport").style("filter",void 0!==t?`brightness(${this.brightnessValuesAtEachHours[t]})`:"unset")}initDateRange(){null!==this.startDate&&null!==this.endDate&&(this.dateRange=h.Xf().domain([this.startDate,this.endDate]).range([0,this.maxDatePosition]).clamp(!0))}formatDateToTimeString(t){return parseInt(h.i$Z("%H")(t))+" h."}formatDate(t){return h.i$Z("%Y-%m-%d %H:%M:%S")(t)}update(t){null!==t&&(this.timelineService.pushDateUpdated(this.formatDate(t)),h.Ys("#trace").attr("x2",this.dateRange(t)),this.currentDate=t,this.sliderDayStyleEnabled?(h.Ys("#handle-timeline").attr("x",this.dateRange(t)),this.updateHandleTimelineStyleFromTime(t)):h.Ys("#handle-timeline").attr("cx",this.dateRange(t)))}step(){this.update(this.dateRange.invert(this.selectedDatePosition)),this.selectedDatePosition=this.selectedDatePosition+this.maxDatePosition/this.stepValue,this.selectedDatePosition>this.maxDatePosition&&this.forwardTimeLine()}startTimeLine(){const t=h.Ys("#play-button");"Pause"===t.html()?(clearInterval(this.timer),t.text("Continue")):(t.html(),this.timer=setInterval(this.step.bind(this),this.timerStep),t.html("Pause"))}resetTimeLine(){h.Ys("#play-button").html("Start"),this.currentDate=this.startDate,this.update(this.startDate),this.selectedDatePosition=0,clearInterval(this.timer)}forwardTimeLine(){h.Ys("#play-button").html("Play"),this.currentDate=this.startDate,this.update(this.endDate),this.selectedDatePosition=0,clearInterval(this.timer)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(st.S),e.Y36(z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-time-line"]],inputs:{timeLineId:"timeLineId",timeLineSpeedSliderEnabled:"timeLineSpeedSliderEnabled",sliderDayStyleEnabled:"sliderDayStyleEnabled"},decls:20,vars:9,consts:[["id","theme-legend",1,"d-flex","flex-column","flex-xxl-row","mt-auto","justify-content-center"],[1,"d-flex","flex-column","justify-content-center","align-items-center"],[3,"id"],[1,"text-center","px-5"],[1,"d-flex","flex-column","justify-content-center","align-items-center","mt-auto"],[1,"mb-2"],["id","slider-value",1,"fw-bold"],[1,"d-flex","flex-column","flex-md-row","justify-content-center","align-items-center","mt-auto"],[1,"d-flex","flex-row","align-items-center"],["id","start-button","role","button",1,"btn","btn-dark","btn-sm",3,"click"],[3,"icon"],["id","play-button","role","button",1,"btn","btn-dark","mx-2",3,"click"],["id","end-button","role","button",1,"btn","btn-dark","btn-sm",3,"click"],["class","d-flex flex-column justify-content-center m-2",4,"ngIf"],[1,"d-flex","flex-column","justify-content-center","m-2"],[1,"fw-bold"],[1,"d-flex","flex-row","align-self-center"],[1,"px-1"],["id","speed-slider","type","range",1,"form-range",3,"min","max","step","value","change"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h6"),e._uU(3,"Barre Temporelle"),e.qZA(),e.O4$(),e._UZ(4,"svg",2),e.qZA(),e.kcU(),e.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"span",6),e._uU(9),e.ALo(10,"date"),e.qZA()(),e.TgZ(11,"div",7)(12,"div",8)(13,"a",9),e.NdJ("click",function(){return i.resetTimeLine()}),e._UZ(14,"fa-icon",10),e.qZA(),e.TgZ(15,"a",11),e.NdJ("click",function(){return i.startTimeLine()}),e._uU(16,"Play"),e.qZA(),e.TgZ(17,"a",12),e.NdJ("click",function(){return i.forwardTimeLine()}),e._UZ(18,"fa-icon",10),e.qZA()(),e.YNc(19,Ht,10,4,"div",13),e.qZA()()()()),2&t&&(e.xp6(4),e.Q6J("id",i.timeLineId),e.uIk("viewBox","0 0 "+i.width+" "+i.height),e.xp6(5),e.Oqu(e.xi3(10,6,i.currentDate,"dd MMMM y HH:mm")),e.xp6(5),e.Q6J("icon",i.backwardIcon),e.xp6(4),e.Q6J("icon",i.forwardIcon),e.xp6(1),e.Q6J("ngIf",i.timeLineSpeedSliderEnabled))},directives:[E.BN,I.O5],pipes:[I.uU],styles:['.events circle{stroke-width:1px;opacity:1;stroke:#f8f8ff}.trace-events circle.trace{fill:#686868;opacity:.7;stroke:#f8f8ff;stroke-width:3px;stroke-opacity:1}.ticks{font-size:10px}.track,.track-inset,.track-overlay{stroke-linecap:round}.track{stroke:#000;stroke-opacity:.3;stroke-width:13px}.track-inset{stroke:#dcdcdc;stroke-width:11px}.track-overlay{pointer-events:stroke;stroke-width:50px;stroke:transparent;cursor:pointer}#handle-timeline{fill:#fff;stroke:#000;stroke-opacity:.5;stroke-width:1.25px}svg #trace{stroke:#6c6c6c;stroke-width:4}#play-button{width:90px}circle.preselected{stroke:#000!important;stroke-width:2px!important}#timeline-slider{width:33em}@media (max-width: 576px){#timeline-slider{width:20em}}#speed-slider{transform:rotate(180deg)}.marker-fontawesome{font-family:"Font Awesome 5 Free";text-anchor:middle;dominant-baseline:middle;pointer-events:none}\n'],encapsulation:2}),n})();function Qt(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){return e.CHM(t),e.oxw().zoomOnData()}),e._UZ(1,"fa-icon",11),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("icon",t.centerIcon)}}function $t(n,a){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"input",12),e.NdJ("click",function(){const o=e.CHM(t).$implicit;return e.oxw().updateData(o)}),e.qZA(),e.TgZ(2,"label",13)(3,"span",14),e._uU(4),e.qZA()(),e.BQk()}if(2&n){const t=a.$implicit,i=e.oxw();e.xp6(1),e.Q6J("id","btnradio-"+t)("checked",i.currentArea===t),e.xp6(1),e.Q6J("for","btnradio-"+t),e.xp6(2),e.Oqu(t.charAt(0).toUpperCase()+t.slice(1))}}function Wt(n,a){if(1&n&&(e.O4$(),e.TgZ(0,"g"),e._UZ(1,"circle"),e.TgZ(2,"text",15),e._uU(3),e.qZA()()),2&n){const t=a.$implicit,i=e.oxw();e.xp6(1),e.uIk("r",i.routeTypesLegendData.circleR)("cx",i.routeTypesLegendData.circleCxPos)("cy",t.cy)("fill",t.color)("stroke",t.strokeColor),e.xp6(1),e.uIk("x",i.routeTypesLegendData.textXPos)("y",t.cy)("font-size",i.routeTypesLegendData.fontSize),e.xp6(1),e.hij("",t.label," ")}}const Xt=[{path:"",component:(()=>{class n{constructor(t,i,r,o,d,c){this.dataService=t,this.mapService=i,this.activatedRoute=r,this.titleService=o,this.controlerService=d,this.timelineService=c,this.locationIcon=ht,this.tagIcon=X,this.centerIcon=mt,this.input_data=[{area:"lyon",default_step_value:4e3,zoom:12},{area:"ter",default_step_value:1500,zoom:6},{area:"toulouse",default_step_value:4e3,zoom:12}],this.widthLegendElement=100,this.heightLegendElement=80,this.heightMoveLegendElement=60,this.routeTypesLegendData={circleR:8,circleCxPos:20,fontSize:"12px",circleStrokeColor:C,circleStrokeWidth:M,textXPos:35,features:[{dataValue:"0",cy:22,label:"Tram",color:q},{dataValue:"1",cy:44,label:"M\xe9tro",color:tt},{dataValue:"2",cy:66,label:"Train",color:K}]},this.previousArea=null,this.currentArea=this.input_data[1].area,this.currentstepValue=this.input_data[1].default_step_value,this.currentZoomValue=this.input_data[1].zoom,this.endDate=it.cQ,this.startDate=it.cQ,this.isGeodataCanBeDisplayed=!1,this.isLegendDisplayed=!0,this.currentRouteTypes=[],this.popupWidth=100,this.popupHeight=100,this.zoomEventSubscription=this.mapService.zoomEvent.subscribe(s=>{this.mapService.zoomToExtent(this.gtfsLayer.getSource().getExtent(),this.currentZoomValue)}),this.mapSubscription=this.mapService.map.subscribe(s=>{this.map=s}),this.screenMapBoundSubscription=this.mapService.screenMapBound.subscribe(s=>{this.dataBoundingBox=s,this.dataService.pullGeoData(this.currentArea,this.currentDate,this.dataBoundingBox)}),this.pullGeoDataToMapSubscription=this.dataService.GeoDataToMap.subscribe(s=>{this.geoFeaturesData=s,this.refreshSourceLayer(this.gtfsLayer,s,et),this.previousArea!==this.currentArea&&(this.mapService.sendZoomAction(),this.previousArea=this.currentArea)}),this.pullAvailableRouteTypeSubscription=this.dataService.availableRouteTypes.subscribe(s=>{this.currentRouteTypes=s}),this.pullBoundingBoxDataSubscription=this.dataService.rangeDateData.subscribe(s=>{if(this.dataBoundingBox=s.data_bounds,this.startDate=this.parseTime(s.start_date),null!==this.startDate){this.endDate=this.parseTime(s.end_date);const u=new Date;this.currentDate=`${s.start_date.split(" ")[0]} ${u.toISOString().split("T")[1].split(".")[0]}`,this.timelineService.pushTimeLineInputs(this.startDate,this.endDate,this.currentDate)}}),this.dateUpdatedSubscription=this.timelineService.dateUpdated.subscribe(s=>{this.currentDate=s,this.dataService.pullGeoData(this.currentArea,this.currentDate,this.dataBoundingBox)}),this.pullGeoDataSubscription=this.dataService.GeoData.subscribe(s=>{this.geoData=s,null!==this.geoData&&null!==this.currentDate&&this.dataService.pullGeoDataToMap(this.geoData)}),this.pullAvailableAreasSubscription=this.dataService.availableAreas.subscribe(s=>{this.availableArea=s})}ngOnInit(){this.sendResumeSubMenus(),this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap(),this.gtfsLayer=this.buildGtfsLayer(N),this.dataService.pullAvailableAreas(),this.updateData(this.currentArea),this.innerWidth=window.screen.width,this.innerHeight=window.screen.height}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title),this.titleService.setTitle(this.activatedRoute.snapshot.data.title)}ngOnDestroy(){this.mapSubscription.unsubscribe(),this.pullGeoDataToMapSubscription.unsubscribe(),this.pullBoundingBoxDataSubscription.unsubscribe(),this.pullGeoDataSubscription.unsubscribe(),this.zoomEventSubscription.unsubscribe(),this.screenMapBoundSubscription.unsubscribe(),this.pullAvailableAreasSubscription.unsubscribe(),this.dateUpdatedSubscription.unsubscribe(),this.pullAvailableRouteTypeSubscription.unsubscribe(),this.mapService.removeLayerByName(N),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}zoomOnData(){this.mapService.sendZoomAction()}parseTime(t){return new Date(t)}updateData(t){const i=this.input_data.filter(r=>r.area===t);this.currentArea=t,this.currentstepValue=i[0].default_step_value,this.currentZoomValue=i[0].zoom,this.dataService.pullRangeDateData(this.currentArea),this.timelineService.pushDefaultSpeedValue(this.currentstepValue)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}buildGtfsLayer(t){let i=new Bt({source:new at.Z({features:[]}),style:et});return i.set("name",t),this.map.addLayer(i),i}refreshSourceLayer(t,i,r){let o=new at.Z({features:[]}),d=[];i.forEach((u,p)=>{let g=new St.Z({geometry:new bt.Z([u.x,u.y]).transform("EPSG:4326","EPSG:3857"),route_type:u.route_type,route_long_name:u.route_long_name});d.push(g)}),o.addFeatures(d);const s=this.map.getLayers().getArray().filter(u=>u.get("name")===N);1===s.length&&s[0].setSource(o)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(ot),e.Y36(st.S),e.Y36(F.gz),e.Y36(jt.Dx),e.Y36(Yt.L),e.Y36(z))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-map-view"]],decls:17,vars:5,consts:[["classes","position-fixed"],["buttonsTemplate",""],[1,"d-flex","flex-column","flex-lg-row","justify-content-evenly"],[1,"d-flex","flex-row","justify-content-around","mx-2"],[1,"mx-2"],["data-toggle","buttons",1,"btn-group-vertical","btn-group-toggle"],[4,"ngFor","ngForOf"],["id","routeTypeLegend"],[1,"my-2"],["timeLineId","timeline-slider",3,"timeLineSpeedSliderEnabled","sliderDayStyleEnabled"],["title","Centrer","type","button","checked","","autocomplete","off",1,"btn","btn-sm","btn-warning","mx-1",3,"click"],[1,"",3,"icon"],["type","radio","name","btnradio","autocomplete","off",1,"border","btn-check","m-0",3,"id","checked","click"],[1,"w-100","btn","border-warning","btn-outline-warning","p-0",3,"for"],[1,"dropdown-item","fw-bold"],[1,"label"]],template:function(t,i){1&t&&(e.TgZ(0,"set-legend-container",0),e.YNc(1,Qt,2,1,"ng-template",null,1,e.W1O),e.TgZ(3,"div",2)(4,"div",3)(5,"div",4)(6,"h6"),e._uU(7,"GTFS"),e.qZA(),e.TgZ(8,"div",5),e.YNc(9,$t,5,4,"ng-container",6),e.qZA()(),e.TgZ(10,"div",4)(11,"h6"),e._uU(12,"Modes de transport"),e.qZA(),e.O4$(),e.TgZ(13,"svg",7),e.YNc(14,Wt,4,9,"g",6),e.qZA()()(),e.kcU(),e.TgZ(15,"div",8),e._UZ(16,"app-time-line",9),e.qZA()()()),2&t&&(e.xp6(9),e.Q6J("ngForOf",i.availableArea),e.xp6(4),e.uIk("viewBox","0 0 "+i.widthLegendElement+" "+i.heightLegendElement),e.xp6(1),e.Q6J("ngForOf",i.routeTypesLegendData.features),e.xp6(2),e.Q6J("timeLineSpeedSliderEnabled",!0)("sliderDayStyleEnabled",!0))},directives:[Nt.b,E.BN,I.sg,Jt],styles:['.legend-content[_ngcontent-%COMP%]{color:"#FFFFF";background-color:#f5f5f5;box-shadow:0 -5px 20px #00000080}.legend-title[_ngcontent-%COMP%]{color:"#FFFFF";background-color:#f5f5f5}.map-popup[_ngcontent-%COMP%]{position:absolute;visibility:hidden;background-color:#f8f8ff;width:350px}svg[_ngcontent-%COMP%]{width:7em}.label[_ngcontent-%COMP%]{text-anchor:start;dominant-baseline:middle}']}),n})(),data:{title:"GTFS viewer",page:"map-gtfs-viewer"},outlet:"map-gtfs-viewer"}];let Kt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[F.Bz.forChild(Xt)],F.Bz]}),n})();var qt=l(4586);let te=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[z],imports:[[I.ez,E.uH,qt.Dt,F.Bz]]}),n})();var ee=l(7157);let ie=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[z,ot],imports:[[I.ez,Kt,E.uH,te,ee.p]]}),n})()}}]);