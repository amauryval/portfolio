"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[205],{205:(qe,z,c)=>{c.r(z),c.d(z,{MapActivitiesModule:()=>He});var x=c(6895),I=c(2216),O=c(646),q=c(4004),L=c(3171),G=c(7053),U=c(5947),k=c(187),ee=c(3324),te=c(6597),ie=c(3620),ne=c(483),se=c(8377),N=c(6003),re=c(6527),l=c(9255),h=c(5017),g=c(6177),M=c(109),S=c(7392),b=c(5044),T=c(6785);const v="activities",P="travel",A="legendActivity",J="slider-bar",D="white",le=new S.Z({radius:0,fill:new b.Z({color:g.Cm}),stroke:new T.Z({color:D,width:2})}),de=new S.Z({radius:0,fill:new b.Z({color:g.bj}),stroke:new T.Z({color:D,width:2})}),pe=new S.Z({radius:0,fill:new b.Z({color:g.C1}),stroke:new T.Z({color:D,width:2})});function $(i){let o;return o="job"===i.type?le.clone():"education"===i.type?de.clone():pe.clone(),o.setRadius(2*i.months),new M.ZP({image:o})}function j(i){return new M.ZP({image:new S.Z({radius:i,fill:new b.Z({color:"rgba(255, 215, 0, 0.6)"}),stroke:new T.Z({color:"black",width:2})})})}const Y="black",B="yellow",xe=new M.ZP({stroke:new T.Z({width:4,color:"black"})}),Te=new M.ZP({image:new S.Z({radius:2,fill:new b.Z({color:"black"}),stroke:new T.Z({color:Y,width:1})})}),Q=new M.ZP({image:new S.Z({radius:7,fill:new b.Z({color:B}),stroke:new T.Z({color:Y,width:3})})}),V=i=>"route"===i?xe:"limit"===i?Te:Q;function _(i,o,t,n){return i.getLayers().getArray().filter(p=>p.get("name")===o)[0].getSource().getFeatures().filter(p=>p.get(n)===t)[0]}var e=c(4650),W=c(9947),w=c(7579),we=c(529);let E=(()=>{class i{constructor(t){this.http=t,this.apiUrlActivitiesGeoData=h.JW+"activities_geodata",this.ErrorapiUrlActivitiesGeoDataApiFound=new w.x,this.activitiesGeoData=new w.x,this.dataToMap=new w.x,this.dateNotified=new w.x,this.timelineBuild=new w.x,this.activitiesGeoDataToMap=new w.x,this.tripsGeoDataToMap=new w.x}pullActivitiesGeoData(){this.http.get(this.apiUrlActivitiesGeoData).subscribe({complete:()=>{},error:t=>{this.ErrorapiUrlActivitiesGeoDataApiFound.next(t.error.message)},next:t=>{this.activitiesGeoData.next(t)}})}pullDataToMap(t){this.dataToMap.next(t)}pullActivitiesGeoDataToMap(t){this.activitiesGeoDataToMap.next(t)}pullTripsGeoDataToMap(t){this.tripsGeoDataToMap.next(t)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(we.eN))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Se=c(1481),be=c(3686),De=c(6423),H=c(942);function Ce(i,o){if(1&i&&(e.O4$(),e._UZ(0,"circle")),2&i){const t=o.$implicit,n=e.oxw();e.Tol(t.class),e.uIk("r",n.activityTypesLegendData.circleR)("cx",n.activityTypesLegendData.circleCxPos)("cy",t.cy)("fill",t.color)("stroke",t.strokeColor)}}function Le(i,o){if(1&i&&(e.O4$(),e.TgZ(0,"text"),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.Tol(t.class+" label"),e.uIk("x",n.activityTypesLegendData.textXPos)("y",t.cy)("font-size",n.fontSize),e.xp6(1),e.hij("",t.label," ")}}function Me(i,o){if(1&i&&(e.O4$(),e._UZ(0,"circle",7)),2&i){const t=o.$implicit,n=e.oxw();e.uIk("r",t)("cx",n.activityMonthLegendData.circleCxPos)("cy",t)}}function Ze(i,o){if(1&i&&(e.O4$(),e.TgZ(0,"text",8),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.uIk("x",n.activityMonthLegendData.textXPos)("y",2*t)("font-size",n.fontSize),e.xp6(1),e.hij("",t," mois ")}}function ke(i,o){if(1&i&&(e.O4$(),e._UZ(0,"line",9)),2&i){const t=o.$implicit;e.uIk("y1",2*t+2)("y2",2*t+2)}}function Pe(i,o){if(1&i&&(e.O4$(),e._UZ(0,"line")),2&i){const t=o.$implicit;e.Tol(t.classLine),e.uIk("x1",t.x1)("x2",t.x2)("y1",t.y1)("y2",t.y2)("strokeColor",t.strokeColor)}}function Ae(i,o){if(1&i&&(e.O4$(),e._UZ(0,"circle")),2&i){const t=o.$implicit;e.Tol(t.classMarker),e.uIk("r",t.r)("cx",t.y2/2)("cy",t.y2/2)("color",t.circleColor)("strokeColor",t.strokeColor)}}function _e(i,o){if(1&i&&(e.O4$(),e._UZ(0,"text")),2&i){const t=o.$implicit,n=e.oxw();e.uIk("x",t.y2/2)("y",t.y2/2)("font-size",n.movesLineLegendData.markerFontSize)}}function Ie(i,o){if(1&i&&(e.O4$(),e.TgZ(0,"text",8),e._uU(1),e.qZA()),2&i){const t=o.$implicit,n=e.oxw();e.uIk("x",n.movesLineLegendData.textXPos)("y",t.y2/2)("font-size",n.fontSize),e.xp6(1),e.hij("",t.label," ")}}let Oe=(()=>{class i{constructor(){this.sliderBarId=J,this.legendActivitiesId=A,this.widthLegendElement=200,this.heightLegendElement=140,this.heightMoveLegendElement=60,this.fontSize="19px",this.activityMonthLegendData={circleMonthR:[40,20,10],circleCxPos:50,textXPos:120},this.activityTypesLegendData={circleR:18,circleCxPos:20,textXPos:50,circleJobs:[{cy:25,class:"education",label:"Formations",color:g.bj,strokeColor:D},{cy:70,class:"job",label:"Entreprises",color:g.Cm,strokeColor:D},{cy:115,class:"volunteer",label:"B\xe9n\xe9volat",color:g.C1,strokeColor:D}]},this.movesLineLegendData={textXPos:50,markerFontSize:"12px",moves:[{x1:0,x2:45,y1:0,y2:45,r:12,classLine:"train-line",classMarker:"train-marker",classMarkerText:"train-marker-text",label:"Train",circleColor:B,strokeColor:Y}]}}ngOnInit(){}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-theme-legend"]],decls:22,vars:13,consts:[["id","theme-legend",1,"d-flex","flex-row","justify-content-around"],[3,"id"],[3,"class",4,"ngFor","ngForOf"],["class","activity-months",4,"ngFor","ngForOf"],["class","label",4,"ngFor","ngForOf"],["x1","50","x2","115","class","line-dot",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"activity-months"],[1,"label"],["x1","50","x2","115",1,"line-dot"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"set-section-container")(2,"h6"),e._uU(3,"Activit\xe9s"),e.qZA(),e.O4$(),e.TgZ(4,"svg",1),e.YNc(5,Ce,1,7,"circle",2),e.YNc(6,Le,2,6,"text",2),e.qZA()(),e.kcU(),e.TgZ(7,"set-section-container")(8,"h6"),e._uU(9,"Dur\xe9e"),e.qZA(),e.O4$(),e.TgZ(10,"svg"),e.YNc(11,Me,1,3,"circle",3),e.YNc(12,Ze,2,4,"text",4),e.YNc(13,ke,1,2,"line",5),e.qZA()(),e.kcU(),e.TgZ(14,"set-section-container")(15,"h6"),e._uU(16,"D\xe9placements"),e.qZA(),e.O4$(),e.TgZ(17,"svg"),e.YNc(18,Pe,1,7,"line",2),e.YNc(19,Ae,1,7,"circle",2),e.YNc(20,_e,1,3,"text",6),e.YNc(21,Ie,2,4,"text",4),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("id",n.legendActivitiesId),e.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightLegendElement),e.xp6(1),e.Q6J("ngForOf",n.activityTypesLegendData.circleJobs),e.xp6(1),e.Q6J("ngForOf",n.activityTypesLegendData.circleJobs),e.xp6(4),e.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightLegendElement),e.xp6(1),e.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),e.xp6(1),e.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),e.xp6(1),e.Q6J("ngForOf",n.activityMonthLegendData.circleMonthR),e.xp6(4),e.uIk("viewBox","0 0 "+n.widthLegendElement+" "+n.heightMoveLegendElement),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",n.movesLineLegendData.moves))},dependencies:[x.sg,H.d],styles:['.label[_ngcontent-%COMP%]{text-anchor:start;dominant-baseline:middle}svg[_ngcontent-%COMP%]{width:9em}@media (max-width: 576px){svg[_ngcontent-%COMP%]{width:6em}}.activity-months[_ngcontent-%COMP%]{fill:#fff;opacity:.7;stroke:#000;stroke-width:2px;stroke-opacity:1}.line-dot[_ngcontent-%COMP%]{stroke:#000;stroke-width:1;stroke-dasharray:5,5}.train-line[_ngcontent-%COMP%]{stroke:#000;stroke-width:3px}.train-marker[_ngcontent-%COMP%]{fill:#ff0;stroke:#000;stroke-width:3px;color:#000}.train-marker-text[_ngcontent-%COMP%]{font-family:"Font Awesome 5 Free";font-weight:900;color:#000;text-anchor:middle;dominant-baseline:middle;pointer-events:none}']}),i})();var Ne=c(6298);let Fe=(()=>{class i{constructor(t,n){this.dataService=t,this.mapService=n,this.backwardIcon=h.Gq,this.forwardIcon=h.cn,this.sliderBarId="#"+J,this.margin={top:10,right:15,bottom:0,left:15},this.width=600,this.height=70,this.fontSize="14px",this.sliderNodesSize=5,this.endDate=h.cQ,this.currentYear=h.VK,this.selectedDatePosition=0,this.maxDatePosition=this.width-this.margin.left-this.margin.right,this.currentCountNodes=0,this.mapSubscription=this.mapService.map.subscribe(s=>{this.map=s}),this.pullGeoDataSubscription=this.dataService.activitiesGeoData.subscribe(s=>{this.geoTripsData=s.trips_data,this.geoActivitiesData=s.activities_geojson;const r=new Date(s.start_date);r.setMonth(r.getMonth()-1),this.startDate=r,this.buildTimeline(String(this.currentYear))})}ngOnInit(){this.dataService.pullActivitiesGeoData()}ngOnDestroy(){this.pullGeoDataSubscription.unsubscribe(),this.mapSubscription.unsubscribe()}parseTime(t){return l.Z1g("%Y-%m-%d")(t)}formatDate(t){return l.i$Z("%b %Y")(t)}formatDateToYearString(t){return l.i$Z("%Y")(t)}formatDateToString(t){return l.i$Z("%Y-%m-%d")(t)}startTimeLine(){const t=l.Ys("#play-button");"Pause"===t.html()?(clearInterval(this.timer),t.text("Continue")):(t.html(),this.timer=setInterval(this.step.bind(this),100),t.html("Pause"))}resetTimeLine(){l.Ys("#play-button").html("Start"),this.sliderDate=this.startDate,this.update(this.startDate),this.selectedDatePosition=0,clearInterval(this.timer)}forwardTimeLine(){l.Ys("#play-button").html("Play"),this.sliderDate=this.startDate,this.update(this.endDate),this.selectedDatePosition=0,clearInterval(this.timer)}updateTrips(t){let n=[];this.geoTripsData.forEach(s=>{const d=s.end_date,a=this.parseTime(s.start_date),p=this.parseTime(d);null!==a&&null!==p&&t>=a&&t<p&&n.push(s)}),this.dataService.pullTripsGeoDataToMap(1===n.length?n:[])}update(t){this.updateTrips(t);const n=this.geoActivitiesData.features.filter(s=>{const r=this.parseTime(s.properties.start_date);return null!==r&&r>=this.startDate&&r<t});n.length!==this.currentCountNodes&&(this.dataService.pullActivitiesGeoDataToMap(n),this.displaySliderNodes(n)),this.currentCountNodes=n.length,l.Ys("#trace").attr("x2",this.dateRange(t)),l.Ys("#handle").attr("cx",this.dateRange(t)),this.sliderDate=t}step(){this.update(this.dateRange.invert(this.selectedDatePosition)),this.selectedDatePosition=this.selectedDatePosition+this.maxDatePosition/151,this.selectedDatePosition>this.maxDatePosition&&(this.selectedDatePosition=0,clearInterval(this.timer),l.Ys("#play-button").text("Play"))}_initDateRange(){this.dateRange=l.Xf().domain([this.startDate,this.endDate]).range([0,this.maxDatePosition]).clamp(!0)}buildTimeline(t){const n=l.Ys(this.sliderBarId),s=l.Ys("#play-button");this._initDateRange();const r=n.append("g").attr("class","slider-bar").attr("transform","translate("+this.margin.left+","+this.height/2+")");r.append("line").attr("class","track").attr("x1",this.dateRange.range()[0]).attr("x2",this.dateRange.range()[1]).select((u,m,C)=>C[m].parentNode.appendChild(C[m].cloneNode(!0))).attr("class","track-inset").select((u,m,C)=>C[m].parentNode.appendChild(C[m].cloneNode(!0))).attr("class","track-overlay").call(l.ohM().on("drag start",u=>{s.text("Pause"),this.selectedDatePosition=u.x,this.update(this.dateRange.invert(this.selectedDatePosition)),l.Ys("#slider-bar .events").selectAll("circle").style("pointer-events","none")}).on("end",()=>{l.Ys("#slider-bar .events").selectAll("circle").style("pointer-events","all");const u=this.dateRange.invert(this.selectedDatePosition).toTimeString();u===this.endDate.toTimeString()||u===this.startDate.toTimeString()?s.text("Play"):s.text("Continue")})),r.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,21)").selectAll("text").data(this.dateRange.ticks(10)).enter().append("text").attr("x",this.dateRange).attr("y",0).style("font-size",this.fontSize).attr("text-anchor","middle").text(u=>this.formatDateToYearString(u)),r.insert("g",".track-overlay").attr("class","ticks-line").attr("transform","translate(0,-6)").selectAll("line").data(this.dateRange.ticks(10)).enter().append("line").attr("x1",this.dateRange).attr("x2",this.dateRange).attr("y1",0).attr("y2",12).style("stroke","grey").style("stroke-width","2px"),r.insert("g",".track-overlay").attr("class","trace-events").selectAll("circle").data(this.geoActivitiesData.features).enter().append("circle").attr("class",u=>{const m=this.parseTime(u.properties.start_date);return null!==m&&m>=this.startDate?"trace":""}).attr("r",u=>{const m=this.parseTime(u.properties.start_date);return null!==m&&m>=this.startDate?4:2}).attr("cx",u=>{const m=this.parseTime(u.properties.start_date);return null===m?"":m>=this.startDate?this.dateRange(m):void 0}),r.insert("line",".track-overlay").attr("id","trace").attr("x1",this.dateRange(this.startDate)),r.insert("circle",".track-overlay").attr("id","handle").attr("r",10),r.append("g").attr("class","events"),this.sliderDate=this.endDate,this.update(this.endDate)}displaySliderNodes(t){const n=l.Ys("#slider-bar .events").selectAll("circle").data(t,s=>s.properties.id);n.enter().append("circle").attr("id",s=>"location_"+s.properties.id).attr("class",s=>{const r=l.td_("#"+A+" circle."+s.properties.type);return r.size()>0&&r.classed("disabled")?"invisible activityPoint "+s.properties.type:"activityPoint "+s.properties.type}).style("fill",s=>"job"===s.properties.type?g.Cm:"education"===s.properties.type?g.bj:"volunteer"===s.properties.type?g.C1:g.Cm).attr("r",this.sliderNodesSize).attr("cursor","pointer").attr("cx",s=>this.dateRange(this.parseTime(s.properties.start_date))).on("click",(s,r)=>{const a=_(this.map,v,r.properties.id,"id").getGeometry();void 0!==a&&this.mapService.zoomToExtent(a.getExtent(),13)}).on("mouseover",(s,r)=>{this.interactionWithEventNode(s.currentTarget,r),l.Ys("#popup-feature-"+r.properties.id).style("display","block").style("right","1em").style("top","5em");const d=_(this.map,v,r.properties.id,"id");d.setStyle(j(d.get("radius")))}).on("mouseout",(s,r)=>{this.interactionWithEventNode(s.currentTarget,r),l.Ys("#popup-feature-"+r.properties.id).style("display","none").style("right","unset").style("top","unset"),_(this.map,v,r.properties.id,"id").setStyle($(r.properties))}),n.exit().remove()}interactionWithEventNode(t,n){const s=l.Ys(t);s.classed("selected",!s.classed("selected"));const r=l.Ys("#"+A+" circle."+n.properties.type);r.classed("selected",!r.classed("selected"))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(E),e.Y36(W.S))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-time-legend"]],inputs:{currentActivityIdSelected:"currentActivityIdSelected",map:"map"},decls:15,vars:7,consts:[["classes","text-bg-secondary"],[1,"d-flex","flex-row","justify-content-center"],["id","slider-bar"],[1,"d-flex","flex-row","justify-content-center","align-items-center"],["id","start-button","role","button",1,"btn","btn-sm","btn-dark",3,"click"],[3,"icon"],["id","play-button","role","button",1,"btn","btn-dark","mx-2",3,"click"],["id","end-button","role","button",1,"btn","btn-sm","btn-dark",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"set-section-container")(1,"h6"),e._uU(2,"Barre Temporelle"),e.qZA(),e.TgZ(3,"set-badge-content",0),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"div",1),e.O4$(),e._UZ(7,"svg",2),e.qZA(),e.kcU(),e.TgZ(8,"div",3)(9,"a",4),e.NdJ("click",function(){return n.resetTimeLine()}),e._UZ(10,"fa-icon",5),e.qZA(),e.TgZ(11,"a",6),e.NdJ("click",function(){return n.startTimeLine()}),e._uU(12,"Play"),e.qZA(),e.TgZ(13,"a",7),e.NdJ("click",function(){return n.forwardTimeLine()}),e._UZ(14,"fa-icon",5),e.qZA()()()),2&t&&(e.xp6(4),e.Oqu(e.xi3(5,4,n.sliderDate,"MMMM y")),e.xp6(3),e.uIk("viewBox","0 10 "+n.width+" "+n.height),e.xp6(3),e.Q6J("icon",n.backwardIcon),e.xp6(4),e.Q6J("icon",n.forwardIcon))},dependencies:[I.BN,H.d,Ne.H,x.uU],styles:[".events circle{stroke-width:1px;opacity:1;stroke:#f8f8ff}.trace-events circle.trace{fill:#686868;stroke:#f8f8ff;stroke-width:3px;stroke-opacity:1}.ticks{font-size:10px}.track,.track-inset,.track-overlay{stroke-linecap:round}.track{stroke:#000;stroke-opacity:.3;stroke-width:13px}.track-inset{stroke:#dcdcdc;stroke-width:11px}.track-overlay{pointer-events:stroke;stroke-width:50px;stroke:transparent;cursor:pointer}#handle{fill:#fff;stroke:#000;stroke-opacity:.5;stroke-width:1.25px}svg #trace{stroke:#6c6c6c;stroke-width:4}#play-button{width:90px}circle.preselected,circle.selected{stroke:#000!important;stroke-width:2px!important}#slider-bar{width:33em}@media (max-width: 576px){#slider-bar{width:20em}}\n"],encapsulation:2}),i})();function Ye(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.zoomOnData())}),e._UZ(1,"fa-icon",6),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("icon",t.centerIcon)}}function Ee(i,o){if(1&i&&e._UZ(0,"app-theme-legend")(1,"app-time-legend",7),2&i){const t=e.oxw();e.xp6(1),e.Q6J("currentActivityIdSelected",t.fragment)("map",t.map)}}function Re(i,o){1&i&&e.GkF(0)}function ze(i,o){if(1&i&&(e.TgZ(0,"div",21),e._UZ(1,"img",22),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("src",n.apiImgUrl+t.properties.img_activity,e.LSH)}}function Ge(i,o){1&i&&e._UZ(0,"div")}function Ue(i,o){if(1&i&&(e.TgZ(0,"div",16),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.AsE("Du ",e.xi3(2,2,t.properties.start_date,"MM-yyyy")," au ",e.xi3(3,5,t.properties.end_date,"MM-yyyy"),"")}}function Je(i,o){if(1&i&&(e.TgZ(0,"div",16),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij("Du ",e.xi3(2,1,t.properties.start_date,"MM-yyyy")," \xe0 aujourd'hui")}}function $e(i,o){if(1&i&&(e.TgZ(0,"div",9)(1,"div",10)(2,"div",11)(3,"h5",12),e._uU(4),e.qZA()(),e.TgZ(5,"div",13),e.YNc(6,ze,2,1,"div",14),e.TgZ(7,"div",15)(8,"h6",12),e._uU(9),e.qZA(),e.TgZ(10,"span",16),e._UZ(11,"fa-icon",17),e._uU(12),e.qZA(),e.YNc(13,Ge,1,0,"div",18),e.YNc(14,Ue,4,8,"ng-template",null,19,e.W1O),e.YNc(16,Je,3,4,"ng-template",null,20,e.W1O),e.qZA()()()()),2&i){const t=o.$implicit,n=e.MAs(15),s=e.MAs(17),r=e.oxw(2);e.Q6J("id","popup-feature-"+t.properties.id),e.xp6(4),e.Oqu(t.properties.title),e.xp6(2),e.Q6J("ngIf","null"!==t.properties.img_activity),e.xp6(3),e.Oqu(t.properties.name),e.xp6(2),e.Q6J("icon",r.locationIcon),e.xp6(1),e.hij(" ",t.properties.location," "),e.xp6(1),e.Q6J("ngIf","InProgress"===t.properties.status)("ngIfThen",s)("ngIfElse",n)}}function je(i,o){if(1&i&&e.YNc(0,$e,18,9,"div",8),2&i){const t=e.oxw();e.Q6J("ngForOf",t.geoFeaturesData)}}const Be=function(){return{}},Qe=[{path:"",component:(()=>{class i{constructor(t,n,s,r,d){this.mapService=t,this.dataService=n,this.activatedRoute=s,this.titleService=r,this.controlerService=d,this.imageProfile=h.tz,this.fragment=null,this.experiencesRoute=h.I_.route,this.educationRoute=h.QD.route,this.travelId=null,this.isLegendDisplayed=!0,this.defaultActivitieLayerZoom=9,this.apiImgUrl=h.uV,this.locationIcon=h.pk,this.tagIcon=h.yK,this.centerIcon=h.HI,this.helpIcon=h.mv,this.helpPopup="Voici une cartographie spatio-temporelles de mes exp\xe9riences",this.popupWidth=330,this.popupHeight=190,this.zoomEventSubscription=this.mapService.zoomEvent.subscribe(a=>{this.mapService.zoomToLayerName(v,this.defaultActivitieLayerZoom)}),this.newCoordsSubscription=this.mapService.newCoords.subscribe(a=>{this.popupMoving(a[1])}),this.mapSubscription=this.mapService.map.subscribe(a=>{this.map=a}),this.pullActivitiesGeoDataToMapSubscription=this.dataService.activitiesGeoDataToMap.pipe((0,q.U)((a,p)=>[a,p])).subscribe(a=>{if(this.mapService.removeLayerByName(v),this.geoFeaturesData=a[0],console.log(this.geoFeaturesData),this.buildActivityLayer(this.geoFeaturesData),null!==this.fragment){const f=_(this.map,v,this.fragment,"id").getGeometry();void 0!==f&&this.mapService.zoomToExtent(f.getExtent(),13)}else 0===a[1]&&this.mapService.zoomToLayerName(v,this.defaultActivitieLayerZoom)}),this.pullTripsGeoDataToMapSubscription=this.dataService.tripsGeoDataToMap.subscribe(a=>{1===a.length&&this.travelId!==a[0].name&&(this.mapService.removeLayerByName(P),this.travelId=a[0].name,this.buildTravelLayer(a[0])),0===a.length&&(this.travelId=null,this.mapService.removeLayerByName(P))}),this.routeSubscription=this.activatedRoute.fragment.subscribe(a=>{this.fragment=null===a?null:a})}ngOnInit(){this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap(),this.sendResumeSubMenus(),this.zoomInitDone=!1,this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}ngOnDestroy(){this.mapSubscription.unsubscribe(),this.pullActivitiesGeoDataToMapSubscription.unsubscribe(),this.pullTripsGeoDataToMapSubscription.unsubscribe(),this.zoomEventSubscription.unsubscribe(),this.routeSubscription.unsubscribe(),this.newCoordsSubscription.unsubscribe(),this.mapService.removeLayerByName(v),this.mapService.removeLayerByName(P),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}zoomOnData(){this.mapService.sendZoomAction()}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title),this.titleService.setTitle(this.activatedRoute.snapshot.data.title)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}buildLayerFromFeatures(t,n,s){let r=new U.Z({features:[]}),d=new G.Z({source:r});return n.forEach((a,p)=>{let f=new L.Z({geometry:new k.Z(a.geometry.coordinates).transform("EPSG:4326","EPSG:3857"),id:a.properties.id,type:a.properties.type,name:a.properties.name,radius:2*a.properties.months});f.setStyle(s(a.properties)),r.addFeature(f)}),d.set("name",t),d}buildActivityLayer(t){let n=this.buildLayerFromFeatures(v,t,$);this.map.addLayer(n);let s=new ee.Z({condition:te.MJ,multi:!1,layers:[n],style:r=>j(r.get("radius"))});s.on("select",r=>{const d=r.selected,a=r.deselected;if(1===a.length){let p=a[0];this.currentFeatureSelectedId=null,this.mapService.unsetMapEvent("mapCoords"),l.Ys("#popup-feature-"+p.get("id")).style("display","none").style("right","unset").style("top","unset").style("left","unset"),this._handleActivityCircleOnLegend(p)}if(1===d.length){let p=d[0];this.currentFeatureSelectedId=p.get("id"),this.mapService.setMapEvent("mapCoords"),l.Ys("#popup-feature-"+p.get("id")).style("z-index","1"),this._handleActivityCircleOnLegend(p)}}),this.map.addInteraction(s)}_handleActivityCircleOnLegend(t){const n=l.Ys("#"+A+" circle."+t.get("type"));n.classed("selected",!n.classed("selected"));const s=l.Ys("circle#location_"+t.get("id"));s.classed("selected",!s.classed("selected"))}buildTravelLayer(t){let n=[];t.geojson_data.forEach(y=>{n.push((0,N.vs)(y.geometry.coordinates,"EPSG:4326","EPSG:3857"))});let s=new re.Z(n);var r=new L.Z({type:"route",geometry:s});const d=new L.Z({type:"limit",geometry:new k.Z(s.getFirstCoordinate())}),a=new L.Z({type:"limit",geometry:new k.Z(s.getLastCoordinate())}),p=new k.Z(s.getFirstCoordinate()),f=new L.Z({type:"movingNode",geometry:p});let u=new U.Z({features:[]}),m=new G.Z({source:u});[r,f,d,a].forEach((y,R)=>{y.setStyle(V(y.get("type"))),u.addFeature(y)}),m.set("name",P),this.map.addLayer(m);let X=Date.now(),Z=0;m.on("postrender",y=>{const R=y.frameState.time;Z=(Z+100*(R-X)/1e6)%2,X=R;const Ke=s.getCoordinateAt(Z>1?2-Z:Z);p.setCoordinates(Ke);const K=function oe(i){if(!(i.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const o=i.inversePixelTransform[0],t=i.frameState,n=(0,ne.Jp)(i.inversePixelTransform.slice(),t.coordinateToPixelTransform),s=(0,se.se)(t.viewState.resolution,o);let r;const d=(0,N.Cs)();return d&&(r=(0,N.WO)(d,t.viewState.projection)),new ie.Z(i.context,o,t.extent,n,t.viewState.rotation,s,r)}(y);K.setStyle(V("movingNode")),K.drawGeometry(p),this.map.render()})}popupMoving(t){l.Ys("#popup-feature-"+this.currentFeatureSelectedId).style("left",()=>t[0]+this.popupWidth+20>this.innerWidth?t[0]-this.popupWidth-15+"px":t[0]+15+"px").style("top",()=>t[1]+this.popupHeight+20>this.innerHeight?t[1]-this.popupHeight-15+"px":t[1]+15+"px").style("display","block")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(W.S),e.Y36(E),e.Y36(O.gz),e.Y36(Se.Dx),e.Y36(be.L))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-map-view"]],decls:8,vars:3,consts:[["classes","position-fixed"],["buttonsTemplate",""],["controlersTemplate",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["activitiesPopups",""],["title","Centrer","type","button","checked","","autocomplete","off",1,"btn","btn-sm","btn-warning","mx-1",3,"click"],[1,"",3,"icon"],[3,"currentActivityIdSelected","map"],["class","card shadow-lg map-popup border border-3 border-secondary",3,"id",4,"ngFor","ngForOf"],[1,"card","shadow-lg","map-popup","border","border-3","border-secondary",3,"id"],[1,"card-body"],[1,"d-flex","flex-row","justify-content-around","mb-1"],[1,"fw-bolder","small"],[1,"d-flex","flex-row","justify-content-around"],["class","w-25 justify-content-around text-center",4,"ngIf"],[1,"my-auto"],[1,"small"],[1,"me-2","text-danger",3,"icon"],[4,"ngIf","ngIfThen","ngIfElse"],["pastJob",""],["currentJob",""],[1,"w-25","justify-content-around","text-center"],[1,"img-fluid","rounded","mx-auto","shadow","mini-img-thumbnail",3,"src"]],template:function(t,n){if(1&t&&(e.TgZ(0,"set-legend-container",0),e.YNc(1,Ye,2,1,"ng-template",null,1,e.W1O),e.YNc(3,Ee,2,2,"ng-template",null,2,e.W1O),e.qZA(),e.YNc(5,Re,1,0,"ng-container",3),e.YNc(6,je,1,1,"ng-template",null,4,e.W1O)),2&t){const s=e.MAs(7);e.xp6(5),e.Q6J("ngTemplateOutlet",s)("ngTemplateOutletContext",e.DdM(2,Be))}},dependencies:[x.sg,x.O5,x.tP,I.BN,De.b,Oe,Fe,x.uU],styles:[".map-popup[_ngcontent-%COMP%]{position:fixed;display:none;background-color:#f8f8ff;max-width:400px}#map-title[_ngcontent-%COMP%]{background-color:#f1f1f1c9!important;padding:10px;border-bottom-right-radius:25px;border-bottom-left-radius:25px}#map-title[_ngcontent-%COMP%]:after{left:-30px;border-top:30px solid salmon;border-left:30px solid transparent;z-index:-10}.mini-img-thumbnail[_ngcontent-%COMP%]{width:15vw}"]}),i})(),data:{title:"Carte des activit\xe9s",page:"map-activities"},outlet:"map-activities"}];let Ve=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[O.Bz.forChild(Qe),O.Bz]}),i})();var We=c(7157);let He=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[E],imports:[x.ez,Ve,I.uH,We.p]}),i})()}}]);