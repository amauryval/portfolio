
<div class="container-fluid g-0" *ngIf="isGeodataCanBeDisplayed">
  <div class="d-flex flex-column">


    <div class="d-flex flex-row map-content">
    </div>

    <div class="d-flex flex-row legend-container">
      <div class="d-flex flex-column flex-fill">

        <div class="d-flex flex-row align-items-end justify-content-between px-3">

          <div class="d-flex flex-row">
            <button class="btn btn-sm btn-dark me-2" type="button" checked autocomplete="off" (click)="showHideLegend()">
              <fa-icon class="" [icon]="tagIcon"></fa-icon>
              LÃ©gende
            </button>

            <button class="btn btn-sm btn-warning me-2" title="Centrer" type="button" checked autocomplete="off" (click)="zoomOnData()">
              <fa-icon class="" [icon]="centerIcon"></fa-icon>
            </button>
          </div>

          <div class="map-sources d-flex flex-column">
            <div class="col-12">
              <div id="attribution" class="float-end"></div>
            </div>

            <div class="col-12">
              <div id="legend-scale" class="float-end"></div>
            </div>
          </div>

        </div>

        <div class="d-flex flex-column flex-lg-row bg-white legend-content text-center py-3 px-1 justify-content-around align-items-center"  style="min-height : 2em;">

          <div class="d-flex justify-content-center" *ngIf="isLegendDisplayed">
            <app-theme-legend
            ></app-theme-legend>
          </div>

          <div class="flex-grow-1 justify-content-center">
            <app-time-legend
              [isGeodataCanBeDisplayed]="isGeodataCanBeDisplayed"
              [currentActivityIdSelected]="fragmentValue"
            ></app-time-legend>
          </div>

        </div>
      </div>

    </div>

  </div>

</div>





<ng-container *ngTemplateOutlet="activitiesPopups; context:{}"></ng-container>




<ng-template #activitiesPopups>
<div [id]="'popup-feature-' + feature.properties.id" class="col-md-4 item card shadow map-popup" *ngFor="let feature of geoFeaturesData">
  <div class="card-body">
    <div class="row justify-content-around">

      <div class="col-lg-12 mb-1">
        <h5 class="fw-bolder small">{{feature.properties.title}}</h5>
      </div>
    </div>

    <div class="row justify-content-around">

      <div *ngIf="feature.properties.img_activity !== 'null';then ImgActivity"></div>
      <ng-template #ImgActivity>
        <div class="col-4 my-auto justify-content-around text-center">
          <img class="img-fluid rounded mx-auto d-block shadow mini-img-thumbnail" [src]="apiImgUrl + feature.properties.img_activity"/>
        </div>
      </ng-template>

      <div class="col-8 my-auto">
        <h6 class="fw-bolder small">{{feature.properties.name}}</h6>
          <span class="small">
            <fa-icon class="me-2 text-danger" [icon]="locationIcon"></fa-icon>
            {{feature.properties.location}}
          </span>

            <div *ngIf="feature.properties.status === 'InProgress'; then currentJob else pastJob"></div>
              <ng-template #pastJob>
                <div class="small">Du {{ feature.properties.start_date | date: 'MM-yyyy' }} au {{ feature.properties.end_date | date: 'MM-yyyy' }}</div>
              </ng-template>

              <ng-template #currentJob>
                <div class="small">Du {{ feature.properties.start_date | date: 'MM-yyyy' }} Ã  aujourd'hui</div>
              </ng-template>
      </div>
    </div>
  </div>
</div>
</ng-template>
