<div id="jobWidget" *ngIf="tabView == 'job'"
  class="activities-widget
    d-flex flex-column
  ">
  <h5 [ngClass]="'title-tick-' + tabView">Activités : {{activitiesMapping[tabView]}}</h5>
  <ng-container *ngTemplateOutlet="activityFeature; context:{activitiesType: 'job', activitiesData: jobsData}"></ng-container>
</div>

<div id="personal_projectWidget" *ngIf="tabView == 'personal-project'"
  class="activities-widget
    d-flex flex-column
  ">
  <h5 [ngClass]="'title-tick-' + tabView">Activités : {{activitiesMapping[tabView]}}</h5>
  <ng-container *ngTemplateOutlet="activityFeature; context:{activitiesType: 'personal-project', activitiesData: personalProjectsData}"></ng-container>
</div>

<div id="volunteerWidget" *ngIf="tabView == 'volunteer'"
  class="activities-widget
    d-flex flex-column
  ">
  <h5 [ngClass]="'title-tick-' + tabView">Activités : {{activitiesMapping[tabView]}}</h5>
  <ng-container *ngTemplateOutlet="activityFeature; context:{activitiesType: 'volunteer', activitiesData: volunteersData}"></ng-container>
</div>



<ng-template #activityFeature let-activitiesType='activitiesType' let-activitiesData='activitiesData'>
  <section [id]="'activities-' + activity.identifier" *ngFor="let activity of activitiesData;let indexOfActivity=index; trackBy: trackByMethod"
  class="activity-feature
    card rounded
    mb-3 mx-4
  ">
    <ng-container *ngTemplateOutlet="ActivityCardFeature; context:{activity: activity, activityType: activitiesType, activityIndex: indexOfActivity}"></ng-container>
  </section>
</ng-template>




<!-- ACTIVITY CARD TEMPLATE -->
<ng-template #ActivityCardFeature let-activity='activity' let-activityType='activityType' let-activityIndex='activityIndex'>

  <div class="header
    card-header
    d-flex flex-row
    align-items-center
    " [ngStyle]="buildColorStyle(activity.color)">

    <div class="title">{{activity.title}}</div>

    <div class="buttons-tools
      d-flex flex-row
      ms-auto
      ">

      <a *ngIf="activity.medias_found" class="btn-sm-warning" [routerLink]="[galleryPagesRoute]" [fragment]="activity.identifier" title="Accès à la galerie"><fa-icon [icon]="galleryIcon"></fa-icon></a>

      <ng-container *ngIf="activity.recommendations && countDictObject(activity.recommendations) > 0">
        <span class="btn-sm-success" title="Recommandation(s)" type="button" id="dropdownRecomButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <fa-icon [icon]="trophyIcon"></fa-icon>
        </span>
        <div class="dropdown-menu" aria-labelledby="dropdownRecomButton" *ngFor="let recommendation of activity.recommendations | keyvalue">
          <a class="dropdown-item small" [href]="recommendation.value" target="_blank" rel="noopener noreferrer">{{ recommendation.key }}</a>
        </div>
      </ng-container>

      <ng-container *ngIf="activityType == 'personal-project'">
        <a *ngIf="activity.url_github" class="btn-sm-secondary" [href]="activity.url_github" target="_blank" rel="noopener noreferrer" title="Github"><fa-icon [icon]="githubIcon"></fa-icon></a>
        <a *ngIf="activity.url_blog != 'nan'" class="btn-sm-info" [href]="blogUrl + activity.url_blog" target="_blank" rel="noopener noreferrer" title="Ce sujet sur le blog"><fa-icon [icon]="notesIcon"></fa-icon></a>
        <a *ngIf="activity.url_website" class="btn-sm-primary" [href]="activity.url_website"><fa-icon [icon]="websiteIcon"></fa-icon></a>
      </ng-container>

      <a class="btn-sm-dark" (click)="pushActivityId(activity.identifier)" title="Filtrer"><fa-icon [icon]="filterIcon"></fa-icon></a>


    </div>
  </div>

  <div class="body
    card-body
    ">

    <div class="general-infos
      d-flex flex-sm-row flex-column
      justify-content-start
      align-items-center
      ">

      <div class="activity-img my-2">
        <img class="img-fluid" *ngIf="activityType === 'personal-project'" [src]="assetsImagesPath + activity.img_company"/>
        <img class="img-fluid" *ngIf="activityType === 'job'" [src]="apiImgUrl + activity.img_company"/>
        <img class="img-fluid" *ngIf="activityType === 'volunteer'" [src]="apiImgUrl + activity.img_company"/>
      </div>

      <div class="abstract
        d-flex flex-column
        mx-3
        ">

          <h6 *ngIf="activityType !== 'personal-project'" class="title">{{activity.company}}</h6>
          <h6 *ngIf="activityType === 'personal-project'" class="title">{{activity.title}}</h6>

            
          <set-location-icon *ngIf="activityType !== 'personal-project'"
            [mainRoute]="mapPages.route"
            [specificRoute]="mapPages.sub_menus[0].route"
            [fragment]="activity.identifier"
            [title]="activity.location"
          ></set-location-icon>



        <div class="duration
          d-flex flex-row
          ">
          <div *ngIf="activityType !== 'personal-project'" class="">{{ this.contractValueAlias(activity.contract) }} - </div>
          <ng-container *ngIf="activity.status !== 'InProgress'">
              <div>Du {{ activity.start_date | date: 'MM-yyyy' }} au {{ activity.end_date | date: 'MM-yyyy' }} ({{activity.duration}})</div>
          </ng-container>

          <ng-container *ngIf="activity.status === 'InProgress'">
              <div>Du {{ activity.start_date | date: 'MM-yyyy' }} à aujourd'hui ({{activity.duration}})</div>
          </ng-container>
        </div>

        <div class="badge-keywords" *ngIf="activity.keywords">
          <set-badge-content
          *ngFor="let item of activity.keywords | keyvalue"
            [title]="item.key"
            [customBgColor]="item.value"
          ></set-badge-content>

        </div>

      </div>

    </div>

    <div class="feature-tabs" *ngIf="hiddenActivitiesDetails.includes(activityIndex)">

      <ul ngbNav #nav="ngbNav" class="nav-tabs">

        <li ngbNavItem>
          <a ngbNavLink class="title">{{ this.contextTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavPresentationContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

        <li ngbNavItem>
          <a ngbNavLink class="title">{{ this.missionTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavDescriptionContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

        <li ngbNavItem>
          <a ngbNavLink class="title">{{ this.envTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavSkillsContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

        <li ngbNavItem *ngIf="activity.trainings">
          <a ngbNavLink class="title">{{ this.trainingTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavTrainingsContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

        <li ngbNavItem *ngIf="activity.publications !== null">
          <a ngbNavLink class="title">{{ this.publicationsTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavPublicationsContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

      </ul>

      <div [ngbNavOutlet]="nav" class="nav-content mx-2"></div>

    </div>

  </div>

  <div role="button" clickClass="rotate-180" (click)="addToHiddenDetailsConter(activityIndex)"
  class="footer
    card-footer
    text-center
    m-0
  ">
    <fa-icon [icon]="arrowsDownIcon" ></fa-icon>
  </div>

</ng-template>
<!-- ACTIVITY CARD TEMPLATE -->



<!-- TAB CONTENT TEMPLATES -->
<ng-template #ngbNavPresentationContent let-data='data'>
  <div class="paragraph">{{ data.presentation }}</div>
</ng-template>

<ng-template #ngbNavDescriptionContent let-data='data'>
  <ng-container *ngFor="let task of data.description | keyvalue">
    <div class="paragraph">
      <h6 *ngIf="task.key !== 'NoTitle'">{{ task.key }}</h6>
      <ul>
        <li class="text-justify" *ngFor="let description_element of forceArrayType(task.value)">{{ description_element }}</li>
      </ul>
    </div>
  </ng-container>
</ng-template>

<ng-template #ngbNavSkillsContent let-data='data'>
    <ng-container *ngTemplateOutlet="skillDetails; context:{data: data.tools}"></ng-container>
</ng-template>

<ng-template #ngbNavTrainingsContent let-data='data'>
  <div class="paragraph">
    <ng-container *ngFor="let training of data.trainings">
      <span class="title">{{ training.year }}</span><span> - {{ training.name }} par {{ training.trainer }}</span>
    </ng-container>
  </div>
</ng-template>

<ng-template #ngbNavPublicationsContent let-data='data'>
  <div class="paragraph">
    <ng-container *ngFor="let publication of data.publications">
      <span class="title">{{ publication.year }} - </span>
      <span>{{ publication.editor }} par {{ publication.publication }}</span>
      <a [href]="publication.link" type="button">Accès</a>
    </ng-container>
  </div>

</ng-template>
<!-- TAB CONTENT TEMPLATES -->


<!-- SKILLS TEMPLATE -->
<ng-template #skillDetails let-data='data'>
  <div class="skills-container">
    <div class="skill" *ngFor="let tool of data">
      <h6>{{ tool.skill }}</h6>
      <ul>
        <li *ngFor="let item of tool.features">
          <span>{{ item.sub_skill }}</span>
          <span *ngIf="item.details"> : {{ item.details }}</span>
        </li>
      </ul>
    </div>
  </div>
</ng-template>
<!-- SKILLS TEMPLATE -->
