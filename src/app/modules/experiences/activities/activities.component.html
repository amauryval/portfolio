<div id="jobWidget" class="activities-widget" *ngIf="tabView == 'job'">
  <ng-container *ngTemplateOutlet="activityFeature; context:{activitiesType: 'job', activitiesData: jobsData}"></ng-container>
</div>

<div id="personal_projectWidget" class="activities-widget" *ngIf="tabView == 'personal-project'">
  <ng-container *ngTemplateOutlet="activityFeature; context:{activitiesType: 'personal-project', activitiesData: personalProjectsData}"></ng-container>
</div>

<div id="volunteerWidget" class="activities-widget" *ngIf="tabView == 'volunteer'">
  <ng-container *ngTemplateOutlet="activityFeature; context:{activitiesType: 'volunteer', activitiesData: volunteersData}"></ng-container>
</div>



<ng-template #activityFeature let-activitiesType='activitiesType' let-activitiesData='activitiesData'>
  <section [id]="'activities-' + activity.identifier" class="activity-feature" *ngFor="let activity of activitiesData;let indexOfActivity=index; trackBy: trackByMethod">
    <ng-container *ngTemplateOutlet="ActivityCardFeature; context:{activity: activity, activityType: activitiesType, activityIndex: indexOfActivity}"></ng-container>
  </section>
</ng-template>




<!-- ACTIVITY CARD TEMPLATE -->
<ng-template #ActivityCardFeature let-activity='activity' let-activityType='activityType' let-activityIndex='activityIndex'>

  <div class="header" [ngStyle]="buildColorStyle(activity.color)">

    <div class="title">{{activity.title}}</div>

    <div class="buttons-tools">

      <a *ngIf="activity.medias_found" class="btn-sm-warning" [routerLink]="[galleryPagesRoute]" [fragment]="activity.identifier" title="Accès à la galerie"><fa-icon [icon]="galleryIcon"></fa-icon></a>

      <ng-container *ngIf="activity.recommendations && countDictObject(activity.recommendations) > 0">
        <span class="btn-sm-success" title="Recommandation(s)" type="button" id="dropdownRecomButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <fa-icon [icon]="trophyIcon"></fa-icon>
        </span>
        <div class="dropdown-menu" aria-labelledby="dropdownRecomButton" *ngFor="let recommendation of activity.recommendations | keyvalue">
          <a class="dropdown-item small" [href]="recommendation.value" target="_blank" rel="noopener noreferrer">{{ recommendation.key }}</a>
        </div>
      </ng-container>

      <ng-container *ngIf="activityType == 'personal_project'">
        <a *ngIf="activity.url_github" class="btn-sm-secondary" [href]="activity.url_github" target="_blank" rel="noopener noreferrer" title="Github"><fa-icon [icon]="githubIcon"></fa-icon></a>
        <a *ngIf="activity.url_blog != 'nan'" class="btn-sm-info" [href]="blogUrl + activity.url_blog" target="_blank" rel="noopener noreferrer" title="Ce sujet sur le blog"><fa-icon [icon]="notesIcon"></fa-icon></a>
        <a *ngIf="activity.url_website" class="btn-sm-primary" [href]="activity.url_website"><fa-icon [icon]="websiteIcon"></fa-icon></a>
      </ng-container>

      <a class="btn-sm-dark" (click)="pushActivityId(activity.identifier)" title="Filtrer"><fa-icon [icon]="filterIcon"></fa-icon></a>


    </div>
  </div>

  <div class="body">

    <div class="general-infos">

      <div class="activity-img">
        <img *ngIf="activityType === 'personal_project'" [src]="assetsImgUrl + activity.img_company"/>
        <img *ngIf="activityType === 'job'" [src]="apiImgUrl + activity.img_company"/>
        <img *ngIf="activityType === 'volunteer'" [src]="apiImgUrl + activity.img_company"/>
      </div>

      <div class="abstract">

          <h6 *ngIf="activityType !== 'personal_project'" class="title">{{activity.company}}</h6>
          <h6 *ngIf="activityType === 'personal_project'" class="title">{{activity.title}}</h6>

          <div *ngIf="activityType !== 'personal_project'" class="location">
            <a [id]="'location_' + activity.identifier" role="button" [routerLink]="[mapPages.route + '/' + mapPages.sub_menus[0].route]" [fragment]="activity.identifier">
              <fa-icon [pulse]="true" [icon]="locationIcon"></fa-icon>
            </a>
            <div>{{activity.location}}</div>
          </div>


        <div class="duration">
          <div *ngIf="activityType !== 'personal_project'" class="">{{ this.contractValueAlias(activity.contract) }} - </div>
          <ng-container *ngIf="activity.status !== 'InProgress'">
              <div>Du {{ activity.start_date | date: 'MM-yyyy' }} au {{ activity.end_date | date: 'MM-yyyy' }} ({{activity.duration}})</div>
          </ng-container>

          <ng-container *ngIf="activity.status === 'InProgress'">
              <div>Du {{ activity.start_date | date: 'MM-yyyy' }} à aujourd'hui ({{activity.duration}})</div>
          </ng-container>
        </div>

        <div class="badge-keywords" *ngIf="activity.keywords">
          <span [style.border]="'1px solid ' + item.value" [style.color]="item.value"
            *ngFor="let item of activity.keywords | keyvalue"
          >{{ item.key }}</span>
        </div>

      </div>

    </div>

    <div class="feature-tabs" *ngIf="hiddenActivitiesDetails.includes(activityIndex)">

      <ul ngbNav #nav="ngbNav" class="nav-tabs">

        <li ngbNavItem>
          <a ngbNavLink class="title">{{ this.contextTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavPresentationContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

        <li ngbNavItem>
          <a ngbNavLink class="title">{{ this.missionTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavDescriptionContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

        <li ngbNavItem>
          <a ngbNavLink class="title">{{ this.envTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavSkillsContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

        <li ngbNavItem *ngIf="activity.trainings">
          <a ngbNavLink class="title">{{ this.trainingTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavTrainingsContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

        <li ngbNavItem *ngIf="activity.publications !== null">
          <a ngbNavLink class="title">{{ this.publicationsTitle }}</a>
          <ng-template ngbNavContent>
            <ng-container *ngTemplateOutlet="ngbNavPublicationsContent; context:{data: activity}"></ng-container>
          </ng-template>
        </li>

      </ul>

      <div [ngbNavOutlet]="nav" class="nav-content"></div>

    </div>

  </div>

  <div clickClass="rotate-180" class="footer" (click)="addToHiddenDetailsConter(activityIndex)">
    <fa-icon [icon]="arrowsDownIcon" ></fa-icon>
  </div>

</ng-template>
<!-- ACTIVITY CARD TEMPLATE -->



<!-- TAB CONTENT TEMPLATES -->
<ng-template #ngbNavPresentationContent let-data='data'>
  <div class="paragraph">{{ data.presentation }}</div>
</ng-template>

<ng-template #ngbNavDescriptionContent let-data='data'>
  <ng-container *ngFor="let task of data.description | keyvalue">
    <div class="paragraph">
      <h6 *ngIf="task.key !== 'NoTitle'">{{ task.key }}</h6>
      <ul>
        <li class="text-justify" *ngFor="let description_element of forceArrayType(task.value)">{{ description_element }}</li>
      </ul>
    </div>
  </ng-container>
</ng-template>

<ng-template #ngbNavSkillsContent let-data='data'>
    <ng-container *ngTemplateOutlet="skillDetails; context:{data: data.tools}"></ng-container>
</ng-template>

<ng-template #ngbNavTrainingsContent let-data='data'>
  <div class="paragraph">
    <ng-container *ngFor="let training of data.trainings">
      <span class="title">{{ training.year }}</span><span> - {{ training.name }} par {{ training.trainer }}</span>
    </ng-container>
  </div>
</ng-template>

<ng-template #ngbNavPublicationsContent let-data='data'>
  <div class="paragraph">
    <ng-container *ngFor="let publication of data.publications">
      <span class="title">{{ publication.year }} - </span>
      <span>{{ publication.editor }} par {{ publication.publication }}</span>
      <a [href]="publication.link" type="button">Accès</a>
    </ng-container>
  </div>

</ng-template>
<!-- TAB CONTENT TEMPLATES -->


<!-- SKILLS TEMPLATE -->
<ng-template #skillDetails let-data='data'>
  <div class="skills-container">
    <div class="skill" *ngFor="let tool of data">
      <h6>{{ tool.skill }}</h6>
      <ul>
        <li *ngFor="let item of tool.features">
          <span>{{ item.sub_skill }}</span>
          <span *ngIf="item.details"> : {{ item.details }}</span>
        </li>
      </ul>
    </div>
  </div>
</ng-template>
<!-- SKILLS TEMPLATE -->
