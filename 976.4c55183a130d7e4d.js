"use strict";(self.webpackChunkportfolio=self.webpackChunkportfolio||[]).push([[976],{1976:(pt,Q,c)=>{c.r(Q),c.d(Q,{MapActivitiesModule:()=>lt});var n,S=c(9808),G=c(9444),U=c(9560),le=c(4004),C=c(3171),z=c(7053),W=c(8894),P=c(187),ce=c(2815),I=c(9889),de=c(8214),E=c(4410),pe=c(4840),B=c(1345),ue=c(9466),w=c(109),A=c(2456),M=c(119),k=c(8313),H=(n=function(r,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])})(r,t)},function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=r}n(r,t),r.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),me=function(n){function r(t,i,o,s){var l=n.call(this,t)||this;return l.selected=i,l.deselected=o,l.mapBrowserEvent=s,l}return H(r,n),r}(de.ZP),N={},ve=function(n){function r(t){var s,i=n.call(this)||this,o=t||{};if(i.boundAddFeature_=i.addFeature_.bind(i),i.boundRemoveFeature_=i.removeFeature_.bind(i),i.condition_=o.condition?o.condition:k.Kf,i.addCondition_=o.addCondition?o.addCondition:k.Fi,i.removeCondition_=o.removeCondition?o.removeCondition:k.Fi,i.toggleCondition_=o.toggleCondition?o.toggleCondition:k.vY,i.multi_=!!o.multi&&o.multi,i.filter_=o.filter?o.filter:B.uX,i.hitTolerance_=o.hitTolerance?o.hitTolerance:0,i.style_=void 0!==o.style?o.style:function ge(){var n=(0,w.Ly)();return(0,A.l7)(n[E.Z.POLYGON],n[E.Z.LINE_STRING]),(0,A.l7)(n[E.Z.GEOMETRY_COLLECTION],n[E.Z.LINE_STRING]),function(r){return r.getGeometry()?n[r.getGeometry().getType()]:null}}(),i.features_=o.features||new ce.Z,o.layers)if("function"==typeof o.layers)s=o.layers;else{var l=o.layers;s=function(a){return(0,A.q9)(l,a)}}else s=B.uX;return i.layerFilter_=s,i.featureLayerAssociation_={},i}return H(r,n),r.prototype.addFeatureLayerAssociation_=function(t,i){this.featureLayerAssociation_[(0,M.sq)(t)]=i},r.prototype.getFeatures=function(){return this.features_},r.prototype.getHitTolerance=function(){return this.hitTolerance_},r.prototype.getLayer=function(t){return this.featureLayerAssociation_[(0,M.sq)(t)]},r.prototype.setHitTolerance=function(t){this.hitTolerance_=t},r.prototype.setMap=function(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),n.prototype.setMap.call(this,t),t?(this.features_.addEventListener(I.Z.ADD,this.boundAddFeature_),this.features_.addEventListener(I.Z.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(I.Z.ADD,this.boundAddFeature_),this.features_.removeEventListener(I.Z.REMOVE,this.boundRemoveFeature_))},r.prototype.addFeature_=function(t){var i=t.element;if(this.style_&&this.applySelectedStyle_(i),!this.getLayer(i)){var o=this.getMap().getAllLayers().find(function(s){if(s instanceof z.Z&&s.getSource()&&s.getSource().hasFeature(i))return s});o&&this.addFeatureLayerAssociation_(i,o)}},r.prototype.removeFeature_=function(t){this.style_&&this.restorePreviousStyle_(t.element)},r.prototype.getStyle=function(){return this.style_},r.prototype.applySelectedStyle_=function(t){var i=(0,M.sq)(t);i in N||(N[i]=t.getStyle()),t.setStyle(this.style_)},r.prototype.restorePreviousStyle_=function(t){for(var i=this.getMap().getInteractions().getArray(),o=i.length-1;o>=0;--o){var s=i[o];if(s!==this&&s instanceof r&&s.getStyle()&&-1!==s.getFeatures().getArray().lastIndexOf(t))return void t.setStyle(s.getStyle())}var l=(0,M.sq)(t);t.setStyle(N[l]),delete N[l]},r.prototype.removeFeatureLayerAssociation_=function(t){delete this.featureLayerAssociation_[(0,M.sq)(t)]},r.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;var i=this.addCondition_(t),o=this.removeCondition_(t),s=this.toggleCondition_(t),l=!i&&!o&&!s,a=t.map,d=this.getFeatures(),v=[],u=[];if(l){(0,ue.ZH)(this.featureLayerAssociation_),a.forEachFeatureAtPixel(t.pixel,function(m,T){if(this.filter_(m,T))return this.addFeatureLayerAssociation_(m,T),u.push(m),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var h=d.getLength()-1;h>=0;--h){var f=d.item(h),F=u.indexOf(f);F>-1?u.splice(F,1):(d.remove(f),v.push(f))}0!==u.length&&d.extend(u)}else{a.forEachFeatureAtPixel(t.pixel,function(m,T){if(this.filter_(m,T))return!i&&!s||(0,A.q9)(d.getArray(),m)?(o||s)&&(0,A.q9)(d.getArray(),m)&&(v.push(m),this.removeFeatureLayerAssociation_(m)):(this.addFeatureLayerAssociation_(m,T),u.push(m)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var x=v.length-1;x>=0;--x)d.remove(v[x]);d.extend(u)}return(u.length>0||v.length>0)&&this.dispatchEvent(new me("select",u,v,t)),!0},r}(pe.ZP);const fe=ve;var ye=c(3620),xe=c(483),Te=c(8377),J=c(1274),Le=c(6527),p=c(9255),g=c(2397),Z=c(949),_=c(5044),L=c(6785);const y="activities",O="travel",Y="legendActivity",X="slider-bar",K="rgba(225, 0, 116, 0.6)",q="rgba(0, 144, 29, 0.6)",ee="rgba(98, 0, 255, 0.6)",b="white",Ze=new Z.Z({radius:0,fill:new _.Z({color:K}),stroke:new L.Z({color:b,width:2})}),_e=new Z.Z({radius:0,fill:new _.Z({color:q}),stroke:new L.Z({color:b,width:2})}),be=new Z.Z({radius:0,fill:new _.Z({color:ee}),stroke:new L.Z({color:b,width:2})});function te(n){let r;return r="job"===n.type?Ze.clone():"education"===n.type?_e.clone():be.clone(),r.setRadius(2*n.months),new w.ZP({image:r})}function ie(n){return new w.ZP({image:new Z.Z({radius:n,fill:new _.Z({color:"rgba(255, 215, 0, 0.6)"}),stroke:new L.Z({color:"black",width:2})})})}const j="black",Ee=new w.ZP({stroke:new L.Z({width:4,color:"black"})}),Ne=new w.ZP({image:new Z.Z({radius:2,fill:new _.Z({color:"black"}),stroke:new L.Z({color:j,width:1})})}),oe=new w.ZP({image:new Z.Z({radius:7,fill:new _.Z({color:"yellow"}),stroke:new L.Z({color:j,width:3})})}),re=n=>"route"===n?Ee:"limit"===n?Ne:oe;function R(n,r,t,i){return n.getLayers().getArray().filter(d=>d.get("name")===r)[0].getSource().getFeatures().filter(d=>d.get(i)===t)[0]}var e=c(5e3),se=c(9947),D=c(7579),Oe=c(520);let V=(()=>{class n{constructor(t){this.http=t,this.apiUrlActivitiesGeoData=g.JW+"activities_geodata",this.ErrorapiUrlActivitiesGeoDataApiFound=new D.x,this.activitiesGeoData=new D.x,this.dataToMap=new D.x,this.dateNotified=new D.x,this.timelineBuild=new D.x,this.activitiesGeoDataToMap=new D.x,this.tripsGeoDataToMap=new D.x}pullActivitiesGeoData(){this.http.get(this.apiUrlActivitiesGeoData).subscribe({complete:()=>{},error:t=>{this.ErrorapiUrlActivitiesGeoDataApiFound.next(t.error.message)},next:t=>{this.activitiesGeoData.next(t)}})}pullDataToMap(t){this.dataToMap.next(t)}pullActivitiesGeoDataToMap(t){this.activitiesGeoDataToMap.next(t)}pullTripsGeoDataToMap(t){this.tripsGeoDataToMap.next(t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(Oe.eN))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Ye=c(2313),Re=c(3686);function Ge(n,r){if(1&n&&(e.O4$(),e._UZ(0,"circle")),2&n){const t=r.$implicit,i=e.oxw();e.Tol(t.class),e.uIk("r",i.activityTypesLegendData.circleR)("cx",i.activityTypesLegendData.circleCxPos)("cy",t.cy)("fill",t.color)("stroke",t.strokeColor)}}function Ue(n,r){if(1&n&&(e.O4$(),e.TgZ(0,"text"),e._uU(1),e.qZA()),2&n){const t=r.$implicit,i=e.oxw();e.Tol(t.class+" label"),e.uIk("x",i.activityTypesLegendData.textXPos)("y",t.cy)("font-size",i.fontSize),e.xp6(1),e.hij("",t.label," ")}}function ze(n,r){if(1&n&&(e.O4$(),e._UZ(0,"circle",9)),2&n){const t=r.$implicit,i=e.oxw();e.uIk("r",t)("cx",i.activityMonthLegendData.circleCxPos)("cy",t)}}function Je(n,r){if(1&n&&(e.O4$(),e.TgZ(0,"text",10),e._uU(1),e.qZA()),2&n){const t=r.$implicit,i=e.oxw();e.uIk("x",i.activityMonthLegendData.textXPos)("y",2*t)("font-size",i.fontSize),e.xp6(1),e.hij("",t," mois ")}}function $e(n,r){if(1&n&&(e.O4$(),e._UZ(0,"line",11)),2&n){const t=r.$implicit;e.uIk("y1",2*t+2)("y2",2*t+2)}}function je(n,r){if(1&n&&(e.O4$(),e._UZ(0,"line")),2&n){const t=r.$implicit;e.Tol(t.classLine),e.uIk("x1",t.x1)("x2",t.x2)("y1",t.y1)("y2",t.y2)("strokeColor",t.strokeColor)}}function Ve(n,r){if(1&n&&(e.O4$(),e._UZ(0,"circle")),2&n){const t=r.$implicit;e.Tol(t.classMarker),e.uIk("r",t.r)("cx",t.y2/2)("cy",t.y2/2)("color",t.circleColor)("strokeColor",t.strokeColor)}}function Qe(n,r){if(1&n&&(e.O4$(),e._UZ(0,"text")),2&n){const t=r.$implicit,i=e.oxw();e.uIk("x",t.y2/2)("y",t.y2/2)("font-size",i.movesLineLegendData.markerFontSize)}}function We(n,r){if(1&n&&(e.O4$(),e.TgZ(0,"text",10),e._uU(1),e.qZA()),2&n){const t=r.$implicit,i=e.oxw();e.uIk("x",i.movesLineLegendData.textXPos)("y",t.y2/2)("font-size",i.fontSize),e.xp6(1),e.hij("",t.label," ")}}let Be=(()=>{class n{constructor(){this.sliderBarId=X,this.legendActivitiesId=Y,this.widthLegendElement=200,this.heightLegendElement=140,this.heightMoveLegendElement=60,this.fontSize="19px",this.activityMonthLegendData={circleMonthR:[40,20,10],circleCxPos:50,textXPos:120},this.activityTypesLegendData={circleR:18,circleCxPos:20,textXPos:50,circleJobs:[{cy:25,class:"education",label:"Formations",color:q,strokeColor:b},{cy:70,class:"job",label:"Entreprises",color:K,strokeColor:b},{cy:115,class:"volunteer",label:"B\xe9n\xe9volat",color:ee,strokeColor:b}]},this.movesLineLegendData={textXPos:50,markerFontSize:"12px",moves:[{x1:0,x2:45,y1:0,y2:45,r:12,classLine:"train-line",classMarker:"train-marker",classMarkerText:"train-marker-text",label:"Train",circleColor:"yellow",strokeColor:j}]}}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-theme-legend"]],decls:25,vars:13,consts:[["id","theme-legend",1,"row","py-2","mt-auto","justify-content-center"],[1,"col-4","col-lg-4"],[1,"col-lg-12"],[3,"id"],[3,"class",4,"ngFor","ngForOf"],["class","activity-months",4,"ngFor","ngForOf"],["class","label",4,"ngFor","ngForOf"],["x1","50","x2","115","class","line-dot",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"activity-months"],[1,"label"],["x1","50","x2","115",1,"line-dot"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h6"),e._uU(3,"Activit\xe9s"),e.qZA(),e.TgZ(4,"div",2),e.O4$(),e.TgZ(5,"svg",3),e.YNc(6,Ge,1,7,"circle",4),e.YNc(7,Ue,2,6,"text",4),e.qZA()()(),e.kcU(),e.TgZ(8,"div",1)(9,"h6"),e._uU(10,"Dur\xe9e"),e.qZA(),e.TgZ(11,"div",2),e.O4$(),e.TgZ(12,"svg"),e.YNc(13,ze,1,3,"circle",5),e.YNc(14,Je,2,4,"text",6),e.YNc(15,$e,1,2,"line",7),e.qZA()()(),e.kcU(),e.TgZ(16,"div",1)(17,"h6"),e._uU(18,"D\xe9placements"),e.qZA(),e.TgZ(19,"div",2),e.O4$(),e.TgZ(20,"svg"),e.YNc(21,je,1,7,"line",4),e.YNc(22,Ve,1,7,"circle",4),e.YNc(23,Qe,1,3,"text",8),e.YNc(24,We,2,4,"text",6),e.qZA()()()()),2&t&&(e.xp6(5),e.Q6J("id",i.legendActivitiesId),e.uIk("viewBox","0 0 "+i.widthLegendElement+" "+i.heightLegendElement),e.xp6(1),e.Q6J("ngForOf",i.activityTypesLegendData.circleJobs),e.xp6(1),e.Q6J("ngForOf",i.activityTypesLegendData.circleJobs),e.xp6(5),e.uIk("viewBox","0 0 "+i.widthLegendElement+" "+i.heightLegendElement),e.xp6(1),e.Q6J("ngForOf",i.activityMonthLegendData.circleMonthR),e.xp6(1),e.Q6J("ngForOf",i.activityMonthLegendData.circleMonthR),e.xp6(1),e.Q6J("ngForOf",i.activityMonthLegendData.circleMonthR),e.xp6(5),e.uIk("viewBox","0 0 "+i.widthLegendElement+" "+i.heightMoveLegendElement),e.xp6(1),e.Q6J("ngForOf",i.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",i.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",i.movesLineLegendData.moves),e.xp6(1),e.Q6J("ngForOf",i.movesLineLegendData.moves))},directives:[S.sg],styles:[".label[_ngcontent-%COMP%]{text-anchor:start;dominant-baseline:middle}svg[_ngcontent-%COMP%]{width:9em}@media (max-width: 576px){svg[_ngcontent-%COMP%]{width:6em}}"]}),n})(),He=(()=>{class n{constructor(t,i){this.dataService=t,this.mapService=i,this.backwardIcon=g.Gq,this.forwardIcon=g.cn,this.sliderBarId="#"+X,this.margin={top:10,right:15,bottom:0,left:15},this.width=600,this.height=90,this.fontSize="14px",this.sliderNodesSize=5,this.endDate=g.cQ,this.currentYear=g.VK,this.selectedDatePosition=0,this.maxDatePosition=this.width-this.margin.left-this.margin.right,this.currentCountNodes=0,this.mapSubscription=this.mapService.map.subscribe(o=>{this.map=o}),this.pullGeoDataSubscription=this.dataService.activitiesGeoData.subscribe(o=>{this.geoTripsData=o.trips_data,this.geoActivitiesData=o.activities_geojson;const s=new Date(o.start_date);s.setMonth(s.getMonth()-1),this.startDate=s,this.buildTimeline(String(this.currentYear))})}ngOnInit(){this.dataService.pullActivitiesGeoData()}ngOnDestroy(){this.pullGeoDataSubscription.unsubscribe(),this.mapSubscription.unsubscribe()}parseTime(t){return p.Z1g("%Y-%m-%d")(t)}formatDate(t){return p.i$Z("%b %Y")(t)}formatDateToYearString(t){return p.i$Z("%Y")(t)}formatDateToString(t){return p.i$Z("%Y-%m-%d")(t)}startTimeLine(){const t=p.Ys("#play-button");"Pause"===t.html()?(clearInterval(this.timer),t.text("Continue")):(t.html(),this.timer=setInterval(this.step.bind(this),100),t.html("Pause"))}resetTimeLine(){p.Ys("#play-button").html("Start"),this.sliderDate=this.startDate,this.update(this.startDate),this.selectedDatePosition=0,clearInterval(this.timer)}forwardTimeLine(){p.Ys("#play-button").html("Play"),this.sliderDate=this.startDate,this.update(this.endDate),this.selectedDatePosition=0,clearInterval(this.timer)}updateTrips(t){let i=[];this.geoTripsData.forEach(o=>{const l=o.end_date,a=this.parseTime(o.start_date),d=this.parseTime(l);null!==a&&null!==d&&t>=a&&t<d&&i.push(o)}),this.dataService.pullTripsGeoDataToMap(1===i.length?i:[])}update(t){this.updateTrips(t);const i=this.geoActivitiesData.features.filter(o=>{const s=this.parseTime(o.properties.start_date);return null!==s&&s>=this.startDate&&s<t});i.length!==this.currentCountNodes&&(this.dataService.pullActivitiesGeoDataToMap(i),this.displaySliderNodes(i)),this.currentCountNodes=i.length,p.Ys("#trace").attr("x2",this.dateRange(t)),p.Ys("#handle").attr("cx",this.dateRange(t)),this.sliderDate=t}step(){this.update(this.dateRange.invert(this.selectedDatePosition)),this.selectedDatePosition=this.selectedDatePosition+this.maxDatePosition/151,this.selectedDatePosition>this.maxDatePosition&&(this.selectedDatePosition=0,clearInterval(this.timer),p.Ys("#play-button").text("Play"))}_initDateRange(){this.dateRange=p.Xf().domain([this.startDate,this.endDate]).range([0,this.maxDatePosition]).clamp(!0)}buildTimeline(t){const i=p.Ys(this.sliderBarId),o=p.Ys("#play-button");this._initDateRange();const s=i.append("g").attr("class","slider-bar").attr("transform","translate("+this.margin.left+","+this.height/2+")");s.append("line").attr("class","track").attr("x1",this.dateRange.range()[0]).attr("x2",this.dateRange.range()[1]).select((u,h,f)=>f[h].parentNode.appendChild(f[h].cloneNode(!0))).attr("class","track-inset").select((u,h,f)=>f[h].parentNode.appendChild(f[h].cloneNode(!0))).attr("class","track-overlay").call(p.ohM().on("drag start",u=>{o.text("Pause"),this.selectedDatePosition=u.x,this.update(this.dateRange.invert(this.selectedDatePosition)),p.Ys("#slider-bar .events").selectAll("circle").style("pointer-events","none")}).on("end",()=>{p.Ys("#slider-bar .events").selectAll("circle").style("pointer-events","all");const u=this.dateRange.invert(this.selectedDatePosition).toTimeString();u===this.endDate.toTimeString()||u===this.startDate.toTimeString()?o.text("Play"):o.text("Continue")})),s.insert("g",".track-overlay").attr("class","ticks").attr("transform","translate(0,21)").selectAll("text").data(this.dateRange.ticks(10)).enter().append("text").attr("x",this.dateRange).attr("y",0).style("font-size",this.fontSize).attr("text-anchor","middle").text(u=>this.formatDateToYearString(u)),s.insert("g",".track-overlay").attr("class","ticks-line").attr("transform","translate(0,-6)").selectAll("line").data(this.dateRange.ticks(10)).enter().append("line").attr("x1",this.dateRange).attr("x2",this.dateRange).attr("y1",0).attr("y2",12).style("stroke","grey").style("stroke-width","2px"),s.insert("g",".track-overlay").attr("class","trace-events").selectAll("circle").data(this.geoActivitiesData.features).enter().append("circle").attr("class",u=>{const h=this.parseTime(u.properties.start_date);return null!==h&&h>=this.startDate?"trace":""}).attr("r",u=>{const h=this.parseTime(u.properties.start_date);return null!==h&&h>=this.startDate?4:2}).attr("cx",u=>{const h=this.parseTime(u.properties.start_date);return null===h?"":h>=this.startDate?this.dateRange(h):void 0}),s.insert("line",".track-overlay").attr("id","trace").attr("x1",this.dateRange(this.startDate)),s.insert("circle",".track-overlay").attr("id","handle").attr("r",10),s.append("g").attr("class","events"),this.sliderDate=this.endDate,this.update(this.endDate)}displaySliderNodes(t){const i=p.Ys("#slider-bar .events").selectAll("circle").data(t,o=>o.properties.id);i.enter().append("circle").attr("id",o=>"location_"+o.properties.id).attr("class",o=>{const s=p.td_("#"+Y+" circle."+o.properties.type);return s.size()>0&&s.classed("disabled")?"invisible activityPoint "+o.properties.type:"activityPoint "+o.properties.type}).attr("r",this.sliderNodesSize).attr("cursor","pointer").attr("cx",o=>this.dateRange(this.parseTime(o.properties.start_date))).on("click",(o,s)=>{const a=R(this.map,y,s.properties.id,"id").getGeometry();void 0!==a&&this.mapService.zoomToExtent(a.getExtent(),13)}).on("mouseover",(o,s)=>{this.interactionWithEventNode(o.currentTarget,s),p.Ys("#popup-feature-"+s.properties.id).style("display","block").style("right","1em").style("top","5em");const l=R(this.map,y,s.properties.id,"id");l.setStyle(ie(l.get("radius")))}).on("mouseout",(o,s)=>{this.interactionWithEventNode(o.currentTarget,s),p.Ys("#popup-feature-"+s.properties.id).style("display","none").style("right","unset").style("top","unset"),R(this.map,y,s.properties.id,"id").setStyle(te(s.properties))}),i.exit().remove()}interactionWithEventNode(t,i){const o=p.Ys(t);o.classed("selected",!o.classed("selected"));const s=p.Ys("#"+Y+" circle."+i.properties.type);s.classed("selected",!s.classed("selected"))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(V),e.Y36(se.S))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-time-legend"]],inputs:{currentActivityIdSelected:"currentActivityIdSelected",map:"map"},decls:18,vars:7,consts:[["id","theme-legend",1,"d-flex","flex-column","flex-lg-row","mt-auto","py-2","justify-content-center"],[1,""],["id","slider-bar"],[1,"text-center","px-5"],[1,"d-flex","flex-column","justify-content-center"],["id","slider-value"],["id","start-button","role","button",1,"btn","btn-dark","btn-sm",3,"click"],[3,"icon"],["id","play-button","role","button",1,"btn","btn-dark","mx-2",3,"click"],["id","end-button","role","button",1,"btn","btn-dark","btn-sm",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h6"),e._uU(3,"Barre Temporelle"),e.qZA(),e.O4$(),e._UZ(4,"svg",2),e.qZA(),e.kcU(),e.TgZ(5,"div",3)(6,"div",4)(7,"div",1)(8,"h5",5),e._uU(9),e.ALo(10,"date"),e.qZA()(),e.TgZ(11,"div",1)(12,"a",6),e.NdJ("click",function(){return i.resetTimeLine()}),e._UZ(13,"fa-icon",7),e.qZA(),e.TgZ(14,"a",8),e.NdJ("click",function(){return i.startTimeLine()}),e._uU(15,"Play"),e.qZA(),e.TgZ(16,"a",9),e.NdJ("click",function(){return i.forwardTimeLine()}),e._UZ(17,"fa-icon",7),e.qZA()()()()()),2&t&&(e.xp6(4),e.uIk("viewBox","0 0 "+i.width+" "+i.height),e.xp6(5),e.Oqu(e.xi3(10,4,i.sliderDate,"MMMM y")),e.xp6(4),e.Q6J("icon",i.backwardIcon),e.xp6(4),e.Q6J("icon",i.forwardIcon))},directives:[G.BN],pipes:[S.uU],styles:[".events circle{stroke-width:1px;opacity:1;stroke:#f8f8ff}.trace-events circle.trace{fill:#686868;opacity:.7;stroke:#f8f8ff;stroke-width:3px;stroke-opacity:1}.ticks{font-size:10px}.track,.track-inset,.track-overlay{stroke-linecap:round}.track{stroke:#000;stroke-opacity:.3;stroke-width:13px}.track-inset{stroke:#dcdcdc;stroke-width:11px}.track-overlay{pointer-events:stroke;stroke-width:50px;stroke:transparent;cursor:pointer}#handle{fill:#fff;stroke:#000;stroke-opacity:.5;stroke-width:1.25px}svg #trace{stroke:#6c6c6c;stroke-width:4}#play-button{width:90px}circle.preselected{stroke:#000!important;stroke-width:2px!important}#slider-bar{width:33em}@media (max-width: 576px){#slider-bar{width:20em}}\n"],encapsulation:2}),n})();function Xe(n,r){1&n&&e.GkF(0)}function Ke(n,r){1&n&&e._UZ(0,"div")}function qe(n,r){if(1&n&&(e.TgZ(0,"div",18),e._UZ(1,"img",19),e.qZA()),2&n){const t=e.oxw().$implicit,i=e.oxw(2);e.xp6(1),e.Q6J("src",i.apiImgUrl+t.properties.img_activity,e.LSH)}}function et(n,r){1&n&&e._UZ(0,"div")}function tt(n,r){if(1&n&&(e.TgZ(0,"div",13),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.AsE("Du ",e.xi3(2,2,t.properties.start_date,"MM-yyyy")," au ",e.xi3(3,5,t.properties.end_date,"MM-yyyy"),"")}}function it(n,r){if(1&n&&(e.TgZ(0,"div",13),e._uU(1),e.ALo(2,"date"),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij("Du ",e.xi3(2,1,t.properties.start_date,"MM-yyyy")," \xe0 aujourd'hui")}}function nt(n,r){if(1&n&&(e.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"div",8)(4,"h5",9),e._uU(5),e.qZA()()(),e.TgZ(6,"div",7),e.YNc(7,Ke,1,0,"div",10),e.YNc(8,qe,2,1,"ng-template",null,11,e.W1O),e.TgZ(10,"div",12)(11,"h6",9),e._uU(12),e.qZA(),e.TgZ(13,"span",13),e._UZ(14,"fa-icon",14),e._uU(15),e.qZA(),e.YNc(16,et,1,0,"div",15),e.YNc(17,tt,4,8,"ng-template",null,16,e.W1O),e.YNc(19,it,3,4,"ng-template",null,17,e.W1O),e.qZA()()()()),2&n){const t=r.$implicit,i=e.MAs(9),o=e.MAs(18),s=e.MAs(20),l=e.oxw(2);e.Q6J("id","popup-feature-"+t.properties.id),e.xp6(5),e.Oqu(t.properties.title),e.xp6(2),e.Q6J("ngIf","null"!==t.properties.img_activity)("ngIfThen",i),e.xp6(5),e.Oqu(t.properties.name),e.xp6(2),e.Q6J("icon",l.locationIcon),e.xp6(1),e.hij(" ",t.properties.location," "),e.xp6(1),e.Q6J("ngIf","InProgress"===t.properties.status)("ngIfThen",s)("ngIfElse",o)}}function ot(n,r){if(1&n&&e.YNc(0,nt,21,10,"div",4),2&n){const t=e.oxw();e.Q6J("ngForOf",t.geoFeaturesData)}}const rt=function(){return{}},st=[{path:"",component:(()=>{class n{constructor(t,i,o,s,l){this.mapService=t,this.dataService=i,this.activatedRoute=o,this.titleService=s,this.controlerService=l,this.imageProfile=g.tz,this.fragment=null,this.experiencesRoute=g.I_.route,this.educationRoute=g.QD.route,this.travelId=null,this.isLegendDisplayed=!0,this.defaultActivitieLayerZoom=9,this.apiImgUrl=g.VH,this.locationIcon=g.pk,this.tagIcon=g.yK,this.centerIcon=g.HI,this.helpIcon=g.mv,this.helpPopup="Voici une cartographie spatio-temporelles de mes exp\xe9riences",this.popupWidth=330,this.popupHeight=190,this.zoomEventSubscription=this.mapService.zoomEvent.subscribe(a=>{this.mapService.zoomToLayerName(y,this.defaultActivitieLayerZoom)}),this.newCoordsSubscription=this.mapService.newCoords.subscribe(a=>{this.popupMoving(a[1])}),this.mapSubscription=this.mapService.map.subscribe(a=>{this.map=a}),this.pullActivitiesGeoDataToMapSubscription=this.dataService.activitiesGeoDataToMap.pipe((0,le.U)((a,d)=>[a,d])).subscribe(a=>{if(this.mapService.removeLayerByName(y),this.geoFeaturesData=a[0],this.buildActivityLayer(this.geoFeaturesData),null!==this.fragment){const v=R(this.map,y,this.fragment,"id").getGeometry();void 0!==v&&this.mapService.zoomToExtent(v.getExtent(),13)}else 0===a[1]&&this.mapService.zoomToLayerName(y,this.defaultActivitieLayerZoom)}),this.pullTripsGeoDataToMapSubscription=this.dataService.tripsGeoDataToMap.subscribe(a=>{1===a.length&&this.travelId!==a[0].name&&(this.mapService.removeLayerByName(O),this.travelId=a[0].name,this.buildTravelLayer(a[0])),0===a.length&&(this.travelId=null,this.mapService.removeLayerByName(O))}),this.routeSubscription=this.activatedRoute.fragment.subscribe(a=>{this.fragment=null===a?null:a})}ngOnInit(){this.mapService.changeMapInteractionStatus(!0),this.mapService.getMap(),this.sendResumeSubMenus(),this.zoomInitDone=!1,this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}ngOnDestroy(){this.mapSubscription.unsubscribe(),this.pullActivitiesGeoDataToMapSubscription.unsubscribe(),this.pullTripsGeoDataToMapSubscription.unsubscribe(),this.zoomEventSubscription.unsubscribe(),this.routeSubscription.unsubscribe(),this.newCoordsSubscription.unsubscribe(),this.mapService.removeLayerByName(y),this.mapService.removeLayerByName(O),this.mapService.changeMapInteractionStatus(!1),this.mapService.resetMapView()}sendResumeSubMenus(){this.controlerService.pullSubMenus([]),this.controlerService.pullTitlePage(this.activatedRoute.snapshot.data.title),this.titleService.setTitle(this.activatedRoute.snapshot.data.title)}showHideLegend(){this.isLegendDisplayed=!this.isLegendDisplayed}buildLayerFromFeatures(t,i,o){let s=new W.Z({features:[]}),l=new z.Z({source:s});return i.forEach((a,d)=>{let v=new C.Z({geometry:new P.Z(a.geometry.coordinates).transform("EPSG:4326","EPSG:3857"),id:a.properties.id,type:a.properties.type,name:a.properties.name,radius:2*a.properties.months});v.setStyle(o(a.properties)),s.addFeature(v)}),l.set("name",t),l}buildActivityLayer(t){let i=this.buildLayerFromFeatures(y,t,te);this.map.addLayer(i);let o=new fe({condition:k.MJ,multi:!1,layers:[i],style:s=>ie(s.get("radius"))});o.on("select",s=>{const l=s.selected,a=s.deselected;if(1===a.length){let d=a[0];this.currentFeatureSelectedId=null,this.mapService.unsetMapEvent("mapCoords"),p.Ys("#popup-feature-"+d.get("id")).style("display","none").style("right","unset").style("top","unset").style("left","unset"),this._handleActivityCircleOnLegend(d)}if(1===l.length){let d=l[0];this.currentFeatureSelectedId=d.get("id"),this.mapService.setMapEvent("mapCoords"),p.Ys("#popup-feature-"+d.get("id")).style("display","block").style("z-index","1"),this._handleActivityCircleOnLegend(d)}}),this.map.addInteraction(o)}_handleActivityCircleOnLegend(t){const i=p.Ys("#"+Y+" circle."+t.get("type"));i.classed("selected",!i.classed("selected"));const o=p.Ys("circle#location_"+t.get("id"));o.classed("selected",!o.classed("selected"))}buildTravelLayer(t){let i=[];t.geojson_data.forEach(m=>{i.push((0,J.vs)(m.geometry.coordinates,"EPSG:4326","EPSG:3857"))});let o=new Le.Z(i);var s=new C.Z({type:"route",geometry:o});const l=new C.Z({type:"limit",geometry:new P.Z(o.getFirstCoordinate())}),a=new C.Z({type:"limit",geometry:new P.Z(o.getLastCoordinate())}),d=new P.Z(o.getFirstCoordinate()),v=new C.Z({type:"movingNode",geometry:d});let u=new W.Z({features:[]}),h=new z.Z({source:u});[s,v,l,a].forEach((m,T)=>{m.setStyle(re(m.get("type"))),u.addFeature(m)}),h.set("name",O),this.map.addLayer(h);let F=Date.now(),x=0;h.on("postrender",m=>{const T=m.frameState.time;x=(x+100*(T-F)/1e6)%2,F=T;const dt=o.getCoordinateAt(x>1?2-x:x);d.setCoordinates(dt);const ae=function Se(n){if(!(n.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");var s,r=n.inversePixelTransform[0],t=n.frameState,i=(0,xe.Jp)(n.inversePixelTransform.slice(),t.coordinateToPixelTransform),o=(0,Te.se)(t.viewState.resolution,r),l=(0,J.Cs)();return l&&(s=(0,J.WO)(l,t.viewState.projection)),new ye.Z(n.context,r,t.extent,i,t.viewState.rotation,o,s)}(m);ae.setStyle(re("movingNode")),ae.drawGeometry(d),this.map.render()})}popupMoving(t){p.Ys("#popup-feature-"+this.currentFeatureSelectedId).style("left",()=>t[0]+this.popupWidth+20>this.innerWidth?t[0]-this.popupWidth-15+"px":t[0]+15+"px").style("top",()=>t[1]+this.popupHeight+20>this.innerHeight?t[1]-this.popupHeight-15+"px":t[1]+15+"px")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(se.S),e.Y36(V),e.Y36(U.gz),e.Y36(Ye.Dx),e.Y36(Re.L))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-map-view"]],decls:6,vars:5,consts:[[1,"d-flex","flex-column","flex-xl-row","justify-content-around","align-items-center"],[3,"currentActivityIdSelected","map"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["activitiesPopups",""],["class","col-md-4 item card shadow map-popup",3,"id",4,"ngFor","ngForOf"],[1,"col-md-4","item","card","shadow","map-popup",3,"id"],[1,"card-body"],[1,"row","justify-content-around"],[1,"col-lg-12","mb-1"],[1,"fw-bolder","small"],[4,"ngIf","ngIfThen"],["ImgActivity",""],[1,"col-8","my-auto"],[1,"small"],[1,"me-2","text-danger",3,"icon"],[4,"ngIf","ngIfThen","ngIfElse"],["pastJob",""],["currentJob",""],[1,"col-4","my-auto","justify-content-around","text-center"],[1,"img-fluid","rounded","mx-auto","d-block","shadow","mini-img-thumbnail",3,"src"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-theme-legend")(2,"app-time-legend",1),e.qZA(),e.YNc(3,Xe,1,0,"ng-container",2),e.YNc(4,ot,1,1,"ng-template",null,3,e.W1O)),2&t){const o=e.MAs(5);e.xp6(2),e.Q6J("currentActivityIdSelected",i.fragment)("map",i.map),e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.DdM(4,rt))}},directives:[Be,He,S.tP,S.sg,S.O5,G.BN],pipes:[S.uU],styles:['.map-popup{position:fixed;display:none;background-color:#f8f8ff;max-width:400px}#map-title{background-color:#f1f1f1c9!important;padding:10px;border-bottom-right-radius:25px;border-bottom-left-radius:25px}#map-title:after{left:-30px;border-top:30px solid salmon;border-left:30px solid transparent;z-index:-10}.mini-img-thumbnail{width:15vw}.train-line{stroke:#000;stroke-width:3px}.train-marker{fill:#ff0;stroke:#000;stroke-width:3px;color:#000}.train-marker-text{font-family:"Font Awesome 5 Free";font-weight:900;color:#000;text-anchor:middle;dominant-baseline:middle;pointer-events:none}\n'],encapsulation:2}),n})(),data:{title:"Carte des activit\xe9s",page:"map-activities"},outlet:"map-activities"}];let at=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[U.Bz.forChild(st)],U.Bz]}),n})(),lt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[V],imports:[[S.ez,at,G.uH]]}),n})()}}]);